import{r as requireIeee754,a as requireBuffer}from"./index-B8Hrmrf7.js";function _mergeNamespaces(e,r){for(var n=0;n<r.length;n++){const t=r[n];if(typeof t!="string"&&!Array.isArray(t)){for(const o in t)if(o!=="default"&&!(o in e)){const l=Object.getOwnPropertyDescriptor(t,o);l&&Object.defineProperty(e,o,l.get?l:{enumerable:!0,get:()=>t[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var lib$3={},browser$3={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var e=1e3,r=e*60,n=r*60,t=n*24,o=t*7,l=t*365.25;ms=function(c,f){f=f||{};var s=typeof c;if(s==="string"&&c.length>0)return u(c);if(s==="number"&&isFinite(c))return f.long?d(c):m(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function u(c){if(c=String(c),!(c.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(f){var s=parseFloat(f[1]),a=(f[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return s*l;case"weeks":case"week":case"w":return s*o;case"days":case"day":case"d":return s*t;case"hours":case"hour":case"hrs":case"hr":case"h":return s*n;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}function m(c){var f=Math.abs(c);return f>=t?Math.round(c/t)+"d":f>=n?Math.round(c/n)+"h":f>=r?Math.round(c/r)+"m":f>=e?Math.round(c/e)+"s":c+"ms"}function d(c){var f=Math.abs(c);return f>=t?i(c,f,t,"day"):f>=n?i(c,f,n,"hour"):f>=r?i(c,f,r,"minute"):f>=e?i(c,f,e,"second"):c+" ms"}function i(c,f,s,a){var p=f>=s*1.5;return Math.round(c/s)+" "+a+(p?"s":"")}return ms}var common,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;function e(r){t.debug=t,t.default=t,t.coerce=i,t.disable=m,t.enable=l,t.enabled=d,t.humanize=requireMs(),t.destroy=c,Object.keys(r).forEach(f=>{t[f]=r[f]}),t.names=[],t.skips=[],t.formatters={};function n(f){let s=0;for(let a=0;a<f.length;a++)s=(s<<5)-s+f.charCodeAt(a),s|=0;return t.colors[Math.abs(s)%t.colors.length]}t.selectColor=n;function t(f){let s,a=null,p,h;function b(...g){if(!b.enabled)return;const y=b,S=Number(new Date),E=S-(s||S);y.diff=E,y.prev=s,y.curr=S,s=S,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let I=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(T,w)=>{if(T==="%%")return"%";I++;const F=t.formatters[w];if(typeof F=="function"){const P=g[I];T=F.call(y,P),g.splice(I,1),I--}return T}),t.formatArgs.call(y,g),(y.log||t.log).apply(y,g)}return b.namespace=f,b.useColors=t.useColors(),b.color=t.selectColor(f),b.extend=o,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(p!==t.namespaces&&(p=t.namespaces,h=t.enabled(f)),h),set:g=>{a=g}}),typeof t.init=="function"&&t.init(b),b}function o(f,s){const a=t(this.namespace+(typeof s>"u"?":":s)+f);return a.log=this.log,a}function l(f){t.save(f),t.namespaces=f,t.names=[],t.skips=[];const s=(typeof f=="string"?f:"").trim().replace(" ",",").split(",").filter(Boolean);for(const a of s)a[0]==="-"?t.skips.push(a.slice(1)):t.names.push(a)}function u(f,s){let a=0,p=0,h=-1,b=0;for(;a<f.length;)if(p<s.length&&(s[p]===f[a]||s[p]==="*"))s[p]==="*"?(h=p,b=a,p++):(a++,p++);else if(h!==-1)p=h+1,b++,a=b;else return!1;for(;p<s.length&&s[p]==="*";)p++;return p===s.length}function m(){const f=[...t.names,...t.skips.map(s=>"-"+s)].join(",");return t.enable(""),f}function d(f){for(const s of t.skips)if(u(f,s))return!1;for(const s of t.names)if(u(f,s))return!0;return!1}function i(f){return f instanceof Error?f.stack||f.message:f}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return common=e,common}var hasRequiredBrowser$3;function requireBrowser$3(){return hasRequiredBrowser$3||(hasRequiredBrowser$3=1,function(e,r){var n={};r.formatArgs=o,r.save=l,r.load=u,r.useColors=t,r.storage=m(),r.destroy=(()=>{let i=!1;return()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let i;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(i=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(i[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;i.splice(1,0,c,"color: inherit");let f=0,s=0;i[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(f++,a==="%c"&&(s=f))}),i.splice(s,0,c)}r.log=console.debug||console.log||(()=>{});function l(i){try{i?r.storage.setItem("debug",i):r.storage.removeItem("debug")}catch{}}function u(){let i;try{i=r.storage.getItem("debug")}catch{}return!i&&typeof process<"u"&&"env"in process&&(i=n.DEBUG),i}function m(){try{return localStorage}catch{}}e.exports=requireCommon()(r);const{formatters:d}=e.exports;d.j=function(i){try{return JSON.stringify(i)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}}(browser$3,browser$3.exports)),browser$3.exports}var core$2={},core$1={},ReadStreamTokenizer={},AbstractTokenizer={},lib$2={},EndOfFileStream={},hasRequiredEndOfFileStream;function requireEndOfFileStream(){return hasRequiredEndOfFileStream||(hasRequiredEndOfFileStream=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOfStreamError=e.defaultMessages=void 0,e.defaultMessages="End-Of-Stream";class r extends Error{constructor(){super(e.defaultMessages)}}e.EndOfStreamError=r}(EndOfFileStream)),EndOfFileStream}var StreamReader={},Deferred={},hasRequiredDeferred;function requireDeferred(){if(hasRequiredDeferred)return Deferred;hasRequiredDeferred=1,Object.defineProperty(Deferred,"__esModule",{value:!0}),Deferred.Deferred=void 0;let e=class{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((n,t)=>{this.reject=t,this.resolve=n})}};return Deferred.Deferred=e,Deferred}var hasRequiredStreamReader;function requireStreamReader(){return hasRequiredStreamReader||(hasRequiredStreamReader=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;const r=requireEndOfFileStream(),n=requireDeferred();var t=requireEndOfFileStream();Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return t.EndOfStreamError}});const o=1*1024*1024;class l{constructor(m){if(this.s=m,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!m.read||!m.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new r.EndOfStreamError)),this.s.once("error",d=>this.reject(d)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(m,d,i){const c=await this.read(m,d,i);return this.peekQueue.push(m.subarray(d,d+c)),c}async read(m,d,i){if(i===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new r.EndOfStreamError;let c=i,f=0;for(;this.peekQueue.length>0&&c>0;){const s=this.peekQueue.pop();if(!s)throw new Error("peekData should be defined");const a=Math.min(s.length,c);m.set(s.subarray(0,a),d+f),f+=a,c-=a,a<s.length&&this.peekQueue.push(s.subarray(a))}for(;c>0&&!this.endOfStream;){const s=Math.min(c,o),a=await this.readFromStream(m,d+f,s);if(f+=a,a<s)break;c-=a}return f}async readFromStream(m,d,i){const c=this.s.read(i);if(c)return m.set(c,d),c.length;{const f={buffer:m,offset:d,length:i,deferred:new n.Deferred};return this.deferred=f.deferred,this.s.once("readable",()=>{this.readDeferred(f)}),f.deferred.promise}}readDeferred(m){const d=this.s.read(m.length);d?(m.buffer.set(d,m.offset),m.deferred.resolve(d.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(m)})}reject(m){this.endOfStream=!0,this.deferred&&(this.deferred.reject(m),this.deferred=null)}}e.StreamReader=l}(StreamReader)),StreamReader}var hasRequiredLib$3;function requireLib$3(){return hasRequiredLib$3||(hasRequiredLib$3=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;var r=requireEndOfFileStream();Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return r.EndOfStreamError}});var n=requireStreamReader();Object.defineProperty(e,"StreamReader",{enumerable:!0,get:function(){return n.StreamReader}})}(lib$2)),lib$2}var hasRequiredAbstractTokenizer;function requireAbstractTokenizer(){if(hasRequiredAbstractTokenizer)return AbstractTokenizer;hasRequiredAbstractTokenizer=1,Object.defineProperty(AbstractTokenizer,"__esModule",{value:!0}),AbstractTokenizer.AbstractTokenizer=void 0;const e=requireLib$3();let r=class{constructor(t){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=t||{}}async readToken(t,o=this.position){const l=Buffer.alloc(t.len);if(await this.readBuffer(l,{position:o})<t.len)throw new e.EndOfStreamError;return t.get(l,0)}async peekToken(t,o=this.position){const l=Buffer.alloc(t.len);if(await this.peekBuffer(l,{position:o})<t.len)throw new e.EndOfStreamError;return t.get(l,0)}async readNumber(t){if(await this.readBuffer(this.numBuffer,{length:t.len})<t.len)throw new e.EndOfStreamError;return t.get(this.numBuffer,0)}async peekNumber(t){if(await this.peekBuffer(this.numBuffer,{length:t.len})<t.len)throw new e.EndOfStreamError;return t.get(this.numBuffer,0)}async ignore(t){if(this.fileInfo.size!==void 0){const o=this.fileInfo.size-this.position;if(t>o)return this.position+=o,o}return this.position+=t,t}async close(){}normalizeOptions(t,o){if(o&&o.position!==void 0&&o.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return o?{mayBeLess:o.mayBeLess===!0,offset:o.offset?o.offset:0,length:o.length?o.length:t.length-(o.offset?o.offset:0),position:o.position?o.position:this.position}:{mayBeLess:!1,offset:0,length:t.length,position:this.position}}};return AbstractTokenizer.AbstractTokenizer=r,AbstractTokenizer}var hasRequiredReadStreamTokenizer;function requireReadStreamTokenizer(){if(hasRequiredReadStreamTokenizer)return ReadStreamTokenizer;hasRequiredReadStreamTokenizer=1,Object.defineProperty(ReadStreamTokenizer,"__esModule",{value:!0}),ReadStreamTokenizer.ReadStreamTokenizer=void 0;const e=requireAbstractTokenizer(),r=requireLib$3(),n=256e3;let t=class extends e.AbstractTokenizer{constructor(l,u){super(u),this.streamReader=new r.StreamReader(l)}async getFileInfo(){return this.fileInfo}async readBuffer(l,u){const m=this.normalizeOptions(l,u),d=m.position-this.position;if(d>0)return await this.ignore(d),this.readBuffer(l,u);if(d<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(m.length===0)return 0;const i=await this.streamReader.read(l,m.offset,m.length);if(this.position+=i,(!u||!u.mayBeLess)&&i<m.length)throw new r.EndOfStreamError;return i}async peekBuffer(l,u){const m=this.normalizeOptions(l,u);let d=0;if(m.position){const i=m.position-this.position;if(i>0){const c=new Uint8Array(m.length+i);return d=await this.peekBuffer(c,{mayBeLess:m.mayBeLess}),l.set(c.subarray(i),m.offset),d-i}else if(i<0)throw new Error("Cannot peek from a negative offset in a stream")}if(m.length>0){try{d=await this.streamReader.peek(l,m.offset,m.length)}catch(i){if(u&&u.mayBeLess&&i instanceof r.EndOfStreamError)return 0;throw i}if(!m.mayBeLess&&d<m.length)throw new r.EndOfStreamError}return d}async ignore(l){const u=Math.min(n,l),m=new Uint8Array(u);let d=0;for(;d<l;){const i=l-d,c=await this.readBuffer(m,{length:Math.min(u,i)});if(c<0)return c;d+=c}return d}};return ReadStreamTokenizer.ReadStreamTokenizer=t,ReadStreamTokenizer}var BufferTokenizer={},hasRequiredBufferTokenizer;function requireBufferTokenizer(){if(hasRequiredBufferTokenizer)return BufferTokenizer;hasRequiredBufferTokenizer=1,Object.defineProperty(BufferTokenizer,"__esModule",{value:!0}),BufferTokenizer.BufferTokenizer=void 0;const e=requireLib$3(),r=requireAbstractTokenizer();let n=class extends r.AbstractTokenizer{constructor(o,l){super(l),this.uint8Array=o,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:o.length}async readBuffer(o,l){if(l&&l.position){if(l.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=l.position}const u=await this.peekBuffer(o,l);return this.position+=u,u}async peekBuffer(o,l){const u=this.normalizeOptions(o,l),m=Math.min(this.uint8Array.length-u.position,u.length);if(!u.mayBeLess&&m<u.length)throw new e.EndOfStreamError;return o.set(this.uint8Array.subarray(u.position,u.position+m),u.offset),m}async close(){}};return BufferTokenizer.BufferTokenizer=n,BufferTokenizer}var hasRequiredCore$2;function requireCore$2(){return hasRequiredCore$2||(hasRequiredCore$2=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fromBuffer=e.fromStream=e.EndOfStreamError=void 0;const r=requireReadStreamTokenizer(),n=requireBufferTokenizer();var t=requireLib$3();Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return t.EndOfStreamError}});function o(u,m){return m=m||{},new r.ReadStreamTokenizer(u,m)}e.fromStream=o;function l(u,m){return new n.BufferTokenizer(u,m)}e.fromBuffer=l}(core$1)),core$1}var ParserFactory={},lib$1={},hasRequiredLib$2;function requireLib$2(){return hasRequiredLib$2||(hasRequiredLib$2=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnsiStringType=e.StringType=e.BufferType=e.Uint8ArrayType=e.IgnoreType=e.Float80_LE=e.Float80_BE=e.Float64_LE=e.Float64_BE=e.Float32_LE=e.Float32_BE=e.Float16_LE=e.Float16_BE=e.INT64_BE=e.UINT64_BE=e.INT64_LE=e.UINT64_LE=e.INT32_LE=e.INT32_BE=e.INT24_BE=e.INT24_LE=e.INT16_LE=e.INT16_BE=e.INT8=e.UINT32_BE=e.UINT32_LE=e.UINT24_BE=e.UINT24_LE=e.UINT16_BE=e.UINT16_LE=e.UINT8=void 0;const r=requireIeee754();function n(d){return new DataView(d.buffer,d.byteOffset)}e.UINT8={len:1,get(d,i){return n(d).getUint8(i)},put(d,i,c){return n(d).setUint8(i,c),i+1}},e.UINT16_LE={len:2,get(d,i){return n(d).getUint16(i,!0)},put(d,i,c){return n(d).setUint16(i,c,!0),i+2}},e.UINT16_BE={len:2,get(d,i){return n(d).getUint16(i)},put(d,i,c){return n(d).setUint16(i,c),i+2}},e.UINT24_LE={len:3,get(d,i){const c=n(d);return c.getUint8(i)+(c.getUint16(i+1,!0)<<8)},put(d,i,c){const f=n(d);return f.setUint8(i,c&255),f.setUint16(i+1,c>>8,!0),i+3}},e.UINT24_BE={len:3,get(d,i){const c=n(d);return(c.getUint16(i)<<8)+c.getUint8(i+2)},put(d,i,c){const f=n(d);return f.setUint16(i,c>>8),f.setUint8(i+2,c&255),i+3}},e.UINT32_LE={len:4,get(d,i){return n(d).getUint32(i,!0)},put(d,i,c){return n(d).setUint32(i,c,!0),i+4}},e.UINT32_BE={len:4,get(d,i){return n(d).getUint32(i)},put(d,i,c){return n(d).setUint32(i,c),i+4}},e.INT8={len:1,get(d,i){return n(d).getInt8(i)},put(d,i,c){return n(d).setInt8(i,c),i+1}},e.INT16_BE={len:2,get(d,i){return n(d).getInt16(i)},put(d,i,c){return n(d).setInt16(i,c),i+2}},e.INT16_LE={len:2,get(d,i){return n(d).getInt16(i,!0)},put(d,i,c){return n(d).setInt16(i,c,!0),i+2}},e.INT24_LE={len:3,get(d,i){const c=e.UINT24_LE.get(d,i);return c>8388607?c-16777216:c},put(d,i,c){const f=n(d);return f.setUint8(i,c&255),f.setUint16(i+1,c>>8,!0),i+3}},e.INT24_BE={len:3,get(d,i){const c=e.UINT24_BE.get(d,i);return c>8388607?c-16777216:c},put(d,i,c){const f=n(d);return f.setUint16(i,c>>8),f.setUint8(i+2,c&255),i+3}},e.INT32_BE={len:4,get(d,i){return n(d).getInt32(i)},put(d,i,c){return n(d).setInt32(i,c),i+4}},e.INT32_LE={len:4,get(d,i){return n(d).getInt32(i,!0)},put(d,i,c){return n(d).setInt32(i,c,!0),i+4}},e.UINT64_LE={len:8,get(d,i){return n(d).getBigUint64(i,!0)},put(d,i,c){return n(d).setBigUint64(i,c,!0),i+8}},e.INT64_LE={len:8,get(d,i){return n(d).getBigInt64(i,!0)},put(d,i,c){return n(d).setBigInt64(i,c,!0),i+8}},e.UINT64_BE={len:8,get(d,i){return n(d).getBigUint64(i)},put(d,i,c){return n(d).setBigUint64(i,c),i+8}},e.INT64_BE={len:8,get(d,i){return n(d).getBigInt64(i)},put(d,i,c){return n(d).setBigInt64(i,c),i+8}},e.Float16_BE={len:2,get(d,i){return r.read(d,i,!1,10,this.len)},put(d,i,c){return r.write(d,c,i,!1,10,this.len),i+this.len}},e.Float16_LE={len:2,get(d,i){return r.read(d,i,!0,10,this.len)},put(d,i,c){return r.write(d,c,i,!0,10,this.len),i+this.len}},e.Float32_BE={len:4,get(d,i){return n(d).getFloat32(i)},put(d,i,c){return n(d).setFloat32(i,c),i+4}},e.Float32_LE={len:4,get(d,i){return n(d).getFloat32(i,!0)},put(d,i,c){return n(d).setFloat32(i,c,!0),i+4}},e.Float64_BE={len:8,get(d,i){return n(d).getFloat64(i)},put(d,i,c){return n(d).setFloat64(i,c),i+8}},e.Float64_LE={len:8,get(d,i){return n(d).getFloat64(i,!0)},put(d,i,c){return n(d).setFloat64(i,c,!0),i+8}},e.Float80_BE={len:10,get(d,i){return r.read(d,i,!1,63,this.len)},put(d,i,c){return r.write(d,c,i,!1,63,this.len),i+this.len}},e.Float80_LE={len:10,get(d,i){return r.read(d,i,!0,63,this.len)},put(d,i,c){return r.write(d,c,i,!0,63,this.len),i+this.len}};class t{constructor(i){this.len=i}get(i,c){}}e.IgnoreType=t;class o{constructor(i){this.len=i}get(i,c){return i.subarray(c,c+this.len)}}e.Uint8ArrayType=o;class l{constructor(i){this.len=i}get(i,c){return Buffer.from(i.subarray(c,c+this.len))}}e.BufferType=l;class u{constructor(i,c){this.len=i,this.encoding=c}get(i,c){return Buffer.from(i).toString(this.encoding,c,c+this.len)}}e.StringType=u;class m{constructor(i){this.len=i}static decode(i,c,f){let s="";for(let a=c;a<f;++a)s+=m.codePointToString(m.singleByteDecoder(i[a]));return s}static inRange(i,c,f){return c<=i&&i<=f}static codePointToString(i){return i<=65535?String.fromCharCode(i):(i-=65536,String.fromCharCode((i>>10)+55296,(i&1023)+56320))}static singleByteDecoder(i){if(m.inRange(i,0,127))return i;const c=m.windows1252[i-128];if(c===null)throw Error("invaliding encoding");return c}get(i,c=0){return m.decode(i,c,c+this.len)}}e.AnsiStringType=m,m.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}(lib$1)),lib$1}var util$1={},hasRequiredUtil$2;function requireUtil$2(){return hasRequiredUtil$2||(hasRequiredUtil$2=1,util$1.stringToBytes=e=>[...e].map(r=>r.charCodeAt(0)),util$1.tarHeaderChecksumMatches=(e,r=0)=>{const n=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(n))return!1;let t=8*32;for(let o=r;o<r+148;o++)t+=e[o];for(let o=r+156;o<r+512;o++)t+=e[o];return n===t},util$1.uint32SyncSafeToken={get:(e,r)=>e[r+3]&127|e[r+2]<<7|e[r+1]<<14|e[r]<<21,len:4}),util$1}var supported,hasRequiredSupported;function requireSupported(){return hasRequiredSupported||(hasRequiredSupported=1,supported={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}),supported}var core,hasRequiredCore$1;function requireCore$1(){if(hasRequiredCore$1)return core;hasRequiredCore$1=1;const Token=requireLib$2(),strtok3=requireCore$2(),{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=requireUtil$2(),supported=requireSupported(),minimumBytes=4100;async function fromStream(e){const r=await strtok3.fromStream(e);try{return await fromTokenizer(r)}finally{await r.close()}}async function fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const r=e instanceof Buffer?e:Buffer.from(e);if(!(r&&r.length>1))return;const n=strtok3.fromBuffer(r);return fromTokenizer(n)}function _check(e,r,n){n={offset:0,...n};for(const[t,o]of r.entries())if(n.mask){if(o!==(n.mask[t]&e[t+n.offset]))return!1}else if(o!==e[t+n.offset])return!1;return!0}async function fromTokenizer(e){try{return _fromTokenizer(e)}catch(r){if(!(r instanceof strtok3.EndOfStreamError))throw r}}async function _fromTokenizer(e){let r=Buffer.alloc(minimumBytes);const n=12,t=(l,u)=>_check(r,l,u),o=(l,u)=>t(stringToBytes(l),u);if(e.fileInfo.size||(e.fileInfo.size=Number.MAX_SAFE_INTEGER),await e.peekBuffer(r,{length:n,mayBeLess:!0}),t([66,77]))return{ext:"bmp",mime:"image/bmp"};if(t([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(t([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(t([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(t([37,33]))return await e.peekBuffer(r,{length:24,mayBeLess:!0}),o("PS-Adobe-",{offset:2})&&o(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(t([31,160])||t([31,157]))return{ext:"Z",mime:"application/x-compress"};if(t([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(t([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(t([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(t([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(o("ID3")){await e.ignore(6);const l=await e.readToken(uint32SyncSafeToken);return e.position+l>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(l),fromTokenizer(e))}if(o("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((r[0]===67||r[0]===70)&&t([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(t([71,73,70]))return{ext:"gif",mime:"image/gif"};if(o("FLIF"))return{ext:"flif",mime:"image/flif"};if(o("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(o("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(o("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(o("FORM"))return{ext:"aif",mime:"audio/aiff"};if(o("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(t([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(r,{length:30});const l={compressedSize:r.readUInt32LE(18),uncompressedSize:r.readUInt32LE(22),filenameLength:r.readUInt16LE(26),extraFieldLength:r.readUInt16LE(28)};if(l.filename=await e.readToken(new Token.StringType(l.filenameLength,"utf-8")),await e.ignore(l.extraFieldLength),l.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(l.filename.endsWith(".rels")||l.filename.endsWith(".xml"))switch(l.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(l.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(l.filename.startsWith("3D/")&&l.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(l.filename==="mimetype"&&l.compressedSize===l.uncompressedSize)switch(await e.readToken(new Token.StringType(l.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if(l.compressedSize===0){let u=-1;for(;u<0&&e.position<e.fileInfo.size;)await e.peekBuffer(r,{mayBeLess:!0}),u=r.indexOf("504B0304",0,"hex"),await e.ignore(u>=0?u:r.length)}else await e.ignore(l.compressedSize)}}catch(l){if(!(l instanceof strtok3.EndOfStreamError))throw l}return{ext:"zip",mime:"application/zip"}}if(o("OggS")){await e.ignore(28);const l=Buffer.alloc(8);return await e.readBuffer(l),_check(l,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(l,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(l,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(l,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(l,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(l,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(t([80,75])&&(r[2]===3||r[2]===5||r[2]===7)&&(r[3]===4||r[3]===6||r[3]===8))return{ext:"zip",mime:"application/zip"};if(o("ftyp",{offset:4})&&(r[8]&96)!==0){const l=r.toString("binary",8,12).replace("\0"," ").trim();switch(l){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return l.startsWith("3g")?l.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(o("MThd"))return{ext:"mid",mime:"audio/midi"};if(o("wOFF")&&(t([0,1,0,0],{offset:4})||o("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(o("wOF2")&&(t([0,1,0,0],{offset:4})||o("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(t([212,195,178,161])||t([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(o("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(o("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(o("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(t([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(o("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(o("%PDF")){await e.ignore(1350);const l=10*1024*1024,u=Buffer.alloc(Math.min(l,e.fileInfo.size));return await e.readBuffer(u,{mayBeLess:!0}),u.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(t([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(t([73,73,42,0]))return o("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:t([28,0,254,0],{offset:8})||t([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:t([8,0,0,0],{offset:4})&&(t([45,0,254,0],{offset:8})||t([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(r=Buffer.alloc(24),await e.peekBuffer(r),(t([16,251,134,1],{offset:4})||t([8,0,0,0],{offset:4}))&&t([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(t([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(o("MAC "))return{ext:"ape",mime:"audio/ape"};if(t([26,69,223,163])){async function l(){const c=await e.peekNumber(Token.UINT8);let f=128,s=0;for(;(c&f)===0&&f!==0;)++s,f>>=1;const a=Buffer.alloc(s+1);return await e.readBuffer(a),a}async function u(){const c=await l(),f=await l();f[0]^=128>>f.length-1;const s=Math.min(6,f.length);return{id:c.readUIntBE(0,c.length),len:f.readUIntBE(f.length-s,s)}}async function m(c,f){for(;f>0;){const s=await u();if(s.id===17026)return e.readToken(new Token.StringType(s.len,"utf-8"));await e.ignore(s.len),--f}}const d=await u();switch(await m(1,d.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(t([82,73,70,70])){if(t([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(t([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(t([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(o("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(t([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(o("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(o("MSCF")||o("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(t([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(t([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(t([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(t([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(o("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(o("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(t([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(o("IMPM"))return{ext:"it",mime:"audio/x-it"};if(o("-lh0-",{offset:2})||o("-lh1-",{offset:2})||o("-lh2-",{offset:2})||o("-lh3-",{offset:2})||o("-lh4-",{offset:2})||o("-lh5-",{offset:2})||o("-lh6-",{offset:2})||o("-lh7-",{offset:2})||o("-lzs-",{offset:2})||o("-lz4-",{offset:2})||o("-lz5-",{offset:2})||o("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(t([0,0,1,186])){if(t([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(t([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(o("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(t([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(o("<?xml "))return{ext:"xml",mime:"application/xml"};if(t([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(t([82,97,114,33,26,7])&&(r[6]===0||r[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(o("solid "))return{ext:"stl",mime:"model/stl"};if(o("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(o("!<arch>"))return await e.ignore(8),await e.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(t([137,80,78,71,13,10,26,10])){await e.ignore(8);async function l(){return{length:await e.readToken(Token.INT32_BE),type:await e.readToken(new Token.StringType(4,"binary"))}}do{const u=await l();if(u.length<0)return;switch(u.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(u.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(t([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(t([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(t([102,114,101,101],{offset:4})||t([109,100,97,116],{offset:4})||t([109,111,111,118],{offset:4})||t([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(t([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(o("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(t([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(t([48,38,178,117,142,102,207,17,166,217])){async function l(){const u=Buffer.alloc(16);return await e.readBuffer(u),{id:u,size:Number(await e.readToken(Token.UINT64_LE))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const u=await l();let m=u.size-24;if(_check(u.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const d=Buffer.alloc(16);if(m-=await e.readBuffer(d),_check(d,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(d,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(m)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(t([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((t([126,16,4])||t([126,24,4]))&&t([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(t([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(t([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(t([255,10])||t([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(t([0,0,1,186])||t([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(t([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(t([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(t([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(t([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(r,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),o("BEGIN:")){if(o("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(o("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(o("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(o("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(o("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(t([4,0,0,0])&&r.length>=16){const l=r.readUInt32LE(12);if(l>12&&r.length>=l+16)try{const u=r.slice(16,l+16).toString();if(JSON.parse(u).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(t([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(o("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(t([71],{offset:4})&&(t([71],{offset:192})||t([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(t([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(t([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(t([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(t([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(t([76,80],{offset:34})&&(t([0,0,1],{offset:8})||t([1,0,2],{offset:8})||t([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(t([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(r,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(r))return{ext:"tar",mime:"application/x-tar"};if(t([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(o("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(r.length>=2&&t([255,224],{offset:0,mask:[255,224]})){if(t([16],{offset:1,mask:[22]}))return t([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(t([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(t([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const e=new stream.PassThrough;let r;stream.pipeline?r=stream.pipeline(readableStream,e,()=>{}):r=readableStream.pipe(e);const n=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const t=await fromBuffer(n);e.fileType=t}catch(t){reject(t)}resolve(r)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream};return Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}}),core=fileType,core}var contentType={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var hasRequiredContentType;function requireContentType(){if(hasRequiredContentType)return contentType;hasRequiredContentType=1;var e=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,r=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,t=/\\([\u000b\u0020-\u00ff])/g,o=/([\\"])/g,l=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;contentType.format=u,contentType.parse=m;function u(f){if(!f||typeof f!="object")throw new TypeError("argument obj is required");var s=f.parameters,a=f.type;if(!a||!l.test(a))throw new TypeError("invalid type");var p=a;if(s&&typeof s=="object")for(var h,b=Object.keys(s).sort(),g=0;g<b.length;g++){if(h=b[g],!n.test(h))throw new TypeError("invalid parameter name");p+="; "+h+"="+i(s[h])}return p}function m(f){if(!f)throw new TypeError("argument string is required");var s=typeof f=="object"?d(f):f;if(typeof s!="string")throw new TypeError("argument string is required to be a string");var a=s.indexOf(";"),p=a!==-1?s.slice(0,a).trim():s.trim();if(!l.test(p))throw new TypeError("invalid media type");var h=new c(p.toLowerCase());if(a!==-1){var b,g,y;for(e.lastIndex=a;g=e.exec(s);){if(g.index!==a)throw new TypeError("invalid parameter format");a+=g[0].length,b=g[1].toLowerCase(),y=g[2],y.charCodeAt(0)===34&&(y=y.slice(1,-1),y.indexOf("\\")!==-1&&(y=y.replace(t,"$1"))),h.parameters[b]=y}if(a!==s.length)throw new TypeError("invalid parameter format")}return h}function d(f){var s;if(typeof f.getHeader=="function"?s=f.getHeader("content-type"):typeof f.headers=="object"&&(s=f.headers&&f.headers["content-type"]),typeof s!="string")throw new TypeError("content-type header is missing from object");return s}function i(f){var s=String(f);if(n.test(s))return s;if(s.length>0&&!r.test(s))throw new TypeError("invalid parameter value");return'"'+s.replace(o,"\\$1")+'"'}function c(f){this.parameters=Object.create(null),this.type=f}return contentType}var mediaTyper={};/*!
 * media-typer
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var hasRequiredMediaTyper;function requireMediaTyper(){if(hasRequiredMediaTyper)return mediaTyper;hasRequiredMediaTyper=1;var e=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,r=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,n=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;mediaTyper.format=t,mediaTyper.parse=l,mediaTyper.test=o;function t(m){if(!m||typeof m!="object")throw new TypeError("argument obj is required");var d=m.subtype,i=m.suffix,c=m.type;if(!c||!r.test(c))throw new TypeError("invalid type");if(!d||!e.test(d))throw new TypeError("invalid subtype");var f=c+"/"+d;if(i){if(!r.test(i))throw new TypeError("invalid suffix");f+="+"+i}return f}function o(m){if(!m)throw new TypeError("argument string is required");if(typeof m!="string")throw new TypeError("argument string is required to be a string");return n.test(m.toLowerCase())}function l(m){if(!m)throw new TypeError("argument string is required");if(typeof m!="string")throw new TypeError("argument string is required to be a string");var d=n.exec(m.toLowerCase());if(!d)throw new TypeError("invalid media type");var i=d[1],c=d[2],f,s=c.lastIndexOf("+");return s!==-1&&(f=c.substr(s+1),c=c.substr(0,s)),new u(i,c,f)}function u(m,d,i){this.type=m,this.subtype=d,this.suffix=i}return mediaTyper}var MetadataCollector={},type={},types={},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TrackType=e.TargetType=e.DataType=void 0,function(r){r[r.string=0]="string",r[r.uint=1]="uint",r[r.uid=2]="uid",r[r.bool=3]="bool",r[r.binary=4]="binary",r[r.float=5]="float"}(e.DataType||(e.DataType={})),function(r){r[r.shot=10]="shot",r[r.scene=20]="scene",r[r.track=30]="track",r[r.part=40]="part",r[r.album=50]="album",r[r.edition=60]="edition",r[r.collection=70]="collection"}(e.TargetType||(e.TargetType={})),function(r){r[r.video=1]="video",r[r.audio=2]="audio",r[r.complex=3]="complex",r[r.logo=4]="logo",r[r.subtitle=17]="subtitle",r[r.button=18]="button",r[r.control=32]="control"}(e.TrackType||(e.TrackType={}))}(types)),types}var hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TrackType=void 0;var r=requireTypes();Object.defineProperty(e,"TrackType",{enumerable:!0,get:function(){return r.TrackType}})}(type)),type}var GenericTagTypes={},hasRequiredGenericTagTypes;function requireGenericTagTypes(){return hasRequiredGenericTagTypes||(hasRequiredGenericTagTypes=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isUnique=e.isSingleton=e.commonTags=void 0,e.commonTags={year:{multiple:!1},track:{multiple:!1},disk:{multiple:!1},title:{multiple:!1},artist:{multiple:!1},artists:{multiple:!0,unique:!0},albumartist:{multiple:!1},album:{multiple:!1},date:{multiple:!1},originaldate:{multiple:!1},originalyear:{multiple:!1},comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:{multiple:!1},subtitle:{multiple:!0},discsubtitle:{multiple:!1},totaltracks:{multiple:!1},totaldiscs:{multiple:!1},compilation:{multiple:!1},rating:{multiple:!0},bpm:{multiple:!1},mood:{multiple:!1},media:{multiple:!1},catalognumber:{multiple:!0,unique:!0},tvShow:{multiple:!1},tvShowSort:{multiple:!1},tvSeason:{multiple:!1},tvEpisode:{multiple:!1},tvEpisodeId:{multiple:!1},tvNetwork:{multiple:!1},podcast:{multiple:!1},podcasturl:{multiple:!1},releasestatus:{multiple:!1},releasetype:{multiple:!0},releasecountry:{multiple:!1},script:{multiple:!1},language:{multiple:!1},copyright:{multiple:!1},license:{multiple:!1},encodedby:{multiple:!1},encodersettings:{multiple:!1},gapless:{multiple:!1},barcode:{multiple:!1},isrc:{multiple:!0},asin:{multiple:!1},musicbrainz_recordingid:{multiple:!1},musicbrainz_trackid:{multiple:!1},musicbrainz_albumid:{multiple:!1},musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:{multiple:!1},musicbrainz_workid:{multiple:!1},musicbrainz_trmid:{multiple:!1},musicbrainz_discid:{multiple:!1},acoustid_id:{multiple:!1},acoustid_fingerprint:{multiple:!1},musicip_puid:{multiple:!1},musicip_fingerprint:{multiple:!1},website:{multiple:!1},"performer:instrument":{multiple:!0,unique:!0},averageLevel:{multiple:!1},peakLevel:{multiple:!1},notes:{multiple:!0,unique:!1},key:{multiple:!1},originalalbum:{multiple:!1},originalartist:{multiple:!1},discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:{multiple:!1},discogs_label_id:{multiple:!1},discogs_master_release_id:{multiple:!1},discogs_votes:{multiple:!1},discogs_rating:{multiple:!1},replaygain_track_peak:{multiple:!1},replaygain_track_gain:{multiple:!1},replaygain_album_peak:{multiple:!1},replaygain_album_gain:{multiple:!1},replaygain_track_minmax:{multiple:!1},replaygain_album_minmax:{multiple:!1},replaygain_undo:{multiple:!1},description:{multiple:!0},longDescription:{multiple:!1},category:{multiple:!0},hdVideo:{multiple:!1},keywords:{multiple:!0},movement:{multiple:!1},movementIndex:{multiple:!1},movementTotal:{multiple:!1},podcastId:{multiple:!1},showMovement:{multiple:!1},stik:{multiple:!1}};function r(t){return e.commonTags.hasOwnProperty(t)&&!e.commonTags[t].multiple}e.isSingleton=r;function n(t){return!e.commonTags[t].multiple||e.commonTags[t].unique}e.isUnique=n}(GenericTagTypes)),GenericTagTypes}var CombinedTagMapper={},ID3v1TagMap={},GenericTagMapper={},hasRequiredGenericTagMapper;function requireGenericTagMapper(){if(hasRequiredGenericTagMapper)return GenericTagMapper;hasRequiredGenericTagMapper=1,Object.defineProperty(GenericTagMapper,"__esModule",{value:!0}),GenericTagMapper.CommonTagMapper=void 0;class e{static toIntOrNull(n){const t=parseInt(n,10);return isNaN(t)?null:t}static normalizeTrack(n){const t=n.toString().split("/");return{no:parseInt(t[0],10)||null,of:parseInt(t[1],10)||null}}constructor(n,t){this.tagTypes=n,this.tagMap=t}mapGenericTag(n,t){n={id:n.id,value:n.value},this.postMap(n,t);const o=this.getCommonName(n.id);return o?{id:o,value:n.value}:null}getCommonName(n){return this.tagMap[n]}postMap(n,t){}}return e.maxRatingScore=1,GenericTagMapper.CommonTagMapper=e,GenericTagMapper}var hasRequiredID3v1TagMap;function requireID3v1TagMap(){if(hasRequiredID3v1TagMap)return ID3v1TagMap;hasRequiredID3v1TagMap=1,Object.defineProperty(ID3v1TagMap,"__esModule",{value:!0}),ID3v1TagMap.ID3v1TagMapper=void 0;const e=requireGenericTagMapper(),r={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class n extends e.CommonTagMapper{constructor(){super(["ID3v1"],r)}}return ID3v1TagMap.ID3v1TagMapper=n,ID3v1TagMap}var ID3v24TagMapper={},CaseInsensitiveTagMap={},hasRequiredCaseInsensitiveTagMap;function requireCaseInsensitiveTagMap(){if(hasRequiredCaseInsensitiveTagMap)return CaseInsensitiveTagMap;hasRequiredCaseInsensitiveTagMap=1,Object.defineProperty(CaseInsensitiveTagMap,"__esModule",{value:!0}),CaseInsensitiveTagMap.CaseInsensitiveTagMap=void 0;const e=requireGenericTagMapper();let r=class extends e.CommonTagMapper{constructor(t,o){const l={};for(const u of Object.keys(o))l[u.toUpperCase()]=o[u];super(t,l)}getCommonName(t){return this.tagMap[t.toUpperCase()]}};return CaseInsensitiveTagMap.CaseInsensitiveTagMap=r,CaseInsensitiveTagMap}var Util={},hasRequiredUtil$1;function requireUtil$1(){if(hasRequiredUtil$1)return Util;hasRequiredUtil$1=1,Object.defineProperty(Util,"__esModule",{value:!0}),Util.toRatio=Util.dbToRatio=Util.ratioToDb=Util.a2hex=Util.isBitSet=Util.getBitAllignedNumber=Util.stripNulls=Util.decodeString=Util.trimRightNull=Util.findZero=Util.getBit=void 0;function e(s,a,p){return(s[a]&1<<p)!==0}Util.getBit=e;function r(s,a,p,h){let b=a;if(h==="utf16le"){for(;s[b]!==0||s[b+1]!==0;){if(b>=p)return p;b+=2}return b}else{for(;s[b]!==0;){if(b>=p)return p;b++}return b}}Util.findZero=r;function n(s){const a=s.indexOf("\0");return a===-1?s:s.substr(0,a)}Util.trimRightNull=n;function t(s){const a=s.length;if((a&1)!==0)throw new Error("Buffer length must be even");for(let p=0;p<a;p+=2){const h=s[p];s[p]=s[p+1],s[p+1]=h}return s}function o(s,a){if(s[0]===255&&s[1]===254)return o(s.subarray(2),a);if(a==="utf16le"&&s[0]===254&&s[1]===255){if((s.length&1)!==0)throw new Error("Expected even number of octets for 16-bit unicode string");return o(t(s),a)}return Buffer.from(s).toString(a)}Util.decodeString=o;function l(s){return s=s.replace(/^\x00+/g,""),s=s.replace(/\x00+$/g,""),s}Util.stripNulls=l;function u(s,a,p,h){const b=a+~~(p/8),g=p%8;let y=s[b];y&=255>>g;const S=8-g,E=h-S;return E<0?y>>=8-g-h:E>0&&(y<<=E,y|=u(s,a,p+S,E)),y}Util.getBitAllignedNumber=u;function m(s,a,p){return u(s,a,p,1)===1}Util.isBitSet=m;function d(s){const a=[];for(let p=0,h=s.length;p<h;p++){const b=Number(s.charCodeAt(p)).toString(16);a.push(b.length===1?"0"+b:b)}return a.join(" ")}Util.a2hex=d;function i(s){return 10*Math.log10(s)}Util.ratioToDb=i;function c(s){return Math.pow(10,s/10)}Util.dbToRatio=c;function f(s){const a=s.split(" ").map(p=>p.trim().toLowerCase());if(a.length>=1){const p=parseFloat(a[0]);return a.length===2&&a[1]==="db"?{dB:p,ratio:c(p)}:{dB:i(p),ratio:p}}}return Util.toRatio=f,Util}var hasRequiredID3v24TagMapper;function requireID3v24TagMapper(){if(hasRequiredID3v24TagMapper)return ID3v24TagMapper;hasRequiredID3v24TagMapper=1,Object.defineProperty(ID3v24TagMapper,"__esModule",{value:!0}),ID3v24TagMapper.ID3v24TagMapper=void 0;const e=requireGenericTagMapper(),r=requireCaseInsensitiveTagMap(),n=requireUtil$1(),t={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer","USLT:description":"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"date",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl"};let o=class Xe extends r.CaseInsensitiveTagMap{static toRating(u){return{source:u.email,rating:u.rating>0?(u.rating-1)/254*e.CommonTagMapper.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],t)}postMap(u,m){switch(u.id){case"UFID":u.value.owner_identifier==="http://musicbrainz.org"&&(u.id+=":"+u.value.owner_identifier,u.value=n.decodeString(u.value.identifier,"latin1"));break;case"PRIV":switch(u.value.owner_identifier){case"AverageLevel":case"PeakValue":u.id+=":"+u.value.owner_identifier,u.value=u.value.data.length===4?u.value.data.readUInt32LE(0):null,u.value===null&&m.addWarning("Failed to parse PRIV:PeakValue");break;default:m.addWarning(`Unknown PRIV owner-identifier: ${u.value.owner_identifier}`)}break;case"COMM":u.value=u.value?u.value.text:null;break;case"POPM":u.value=Xe.toRating(u.value);break}}};return ID3v24TagMapper.ID3v24TagMapper=o,ID3v24TagMapper}var AsfTagMapper={},hasRequiredAsfTagMapper;function requireAsfTagMapper(){if(hasRequiredAsfTagMapper)return AsfTagMapper;hasRequiredAsfTagMapper=1,Object.defineProperty(AsfTagMapper,"__esModule",{value:!0}),AsfTagMapper.AsfTagMapper=void 0;const e=requireGenericTagMapper(),r={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};let n=class Ye extends e.CommonTagMapper{static toRating(o){return{rating:parseFloat(o+1)/5}}constructor(){super(["asf"],r)}postMap(o){switch(o.id){case"WM/SharedUserRating":const l=o.id.split(":");o.value=Ye.toRating(o.value),o.id=l[0];break}}};return AsfTagMapper.AsfTagMapper=n,AsfTagMapper}var ID3v22TagMapper={},hasRequiredID3v22TagMapper;function requireID3v22TagMapper(){return hasRequiredID3v22TagMapper||(hasRequiredID3v22TagMapper=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ID3v22TagMapper=e.id3v22TagMap=void 0;const r=requireCaseInsensitiveTagMap();e.id3v22TagMap={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website","COM:iTunPGAP":"gapless",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class n extends r.CaseInsensitiveTagMap{constructor(){super(["ID3v2.2"],e.id3v22TagMap)}}e.ID3v22TagMapper=n}(ID3v22TagMapper)),ID3v22TagMapper}var APEv2TagMapper={},hasRequiredAPEv2TagMapper;function requireAPEv2TagMapper(){if(hasRequiredAPEv2TagMapper)return APEv2TagMapper;hasRequiredAPEv2TagMapper=1,Object.defineProperty(APEv2TagMapper,"__esModule",{value:!0}),APEv2TagMapper.APEv2TagMapper=void 0;const e=requireCaseInsensitiveTagMap(),r={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};let n=class extends e.CaseInsensitiveTagMap{constructor(){super(["APEv2"],r)}};return APEv2TagMapper.APEv2TagMapper=n,APEv2TagMapper}var MP4TagMapper={},hasRequiredMP4TagMapper;function requireMP4TagMapper(){return hasRequiredMP4TagMapper||(hasRequiredMP4TagMapper=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MP4TagMapper=e.tagType=void 0;const r=requireCaseInsensitiveTagMap(),n={"©nam":"title","©ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","©alb":"album","©day":"date","©cmt":"comment","©com":"comment",trkn:"track",disk:"disk","©gen":"genre",covr:"picture","©wrt":"composer","©lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","©grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","©cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","©too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear",desc:"description",ldes:"longDescription","©mvn":"movement","©mvi":"movementIndex","©mvc":"movementTotal","©wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};e.tagType="iTunes";class t extends r.CaseInsensitiveTagMap{constructor(){super([e.tagType],n)}postMap(l,u){switch(l.id){case"rate":l.value={source:void 0,rating:parseFloat(l.value)/100};break}}}e.MP4TagMapper=t}(MP4TagMapper)),MP4TagMapper}var VorbisTagMapper={},hasRequiredVorbisTagMapper;function requireVorbisTagMapper(){if(hasRequiredVorbisTagMapper)return VorbisTagMapper;hasRequiredVorbisTagMapper=1,Object.defineProperty(VorbisTagMapper,"__esModule",{value:!0}),VorbisTagMapper.VorbisTagMapper=void 0;const e=requireGenericTagMapper(),r={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};let n=class qe extends e.CommonTagMapper{static toRating(o,l,u){return{source:o&&o.toLowerCase(),rating:parseFloat(l)/u*e.CommonTagMapper.maxRatingScore}}constructor(){super(["vorbis"],r)}postMap(o){if(o.id==="RATING")o.value=qe.toRating(void 0,o.value,100);else if(o.id.indexOf("RATING:")===0){const l=o.id.split(":");o.value=qe.toRating(l[1],o.value,1),o.id=l[0]}}};return VorbisTagMapper.VorbisTagMapper=n,VorbisTagMapper}var RiffInfoTagMap={},hasRequiredRiffInfoTagMap;function requireRiffInfoTagMap(){return hasRequiredRiffInfoTagMap||(hasRequiredRiffInfoTagMap=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RiffInfoTagMapper=e.riffInfoTagMap=void 0;const r=requireGenericTagMapper();e.riffInfoTagMap={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class n extends r.CommonTagMapper{constructor(){super(["exif"],e.riffInfoTagMap)}}e.RiffInfoTagMapper=n}(RiffInfoTagMap)),RiffInfoTagMap}var MatroskaTagMapper={},hasRequiredMatroskaTagMapper;function requireMatroskaTagMapper(){if(hasRequiredMatroskaTagMapper)return MatroskaTagMapper;hasRequiredMatroskaTagMapper=1,Object.defineProperty(MatroskaTagMapper,"__esModule",{value:!0}),MatroskaTagMapper.MatroskaTagMapper=void 0;const e=requireCaseInsensitiveTagMap(),r={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};let n=class extends e.CaseInsensitiveTagMap{constructor(){super(["matroska"],r)}};return MatroskaTagMapper.MatroskaTagMapper=n,MatroskaTagMapper}var AiffTagMap={},hasRequiredAiffTagMap;function requireAiffTagMap(){if(hasRequiredAiffTagMap)return AiffTagMap;hasRequiredAiffTagMap=1,Object.defineProperty(AiffTagMap,"__esModule",{value:!0}),AiffTagMap.AiffTagMapper=void 0;const e=requireGenericTagMapper(),r={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class n extends e.CommonTagMapper{constructor(){super(["AIFF"],r)}}return AiffTagMap.AiffTagMapper=n,AiffTagMap}var hasRequiredCombinedTagMapper;function requireCombinedTagMapper(){if(hasRequiredCombinedTagMapper)return CombinedTagMapper;hasRequiredCombinedTagMapper=1,Object.defineProperty(CombinedTagMapper,"__esModule",{value:!0}),CombinedTagMapper.CombinedTagMapper=void 0;const e=requireID3v1TagMap(),r=requireID3v24TagMapper(),n=requireAsfTagMapper(),t=requireID3v22TagMapper(),o=requireAPEv2TagMapper(),l=requireMP4TagMapper(),u=requireVorbisTagMapper(),m=requireRiffInfoTagMap(),d=requireMatroskaTagMapper(),i=requireAiffTagMap();let c=class{constructor(){this.tagMappers={},[new e.ID3v1TagMapper,new t.ID3v22TagMapper,new r.ID3v24TagMapper,new l.MP4TagMapper,new l.MP4TagMapper,new u.VorbisTagMapper,new o.APEv2TagMapper,new n.AsfTagMapper,new m.RiffInfoTagMapper,new d.MatroskaTagMapper,new i.AiffTagMapper].forEach(s=>{this.registerTagMapper(s)})}mapTag(s,a,p){if(this.tagMappers[s])return this.tagMappers[s].mapGenericTag(a,p);throw new Error("No generic tag mapper defined for tag-format: "+s)}registerTagMapper(s){for(const a of s.tagTypes)this.tagMappers[a]=s}};return CombinedTagMapper.CombinedTagMapper=c,CombinedTagMapper}var hasRequiredMetadataCollector;function requireMetadataCollector(){if(hasRequiredMetadataCollector)return MetadataCollector;hasRequiredMetadataCollector=1,Object.defineProperty(MetadataCollector,"__esModule",{value:!0}),MetadataCollector.joinArtists=MetadataCollector.MetadataCollector=void 0;const e=requireType(),r=requireBrowser$3(),n=requireGenericTagTypes(),t=requireCombinedTagMapper(),o=requireGenericTagMapper(),l=requireUtil$1(),u=requireCore$1(),m=(0,r.default)("music-metadata:collector"),d=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];let i=class{constructor(s){this.opts=s,this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new t.CombinedTagMapper;let a=1;for(const p of d)this.originPriority[p]=a++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(s){m(`streamInfo: type=${e.TrackType[s.type]}, codec=${s.codecName}`),this.format.trackInfo.push(s)}setFormat(s,a){m(`format: ${s} = ${a}`),this.format[s]=a,this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:s,value:a}})}addTag(s,a,p){m(`tag ${s}.${a} = ${p}`),this.native[s]||(this.format.tagTypes.push(s),this.native[s]=[]),this.native[s].push({id:a,value:p}),this.toCommon(s,a,p)}addWarning(s){this.quality.warnings.push({message:s})}postMap(s,a){switch(a.id){case"artist":if(this.commonOrigin.artist===this.originPriority[s])return this.postMap("artificial",{id:"artists",value:a.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:a.value});break;case"artists":if((!this.common.artist||this.commonOrigin.artist===this.originPriority.artificial)&&(!this.common.artists||this.common.artists.indexOf(a.value)===-1)){const g=(this.common.artists||[]).concat([a.value]),S={id:"artist",value:c(g)};this.setGenericTag("artificial",S)}break;case"picture":this.postFixPicture(a.value).then(g=>{g!==null&&(a.value=g,this.setGenericTag(s,a))});return;case"totaltracks":this.common.track.of=o.CommonTagMapper.toIntOrNull(a.value);return;case"totaldiscs":this.common.disk.of=o.CommonTagMapper.toIntOrNull(a.value);return;case"movementTotal":this.common.movementIndex.of=o.CommonTagMapper.toIntOrNull(a.value);return;case"track":case"disk":case"movementIndex":const p=this.common[a.id].of;this.common[a.id]=o.CommonTagMapper.normalizeTrack(a.value),this.common[a.id].of=p??this.common[a.id].of;return;case"bpm":case"year":case"originalyear":a.value=parseInt(a.value,10);break;case"date":const h=parseInt(a.value.substr(0,4),10);isNaN(h)||(this.common.year=h);break;case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":a.value=typeof a.value=="string"?parseInt(a.value,10):a.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":a.value=(0,l.toRatio)(a.value);break;case"replaygain_track_minmax":a.value=a.value.split(",").map(g=>parseInt(g,10));break;case"replaygain_undo":const b=a.value.split(",").map(g=>parseInt(g,10));a.value={leftChannel:b[0],rightChannel:b[1]};break;case"gapless":case"compilation":case"podcast":case"showMovement":a.value=a.value==="1"||a.value===1;break;case"isrc":if(this.common[a.id]&&this.common[a.id].indexOf(a.value)!==-1)return;break}a.value!==null&&this.setGenericTag(s,a)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(s){if(s.data&&s.data.length>0){if(!s.format){const a=await u.fromBuffer(s.data);if(a)s.format=a.mime;else return null}switch(s.format=s.format.toLocaleLowerCase(),s.format){case"image/jpg":s.format="image/jpeg"}return s}return this.addWarning("Empty picture tag found"),null}toCommon(s,a,p){const h={id:a,value:p},b=this.tagMapper.mapTag(s,h,this);b&&this.postMap(s,b)}setGenericTag(s,a){m(`common.${a.id} = ${a.value}`);const p=this.commonOrigin[a.id]||1e3,h=this.originPriority[s];if((0,n.isSingleton)(a.id))if(h<=p)this.common[a.id]=a.value,this.commonOrigin[a.id]=h;else return m(`Ignore native tag (singleton): ${s}.${a.id} = ${a.value}`);else if(h===p)!(0,n.isUnique)(a.id)||this.common[a.id].indexOf(a.value)===-1?this.common[a.id].push(a.value):m(`Ignore duplicate value: ${s}.${a.id} = ${a.value}`);else if(h<p)this.common[a.id]=[a.value],this.commonOrigin[a.id]=h;else return m(`Ignore native tag (list): ${s}.${a.id} = ${a.value}`);this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:a.id,value:a.value}})}};MetadataCollector.MetadataCollector=i;function c(f){return f.length>2?f.slice(0,f.length-1).join(", ")+" & "+f[f.length-1]:f.join(" & ")}return MetadataCollector.joinArtists=c,MetadataCollector}var AiffParser={},ID3v2Parser={},FrameParser={},ID3v2Token={},hasRequiredID3v2Token;function requireID3v2Token(){return hasRequiredID3v2Token||(hasRequiredID3v2Token=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TextEncodingToken=e.ExtendedHeader=e.ID3v2Header=e.UINT32SYNCSAFE=e.AttachedPictureType=void 0;const r=requireLib$2(),n=requireUtil$1();(function(t){t[t.Other=0]="Other",t[t["32x32 pixels 'file icon' (PNG only)"]=1]="32x32 pixels 'file icon' (PNG only)",t[t["Other file icon"]=2]="Other file icon",t[t["Cover (front)"]=3]="Cover (front)",t[t["Cover (back)"]=4]="Cover (back)",t[t["Leaflet page"]=5]="Leaflet page",t[t["Media (e.g. label side of CD)"]=6]="Media (e.g. label side of CD)",t[t["Lead artist/lead performer/soloist"]=7]="Lead artist/lead performer/soloist",t[t["Artist/performer"]=8]="Artist/performer",t[t.Conductor=9]="Conductor",t[t["Band/Orchestra"]=10]="Band/Orchestra",t[t.Composer=11]="Composer",t[t["Lyricist/text writer"]=12]="Lyricist/text writer",t[t["Recording Location"]=13]="Recording Location",t[t["During recording"]=14]="During recording",t[t["During performance"]=15]="During performance",t[t["Movie/video screen capture"]=16]="Movie/video screen capture",t[t["A bright coloured fish"]=17]="A bright coloured fish",t[t.Illustration=18]="Illustration",t[t["Band/artist logotype"]=19]="Band/artist logotype",t[t["Publisher/Studio logotype"]=20]="Publisher/Studio logotype"})(e.AttachedPictureType||(e.AttachedPictureType={})),e.UINT32SYNCSAFE={get:(t,o)=>t[o+3]&127|t[o+2]<<7|t[o+1]<<14|t[o]<<21,len:4},e.ID3v2Header={len:10,get:(t,o)=>({fileIdentifier:new r.StringType(3,"ascii").get(t,o),version:{major:r.INT8.get(t,o+3),revision:r.INT8.get(t,o+4)},flags:{unsynchronisation:n.getBit(t,o+5,7),isExtendedHeader:n.getBit(t,o+5,6),expIndicator:n.getBit(t,o+5,5),footer:n.getBit(t,o+5,4)},size:e.UINT32SYNCSAFE.get(t,o+6)})},e.ExtendedHeader={len:10,get:(t,o)=>({size:r.UINT32_BE.get(t,o),extendedFlags:r.UINT16_BE.get(t,o+4),sizeOfPadding:r.UINT32_BE.get(t,o+6),crcDataPresent:n.getBit(t,o+4,31)})},e.TextEncodingToken={len:1,get:(t,o)=>{switch(t[o]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf16le",bom:!0};case 2:return{encoding:"utf16le",bom:!1};case 3:return{encoding:"utf8",bom:!1};default:return{encoding:"utf8",bom:!1}}}}}(ID3v2Token)),ID3v2Token}var ID3v1Parser={},BasicParser={},hasRequiredBasicParser;function requireBasicParser(){if(hasRequiredBasicParser)return BasicParser;hasRequiredBasicParser=1,Object.defineProperty(BasicParser,"__esModule",{value:!0}),BasicParser.BasicParser=void 0;let e=class{init(n,t,o){return this.metadata=n,this.tokenizer=t,this.options=o,this}};return BasicParser.BasicParser=e,BasicParser}var APEv2Parser={},APEv2Token={},FourCC={},hasRequiredFourCC;function requireFourCC(){return hasRequiredFourCC||(hasRequiredFourCC=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FourCcToken=void 0;const r=requireUtil$1(),n=/^[\x21-\x7e©][\x20-\x7e\x00()]{3}/;e.FourCcToken={len:4,get:(t,o)=>{const l=t.toString("binary",o,o+e.FourCcToken.len);if(!l.match(n))throw new Error(`FourCC contains invalid characters: ${r.a2hex(l)} "${l}"`);return l},put:(t,o,l)=>{const u=Buffer.from(l,"binary");if(u.length!==4)throw new Error("Invalid length");return u.copy(t,o)}}}(FourCC)),FourCC}var hasRequiredAPEv2Token;function requireAPEv2Token(){return hasRequiredAPEv2Token||(hasRequiredAPEv2Token=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isBitSet=e.parseTagFlags=e.TagField=e.TagItemHeader=e.TagFooter=e.Header=e.DescriptorParser=e.DataType=void 0;const r=requireLib$2(),n=requireFourCC();(function(u){u[u.text_utf8=0]="text_utf8",u[u.binary=1]="binary",u[u.external_info=2]="external_info",u[u.reserved=3]="reserved"})(e.DataType||(e.DataType={})),e.DescriptorParser={len:52,get:(u,m)=>({ID:n.FourCcToken.get(u,m),version:r.UINT32_LE.get(u,m+4)/1e3,descriptorBytes:r.UINT32_LE.get(u,m+8),headerBytes:r.UINT32_LE.get(u,m+12),seekTableBytes:r.UINT32_LE.get(u,m+16),headerDataBytes:r.UINT32_LE.get(u,m+20),apeFrameDataBytes:r.UINT32_LE.get(u,m+24),apeFrameDataBytesHigh:r.UINT32_LE.get(u,m+28),terminatingDataBytes:r.UINT32_LE.get(u,m+32),fileMD5:new r.Uint8ArrayType(16).get(u,m+36)})},e.Header={len:24,get:(u,m)=>({compressionLevel:r.UINT16_LE.get(u,m),formatFlags:r.UINT16_LE.get(u,m+2),blocksPerFrame:r.UINT32_LE.get(u,m+4),finalFrameBlocks:r.UINT32_LE.get(u,m+8),totalFrames:r.UINT32_LE.get(u,m+12),bitsPerSample:r.UINT16_LE.get(u,m+16),channel:r.UINT16_LE.get(u,m+18),sampleRate:r.UINT32_LE.get(u,m+20)})},e.TagFooter={len:32,get:(u,m)=>({ID:new r.StringType(8,"ascii").get(u,m),version:r.UINT32_LE.get(u,m+8),size:r.UINT32_LE.get(u,m+12),fields:r.UINT32_LE.get(u,m+16),flags:o(r.UINT32_LE.get(u,m+20))})},e.TagItemHeader={len:8,get:(u,m)=>({size:r.UINT32_LE.get(u,m),flags:o(r.UINT32_LE.get(u,m+4))})};const t=u=>new r.Uint8ArrayType(u.size-e.TagFooter.len);e.TagField=t;function o(u){return{containsHeader:l(u,31),containsFooter:l(u,30),isHeader:l(u,31),readOnly:l(u,0),dataType:(u&6)>>1}}e.parseTagFlags=o;function l(u,m){return(u&1<<m)!==0}e.isBitSet=l}(APEv2Token)),APEv2Token}var hasRequiredAPEv2Parser;function requireAPEv2Parser(){if(hasRequiredAPEv2Parser)return APEv2Parser;hasRequiredAPEv2Parser=1,Object.defineProperty(APEv2Parser,"__esModule",{value:!0}),APEv2Parser.APEv2Parser=void 0;const e=requireBrowser$3(),r=requireCore$2(),n=requireLib$2(),t=requireUtil$1(),o=requireBasicParser(),l=requireAPEv2Token(),u=(0,e.default)("music-metadata:parser:APEv2"),m="APEv2",d="APETAGEX";let i=class xe extends o.BasicParser{constructor(){super(...arguments),this.ape={}}static tryParseApeHeader(f,s,a){const p=new xe;return p.init(f,s,a),p.tryParseApeHeader()}static calculateDuration(f){let s=f.totalFrames>1?f.blocksPerFrame*(f.totalFrames-1):0;return s+=f.finalFrameBlocks,s/f.sampleRate}static async findApeFooterOffset(f,s){const a=Buffer.alloc(l.TagFooter.len);await f.randomRead(a,0,l.TagFooter.len,s-l.TagFooter.len);const p=l.TagFooter.get(a,0);if(p.ID==="APETAGEX")return u(`APE footer header at offset=${s}`),{footer:p,offset:s-p.size}}static parseTagFooter(f,s,a){const p=l.TagFooter.get(s,s.length-l.TagFooter.len);if(p.ID!==d)throw new Error("Unexpected APEv2 Footer ID preamble value.");r.fromBuffer(s);const h=new xe;return h.init(f,r.fromBuffer(s),a),h.parseTags(p)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<l.TagFooter.len){u("No APEv2 header found, end-of-file reached");return}const f=await this.tokenizer.peekToken(l.TagFooter);if(f.ID===d)return await this.tokenizer.ignore(l.TagFooter.len),this.parseTags(f);if(u(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const s=this.tokenizer.fileInfo.size-this.tokenizer.position,a=Buffer.alloc(s);return await this.tokenizer.readBuffer(a),xe.parseTagFooter(this.metadata,a,this.options)}}async parse(){const f=await this.tokenizer.readToken(l.DescriptorParser);if(f.ID!=="MAC ")throw new Error("Unexpected descriptor ID");this.ape.descriptor=f;const s=f.descriptorBytes-l.DescriptorParser.len,a=await(s>0?this.parseDescriptorExpansion(s):this.parseHeader());return await this.tokenizer.ignore(a.forwardBytes),this.tryParseApeHeader()}async parseTags(f){const s=Buffer.alloc(256);let a=f.size-l.TagFooter.len;u(`Parse APE tags at offset=${this.tokenizer.position}, size=${a}`);for(let p=0;p<f.fields;p++){if(a<l.TagItemHeader.len){this.metadata.addWarning(`APEv2 Tag-header: ${f.fields-p} items remaining, but no more tag data to read.`);break}const h=await this.tokenizer.readToken(l.TagItemHeader);a-=l.TagItemHeader.len+h.size,await this.tokenizer.peekBuffer(s,{length:Math.min(s.length,a)});let b=t.findZero(s,0,s.length);const g=await this.tokenizer.readToken(new n.StringType(b,"ascii"));switch(await this.tokenizer.ignore(1),a-=g.length+1,h.flags.dataType){case l.DataType.text_utf8:{const S=(await this.tokenizer.readToken(new n.StringType(h.size,"utf8"))).split(/\x00/g);for(const E of S)this.metadata.addTag(m,g,E);break}case l.DataType.binary:if(this.options.skipCovers)await this.tokenizer.ignore(h.size);else{const y=Buffer.alloc(h.size);await this.tokenizer.readBuffer(y),b=t.findZero(y,0,y.length);const S=y.toString("utf8",0,b),E=Buffer.from(y.slice(b+1));this.metadata.addTag(m,g,{description:S,data:E})}break;case l.DataType.external_info:u(`Ignore external info ${g}`),await this.tokenizer.ignore(h.size);break;case l.DataType.reserved:u(`Ignore external info ${g}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${g}"`),await this.tokenizer.ignore(h.size);break}}}async parseDescriptorExpansion(f){return await this.tokenizer.ignore(f),this.parseHeader()}async parseHeader(){const f=await this.tokenizer.readToken(l.Header);return this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",f.bitsPerSample),this.metadata.setFormat("sampleRate",f.sampleRate),this.metadata.setFormat("numberOfChannels",f.channel),this.metadata.setFormat("duration",xe.calculateDuration(f)),{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}};return APEv2Parser.APEv2Parser=i,APEv2Parser}var hasRequiredID3v1Parser;function requireID3v1Parser(){return hasRequiredID3v1Parser||(hasRequiredID3v1Parser=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasID3v1Header=e.ID3v1Parser=e.Genres=void 0;const r=requireBrowser$3(),n=requireLib$2(),t=requireUtil$1(),o=requireBasicParser(),l=requireAPEv2Parser(),u=(0,r.default)("music-metadata:parser:ID3v1");e.Genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"];const m={len:128,get:(f,s)=>{const a=new d(3).get(f,s);return a==="TAG"?{header:a,title:new d(30).get(f,s+3),artist:new d(30).get(f,s+33),album:new d(30).get(f,s+63),year:new d(4).get(f,s+93),comment:new d(28).get(f,s+97),zeroByte:n.UINT8.get(f,s+127),track:n.UINT8.get(f,s+126),genre:n.UINT8.get(f,s+127)}:null}};class d extends n.StringType{constructor(s){super(s,"binary")}get(s,a){let p=super.get(s,a);return p=t.trimRightNull(p),p=p.trim(),p.length>0?p:void 0}}class i extends o.BasicParser{static getGenre(s){if(s<e.Genres.length)return e.Genres[s]}async parse(){if(!this.tokenizer.fileInfo.size){u("Skip checking for ID3v1 because the file-size is unknown");return}if(this.options.apeHeader){this.tokenizer.ignore(this.options.apeHeader.offset-this.tokenizer.position);const p=new l.APEv2Parser;p.init(this.metadata,this.tokenizer,this.options),await p.parseTags(this.options.apeHeader.footer)}const s=this.tokenizer.fileInfo.size-m.len;if(this.tokenizer.position>s){u("Already consumed the last 128 bytes");return}const a=await this.tokenizer.readToken(m,s);if(a){u("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-m.len);for(const h of["title","artist","album","comment","track","year"])a[h]&&a[h]!==""&&this.addTag(h,a[h]);const p=i.getGenre(a.genre);p&&this.addTag("genre",p)}else u("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-m.len)}addTag(s,a){this.metadata.addTag("ID3v1",s,a)}}e.ID3v1Parser=i;async function c(f){if(f.fileSize>=128){const s=Buffer.alloc(3);return await f.randomRead(s,0,s.length,f.fileSize-128),s.toString("binary")==="TAG"}return!1}e.hasID3v1Header=c}(ID3v1Parser)),ID3v1Parser}var hasRequiredFrameParser;function requireFrameParser(){if(hasRequiredFrameParser)return FrameParser;hasRequiredFrameParser=1,Object.defineProperty(FrameParser,"__esModule",{value:!0}),FrameParser.FrameParser=FrameParser.parseGenre=void 0;const e=requireBrowser$3(),r=requireLib$2(),n=requireUtil$1(),t=requireID3v2Token(),o=requireID3v1Parser(),l=(0,e.default)("music-metadata:id3v2:frame-parser"),u="latin1";function m(c){const f=[];let s,a="";for(const p of c)if(typeof s=="string")if(p==="("&&s==="")a+="(",s=void 0;else if(p===")"){a!==""&&(f.push(a),a="");const h=d(s);h&&f.push(h),s=void 0}else s+=p;else p==="("?s="":a+=p;return a&&(f.length===0&&a.match(/^\d*$/)&&(a=o.Genres[a]),f.push(a)),f}FrameParser.parseGenre=m;function d(c){if(c==="RX")return"Remix";if(c==="CR")return"Cover";if(c.match(/^\d*$/))return o.Genres[c]}let i=class we{constructor(f,s){this.major=f,this.warningCollector=s}readData(f,s,a){if(f.length===0){this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${s}`);return}const{encoding:p,bom:h}=t.TextEncodingToken.get(f,0),b=f.length;let g=0,y=[];const S=we.getNullTerminatorLength(p);let E;const I={};switch(l(`Parsing tag type=${s}, encoding=${p}, bom=${h}`),s!=="TXXX"&&s[0]==="T"?"T*":s){case"T*":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":let k;try{k=n.decodeString(f.slice(1),p).replace(/\x00+$/,"")}catch(F){this.warningCollector.addWarning(`id3v2.${this.major} type=${s} header has invalid string value: ${F.message}`)}switch(s){case"TMCL":case"TIPL":case"IPLS":y=this.splitValue(s,k),y=we.functionList(y);break;case"TRK":case"TRCK":case"TPOS":y=k;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":y=this.splitValue(s,k);break;case"TCO":case"TCON":y=this.splitValue(s,k).map(F=>m(F)).reduce((F,P)=>F.concat(P),[]);break;case"PCS":case"PCST":y=this.major>=4?this.splitValue(s,k):[k],y=Array.isArray(y)&&y[0]===""?1:0;break;default:y=this.major>=4?this.splitValue(s,k):[k]}break;case"TXXX":y=we.readIdentifierAndData(f,g+1,b,p),y={description:y.id,text:this.splitValue(s,n.decodeString(y.data,p).replace(/\x00+$/,""))};break;case"PIC":case"APIC":if(a){const F={};switch(g+=1,this.major){case 2:F.format=n.decodeString(f.slice(g,g+3),"latin1"),g+=3;break;case 3:case 4:E=n.findZero(f,g,b,u),F.format=n.decodeString(f.slice(g,E),u),g=E+1;break;default:throw new Error("Warning: unexpected major versionIndex: "+this.major)}F.format=we.fixPictureMimeType(F.format),F.type=t.AttachedPictureType[f[g]],g+=1,E=n.findZero(f,g,b,p),F.description=n.decodeString(f.slice(g,E),p),g=E+S,F.data=Buffer.from(f.slice(g,b)),y=F}break;case"CNT":case"PCNT":y=r.UINT32_BE.get(f,0);break;case"SYLT":for(g+=7,y=[];g<b;){const F=f.slice(g,g=n.findZero(f,g,b,p));g+=5,y.push(n.decodeString(F,p))}break;case"ULT":case"USLT":case"COM":case"COMM":g+=1,I.language=n.decodeString(f.slice(g,g+3),u),g+=3,E=n.findZero(f,g,b,p),I.description=n.decodeString(f.slice(g,E),p),g=E+S,I.text=n.decodeString(f.slice(g,b),p).replace(/\x00+$/,""),y=[I];break;case"UFID":y=we.readIdentifierAndData(f,g,b,u),y={owner_identifier:y.id,identifier:y.data};break;case"PRIV":y=we.readIdentifierAndData(f,g,b,u),y={owner_identifier:y.id,data:y.data};break;case"POPM":E=n.findZero(f,g,b,u);const T=n.decodeString(f.slice(g,E),u);g=E+1;const w=b-g;y={email:T,rating:r.UINT8.get(f,g),counter:w>=5?r.UINT32_BE.get(f,g+1):void 0};break;case"GEOB":{E=n.findZero(f,g+1,b,p);const F=n.decodeString(f.slice(g+1,E),u);g=E+1,E=n.findZero(f,g,b-g,p);const P=n.decodeString(f.slice(g,E),u);g=E+1,E=n.findZero(f,g,b-g,p);const C=n.decodeString(f.slice(g,E),u);y={type:F,filename:P,description:C,data:f.slice(g+1,b)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":y=n.decodeString(f.slice(g,E),u);break;case"WXXX":{E=n.findZero(f,g+1,b,p);const F=n.decodeString(f.slice(g+1,E),p);g=E+(p==="utf16le"?2:1),y={description:F,url:n.decodeString(f.slice(g,b),u)};break}case"WFD":case"WFED":y=n.decodeString(f.slice(g+1,n.findZero(f,g+1,b,p)),p);break;case"MCDI":{y=f.slice(0,b);break}default:l("Warning: unsupported id3v2-tag-type: "+s);break}return y}static fixPictureMimeType(f){switch(f=f.toLocaleLowerCase(),f){case"jpg":return"image/jpeg";case"png":return"image/png"}return f}static functionList(f){const s={};for(let a=0;a+1<f.length;a+=2){const p=f[a+1].split(",");s[f[a]]=s.hasOwnProperty(f[a])?s[f[a]].concat(p):p}return s}splitValue(f,s){let a;return this.major<4?(a=s.split(/\x00/g),a.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${f} uses non standard null-separator.`):a=s.split(/\//g)):a=s.split(/\x00/g),we.trimArray(a)}static trimArray(f){return f.map(s=>s.replace(/\x00+$/,"").trim())}static readIdentifierAndData(f,s,a,p){const h=n.findZero(f,s,a,p),b=n.decodeString(f.slice(s,h),p);return s=h+we.getNullTerminatorLength(p),{id:b,data:f.slice(s,a)}}static getNullTerminatorLength(f){return f==="utf16le"?2:1}};return FrameParser.FrameParser=i,FrameParser}var hasRequiredID3v2Parser;function requireID3v2Parser(){if(hasRequiredID3v2Parser)return ID3v2Parser;hasRequiredID3v2Parser=1,Object.defineProperty(ID3v2Parser,"__esModule",{value:!0}),ID3v2Parser.ID3v2Parser=void 0;const e=requireLib$2(),r=requireUtil$1(),n=requireFrameParser(),t=requireID3v2Token();let o=class ve{static removeUnsyncBytes(u){let m=0,d=0;for(;m<u.length-1;)m!==d&&(u[d]=u[m]),m+=u[m]===255&&u[m+1]===0?2:1,d++;return m<u.length&&(u[d++]=u[m]),u.slice(0,d)}static getFrameHeaderLength(u){switch(u){case 2:return 6;case 3:case 4:return 10;default:throw new Error("header versionIndex is incorrect")}}static readFrameFlags(u){return{status:{tag_alter_preservation:r.getBit(u,0,6),file_alter_preservation:r.getBit(u,0,5),read_only:r.getBit(u,0,4)},format:{grouping_identity:r.getBit(u,1,7),compression:r.getBit(u,1,3),encryption:r.getBit(u,1,2),unsynchronisation:r.getBit(u,1,1),data_length_indicator:r.getBit(u,1,0)}}}static readFrameData(u,m,d,i,c){const f=new n.FrameParser(d,c);switch(d){case 2:return f.readData(u,m.id,i);case 3:case 4:return m.flags.format.unsynchronisation&&(u=ve.removeUnsyncBytes(u)),m.flags.format.data_length_indicator&&(u=u.slice(4,u.length)),f.readData(u,m.id,i);default:throw new Error("Unexpected majorVer: "+d)}}static makeDescriptionTagName(u,m){return u+(m?":"+m:"")}async parse(u,m,d){this.tokenizer=m,this.metadata=u,this.options=d;const i=await this.tokenizer.readToken(t.ID3v2Header);if(i.fileIdentifier!=="ID3")throw new Error("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=i,this.headerType="ID3v2."+i.version.major,i.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(i.size)}async parseExtendedHeader(){const u=await this.tokenizer.readToken(t.ExtendedHeader),m=u.size-t.ExtendedHeader.len;return m>0?this.parseExtendedHeaderData(m,u.size):this.parseId3Data(this.id3Header.size-u.size)}async parseExtendedHeaderData(u,m){return await this.tokenizer.ignore(u),this.parseId3Data(this.id3Header.size-m)}async parseId3Data(u){const m=await this.tokenizer.readToken(new e.Uint8ArrayType(u));for(const d of this.parseMetadata(m))if(d.id==="TXXX"){if(d.value)for(const i of d.value.text)this.addTag(ve.makeDescriptionTagName(d.id,d.value.description),i)}else if(d.id==="COM")for(const i of d.value)this.addTag(ve.makeDescriptionTagName(d.id,i.description),i.text);else if(d.id==="COMM")for(const i of d.value)this.addTag(ve.makeDescriptionTagName(d.id,i.description),i);else if(Array.isArray(d.value))for(const i of d.value)this.addTag(d.id,i);else this.addTag(d.id,d.value)}addTag(u,m){this.metadata.addTag(this.headerType,u,m)}parseMetadata(u){let m=0;const d=[];for(;m!==u.length;){const i=ve.getFrameHeaderLength(this.id3Header.version.major);if(m+i>u.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const c=u.slice(m,m+=i),f=this.readFrameHeader(c,this.id3Header.version.major),s=u.slice(m,m+=f.length),a=ve.readFrameData(s,f,this.id3Header.version.major,!this.options.skipCovers,this.metadata);a&&d.push({id:f.id,value:a})}return d}readFrameHeader(u,m){let d;switch(m){case 2:d={id:Buffer.from(u.slice(0,3)).toString("ascii"),length:e.UINT24_BE.get(u,3)},d.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${d.id}`);break;case 3:case 4:d={id:Buffer.from(u.slice(0,4)).toString("ascii"),length:(m===4?t.UINT32SYNCSAFE:e.UINT32_BE).get(u,4),flags:ve.readFrameFlags(u.slice(8,10))},d.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${d.id}`);break;default:throw new Error("Unexpected majorVer: "+m)}return d}};return ID3v2Parser.ID3v2Parser=o,ID3v2Parser}var AiffToken={},hasRequiredAiffToken;function requireAiffToken(){if(hasRequiredAiffToken)return AiffToken;hasRequiredAiffToken=1,Object.defineProperty(AiffToken,"__esModule",{value:!0}),AiffToken.Common=void 0;const e=requireLib$2(),r=requireFourCC();class n{constructor(o,l){this.isAifc=l;const u=l?22:18;if(o.chunkSize<u)throw new Error(`COMMON CHUNK size should always be at least ${u}`);this.len=o.chunkSize}get(o,l){const u=o.readUInt16BE(l+8)-16398,m=o.readUInt16BE(l+8+2),d={numChannels:o.readUInt16BE(l),numSampleFrames:o.readUInt32BE(l+2),sampleSize:o.readUInt16BE(l+6),sampleRate:u<0?m>>Math.abs(u):m<<u};if(this.isAifc){if(d.compressionType=r.FourCcToken.get(o,l+18),this.len>22){const i=o.readInt8(l+22);if(i>0){const c=(i+1)%2;if(23+i+c===this.len)d.compressionName=new e.StringType(i,"binary").get(o,l+23);else throw new Error("Illegal pstring length")}else d.compressionName=void 0}}else d.compressionName="PCM";return d}}return AiffToken.Common=n,AiffToken}var iff={},hasRequiredIff;function requireIff(){if(hasRequiredIff)return iff;hasRequiredIff=1,Object.defineProperty(iff,"__esModule",{value:!0}),iff.Header=void 0;const e=requireLib$2(),r=requireFourCC();return iff.Header={len:8,get:(n,t)=>({chunkID:r.FourCcToken.get(n,t),chunkSize:Number(BigInt(e.UINT32_BE.get(n,t+4)))})},iff}var hasRequiredAiffParser;function requireAiffParser(){if(hasRequiredAiffParser)return AiffParser;hasRequiredAiffParser=1,Object.defineProperty(AiffParser,"__esModule",{value:!0}),AiffParser.AIFFParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),n=requireCore$2(),t=requireID3v2Parser(),o=requireFourCC(),l=requireBasicParser(),u=requireAiffToken(),m=requireIff(),d=(0,r.default)("music-metadata:parser:aiff"),i={NONE:"not compressed	PCM	Apple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float	Apple Computer",alaw:"ALaw 2:1	8-bit ITU-T G.711 A-law",ulaw:"µLaw 2:1	8-bit ITU-T G.711 µ-law	Apple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 µ-law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32	IEEE 32-bit float "};class c extends l.BasicParser{async parse(){if((await this.tokenizer.readToken(m.Header)).chunkID!=="FORM")throw new Error("Invalid Chunk-ID, expected 'FORM'");const a=await this.tokenizer.readToken(o.FourCcToken);switch(a){case"AIFF":this.metadata.setFormat("container",a),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw Error("Unsupported AIFF type: "+a)}this.metadata.setFormat("lossless",!this.isCompressed);try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=m.Header.len;){d("Reading AIFF chunk at offset="+this.tokenizer.position);const p=await this.tokenizer.readToken(m.Header),h=2*Math.round(p.chunkSize/2),b=await this.readData(p);await this.tokenizer.ignore(h-b)}}catch(p){if(p instanceof n.EndOfStreamError)d("End-of-stream");else throw p}}async readData(s){var a;switch(s.chunkID){case"COMM":const p=await this.tokenizer.readToken(new u.Common(s,this.isCompressed));return this.metadata.setFormat("bitsPerSample",p.sampleSize),this.metadata.setFormat("sampleRate",p.sampleRate),this.metadata.setFormat("numberOfChannels",p.numChannels),this.metadata.setFormat("numberOfSamples",p.numSampleFrames),this.metadata.setFormat("duration",p.numSampleFrames/p.sampleRate),this.metadata.setFormat("codec",(a=p.compressionName)!==null&&a!==void 0?a:i[p.compressionType]),s.chunkSize;case"ID3 ":const h=await this.tokenizer.readToken(new e.Uint8ArrayType(s.chunkSize)),b=n.fromBuffer(h);return await new t.ID3v2Parser().parse(this.metadata,b,this.options),s.chunkSize;case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*s.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(s);default:return d(`Ignore chunk id=${s.chunkID}, size=${s.chunkSize}`),0}}async readTextChunk(s){return(await this.tokenizer.readToken(new e.StringType(s.chunkSize,"ascii"))).split("\0").map(p=>p.trim()).filter(p=>p&&p.length>0).forEach(p=>{this.metadata.addTag("AIFF",s.chunkID,p.trim())}),s.chunkSize}}return AiffParser.AIFFParser=c,AiffParser}var AsfParser={},GUID={},hasRequiredGUID;function requireGUID(){if(hasRequiredGUID)return GUID;hasRequiredGUID=1,Object.defineProperty(GUID,"__esModule",{value:!0});let e=class _e{static fromBin(n,t=0){return new _e(this.decode(n,t))}static decode(n,t=0){return(n.readUInt32LE(t).toString(16)+"-"+n.readUInt16LE(t+4).toString(16)+"-"+n.readUInt16LE(t+6).toString(16)+"-"+n.readUInt16BE(t+8).toString(16)+"-"+n.slice(t+10,t+16).toString("hex")).toUpperCase()}static decodeMediaType(n){switch(n.str){case _e.AudioMedia.str:return"audio";case _e.VideoMedia.str:return"video";case _e.CommandMedia.str:return"command";case _e.Degradable_JPEG_Media.str:return"degradable-jpeg";case _e.FileTransferMedia.str:return"file-transfer";case _e.BinaryMedia.str:return"binary"}}static encode(n){const t=Buffer.alloc(16);return t.writeUInt32LE(parseInt(n.slice(0,8),16),0),t.writeUInt16LE(parseInt(n.slice(9,13),16),4),t.writeUInt16LE(parseInt(n.slice(14,18),16),6),Buffer.from(n.slice(19,23),"hex").copy(t,8),Buffer.from(n.slice(24),"hex").copy(t,10),t}constructor(n){this.str=n}equals(n){return this.str===n.str}toBin(){return _e.encode(this.str)}};return e.HeaderObject=new e("75B22630-668E-11CF-A6D9-00AA0062CE6C"),e.DataObject=new e("75B22636-668E-11CF-A6D9-00AA0062CE6C"),e.SimpleIndexObject=new e("33000890-E5B1-11CF-89F4-00A0C90349CB"),e.IndexObject=new e("D6E229D3-35DA-11D1-9034-00A0C90349BE"),e.MediaObjectIndexObject=new e("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C"),e.TimecodeIndexObject=new e("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C"),e.FilePropertiesObject=new e("8CABDCA1-A947-11CF-8EE4-00C00C205365"),e.StreamPropertiesObject=new e("B7DC0791-A9B7-11CF-8EE6-00C00C205365"),e.HeaderExtensionObject=new e("5FBF03B5-A92E-11CF-8EE3-00C00C205365"),e.CodecListObject=new e("86D15240-311D-11D0-A3A4-00A0C90348F6"),e.ScriptCommandObject=new e("1EFB1A30-0B62-11D0-A39B-00A0C90348F6"),e.MarkerObject=new e("F487CD01-A951-11CF-8EE6-00C00C205365"),e.BitrateMutualExclusionObject=new e("D6E229DC-35DA-11D1-9034-00A0C90349BE"),e.ErrorCorrectionObject=new e("75B22635-668E-11CF-A6D9-00AA0062CE6C"),e.ContentDescriptionObject=new e("75B22633-668E-11CF-A6D9-00AA0062CE6C"),e.ExtendedContentDescriptionObject=new e("D2D0A440-E307-11D2-97F0-00A0C95EA850"),e.ContentBrandingObject=new e("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E"),e.StreamBitratePropertiesObject=new e("7BF875CE-468D-11D1-8D82-006097C9A2B2"),e.ContentEncryptionObject=new e("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E"),e.ExtendedContentEncryptionObject=new e("298AE614-2622-4C17-B935-DAE07EE9289C"),e.DigitalSignatureObject=new e("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E"),e.PaddingObject=new e("1806D474-CADF-4509-A4BA-9AABCB96AAE8"),e.ExtendedStreamPropertiesObject=new e("14E6A5CB-C672-4332-8399-A96952065B5A"),e.AdvancedMutualExclusionObject=new e("A08649CF-4775-4670-8A16-6E35357566CD"),e.GroupMutualExclusionObject=new e("D1465A40-5A79-4338-B71B-E36B8FD6C249"),e.StreamPrioritizationObject=new e("D4FED15B-88D3-454F-81F0-ED5C45999E24"),e.BandwidthSharingObject=new e("A69609E6-517B-11D2-B6AF-00C04FD908E9"),e.LanguageListObject=new e("7C4346A9-EFE0-4BFC-B229-393EDE415C85"),e.MetadataObject=new e("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA"),e.MetadataLibraryObject=new e("44231C94-9498-49D1-A141-1D134E457054"),e.IndexParametersObject=new e("D6E229DF-35DA-11D1-9034-00A0C90349BE"),e.MediaObjectIndexParametersObject=new e("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7"),e.TimecodeIndexParametersObject=new e("F55E496D-9797-4B5D-8C8B-604DFE9BFB24"),e.CompatibilityObject=new e("26F18B5D-4584-47EC-9F5F-0E651F0452C9"),e.AdvancedContentEncryptionObject=new e("43058533-6981-49E6-9B74-AD12CB86D58C"),e.AudioMedia=new e("F8699E40-5B4D-11CF-A8FD-00805F5C442B"),e.VideoMedia=new e("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B"),e.CommandMedia=new e("59DACFC0-59E6-11D0-A3AC-00A0C90348F6"),e.JFIF_Media=new e("B61BE100-5B4E-11CF-A8FD-00805F5C442B"),e.Degradable_JPEG_Media=new e("35907DE0-E415-11CF-A917-00805F5C442B"),e.FileTransferMedia=new e("91BD222C-F21C-497A-8B6D-5AA86BFC0185"),e.BinaryMedia=new e("3AFB65E2-47EF-40F2-AC2C-70A90D71D343"),e.ASF_Index_Placeholder_Object=new e("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2"),GUID.default=e,GUID}var AsfObject={},AsfUtil={},hasRequiredAsfUtil;function requireAsfUtil(){if(hasRequiredAsfUtil)return AsfUtil;hasRequiredAsfUtil=1,Object.defineProperty(AsfUtil,"__esModule",{value:!0}),AsfUtil.AsfUtil=void 0;const e=requireLib$2(),r=requireUtil$1();let n=class Fe{static getParserForAttr(o){return Fe.attributeParsers[o]}static parseUnicodeAttr(o){return r.stripNulls(r.decodeString(o,"utf16le"))}static parseByteArrayAttr(o){return Buffer.from(o)}static parseBoolAttr(o,l=0){return Fe.parseWordAttr(o,l)===1}static parseDWordAttr(o,l=0){return o.readUInt32LE(l)}static parseQWordAttr(o,l=0){return e.UINT64_LE.get(o,l)}static parseWordAttr(o,l=0){return o.readUInt16LE(l)}};return n.attributeParsers=[n.parseUnicodeAttr,n.parseByteArrayAttr,n.parseBoolAttr,n.parseDWordAttr,n.parseQWordAttr,n.parseWordAttr,n.parseByteArrayAttr],AsfUtil.AsfUtil=n,AsfUtil}var hasRequiredAsfObject;function requireAsfObject(){return hasRequiredAsfObject||(hasRequiredAsfObject=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WmPictureToken=e.MetadataLibraryObjectState=e.MetadataObjectState=e.ExtendedStreamPropertiesObjectState=e.ExtendedContentDescriptionObjectState=e.ContentDescriptionObjectState=e.readCodecEntries=e.HeaderExtensionObject=e.StreamPropertiesObject=e.FilePropertiesObject=e.IgnoreObjectState=e.State=e.HeaderObjectToken=e.TopLevelHeaderObjectToken=e.DataType=void 0;const r=requireUtil$1(),n=requireLib$2(),t=requireGUID(),o=requireAsfUtil(),l=requireID3v2Token();(function(k){k[k.UnicodeString=0]="UnicodeString",k[k.ByteArray=1]="ByteArray",k[k.Bool=2]="Bool",k[k.DWord=3]="DWord",k[k.QWord=4]="QWord",k[k.Word=5]="Word"})(e.DataType||(e.DataType={})),e.TopLevelHeaderObjectToken={len:30,get:(k,T)=>({objectId:t.default.fromBin(new n.BufferType(16).get(k,T)),objectSize:Number(n.UINT64_LE.get(k,T+16)),numberOfHeaderObjects:n.UINT32_LE.get(k,T+24)})},e.HeaderObjectToken={len:24,get:(k,T)=>({objectId:t.default.fromBin(new n.BufferType(16).get(k,T)),objectSize:Number(n.UINT64_LE.get(k,T+16))})};class u{constructor(T){this.len=Number(T.objectSize)-e.HeaderObjectToken.len}postProcessTag(T,w,F,P){if(w==="WM/Picture")T.push({id:w,value:I.fromBuffer(P)});else{const C=o.AsfUtil.getParserForAttr(F);if(!C)throw new Error("unexpected value headerType: "+F);T.push({id:w,value:C(P)})}}}e.State=u;class m extends u{constructor(T){super(T)}get(T,w){return null}}e.IgnoreObjectState=m;class d extends u{constructor(T){super(T)}get(T,w){return{fileId:t.default.fromBin(T,w),fileSize:n.UINT64_LE.get(T,w+16),creationDate:n.UINT64_LE.get(T,w+24),dataPacketsCount:n.UINT64_LE.get(T,w+32),playDuration:n.UINT64_LE.get(T,w+40),sendDuration:n.UINT64_LE.get(T,w+48),preroll:n.UINT64_LE.get(T,w+56),flags:{broadcast:r.getBit(T,w+64,24),seekable:r.getBit(T,w+64,25)},minimumDataPacketSize:n.UINT32_LE.get(T,w+68),maximumDataPacketSize:n.UINT32_LE.get(T,w+72),maximumBitrate:n.UINT32_LE.get(T,w+76)}}}d.guid=t.default.FilePropertiesObject,e.FilePropertiesObject=d;class i extends u{constructor(T){super(T)}get(T,w){return{streamType:t.default.decodeMediaType(t.default.fromBin(T,w)),errorCorrectionType:t.default.fromBin(T,w+8)}}}i.guid=t.default.StreamPropertiesObject,e.StreamPropertiesObject=i;class c{constructor(){this.len=22}get(T,w){return{reserved1:t.default.fromBin(T,w),reserved2:T.readUInt16LE(w+16),extensionDataSize:T.readUInt32LE(w+18)}}}c.guid=t.default.HeaderExtensionObject,e.HeaderExtensionObject=c;const f={len:20,get:(k,T)=>({entryCount:k.readUInt16LE(T+16)})};async function s(k){const T=await k.readNumber(n.UINT16_LE);return(await k.readToken(new n.StringType(T*2,"utf16le"))).replace("\0","")}async function a(k){const T=await k.readToken(f),w=[];for(let F=0;F<T.entryCount;++F)w.push(await h(k));return w}e.readCodecEntries=a;async function p(k){const T=await k.readNumber(n.UINT16_LE),w=Buffer.alloc(T);return await k.readBuffer(w),w}async function h(k){const T=await k.readNumber(n.UINT16_LE);return{type:{videoCodec:(T&1)===1,audioCodec:(T&2)===2},codecName:await s(k),description:await s(k),information:await p(k)}}class b extends u{constructor(T){super(T)}get(T,w){const F=[];let P=w+10;for(let C=0;C<b.contentDescTags.length;++C){const B=T.readUInt16LE(w+C*2);if(B>0){const D=b.contentDescTags[C],V=P+B;F.push({id:D,value:o.AsfUtil.parseUnicodeAttr(T.slice(P,V))}),P=V}}return F}}b.guid=t.default.ContentDescriptionObject,b.contentDescTags=["Title","Author","Copyright","Description","Rating"],e.ContentDescriptionObjectState=b;class g extends u{constructor(T){super(T)}get(T,w){const F=[],P=T.readUInt16LE(w);let C=w+2;for(let B=0;B<P;B+=1){const D=T.readUInt16LE(C);C+=2;const V=o.AsfUtil.parseUnicodeAttr(T.slice(C,C+D));C+=D;const Q=T.readUInt16LE(C);C+=2;const ee=T.readUInt16LE(C);C+=2;const ue=T.slice(C,C+ee);C+=ee,this.postProcessTag(F,V,Q,ue)}return F}}g.guid=t.default.ExtendedContentDescriptionObject,e.ExtendedContentDescriptionObjectState=g;class y extends u{constructor(T){super(T)}get(T,w){return{startTime:n.UINT64_LE.get(T,w),endTime:n.UINT64_LE.get(T,w+8),dataBitrate:T.readInt32LE(w+12),bufferSize:T.readInt32LE(w+16),initialBufferFullness:T.readInt32LE(w+20),alternateDataBitrate:T.readInt32LE(w+24),alternateBufferSize:T.readInt32LE(w+28),alternateInitialBufferFullness:T.readInt32LE(w+32),maximumObjectSize:T.readInt32LE(w+36),flags:{reliableFlag:r.getBit(T,w+40,0),seekableFlag:r.getBit(T,w+40,1),resendLiveCleanpointsFlag:r.getBit(T,w+40,2)},streamNumber:T.readInt16LE(w+42),streamLanguageId:T.readInt16LE(w+44),averageTimePerFrame:T.readInt32LE(w+52),streamNameCount:T.readInt32LE(w+54),payloadExtensionSystems:T.readInt32LE(w+56),streamNames:[],streamPropertiesObject:null}}}y.guid=t.default.ExtendedStreamPropertiesObject,e.ExtendedStreamPropertiesObjectState=y;class S extends u{constructor(T){super(T)}get(T,w){const F=[],P=Buffer.from(T),C=P.readUInt16LE(w);let B=w+2;for(let D=0;D<C;D+=1){B+=4;const V=P.readUInt16LE(B);B+=2;const Q=P.readUInt16LE(B);B+=2;const ee=P.readUInt32LE(B);B+=4;const ue=o.AsfUtil.parseUnicodeAttr(P.slice(B,B+V));B+=V;const N=P.slice(B,B+ee);B+=ee,this.postProcessTag(F,ue,Q,N)}return F}}S.guid=t.default.MetadataObject,e.MetadataObjectState=S;class E extends S{constructor(T){super(T)}}E.guid=t.default.MetadataLibraryObject,e.MetadataLibraryObjectState=E;class I{static fromBase64(T){return this.fromBuffer(Buffer.from(T,"base64"))}static fromBuffer(T){return new I(T.length).get(T,0)}constructor(T){this.len=T}get(T,w){const F=T.readUInt8(w++),P=T.readInt32LE(w);let C=5;for(;T.readUInt16BE(C)!==0;)C+=2;const B=T.slice(5,C).toString("utf16le");for(;T.readUInt16BE(C)!==0;)C+=2;const D=T.slice(5,C).toString("utf16le");return{type:l.AttachedPictureType[F],format:B,description:D,size:P,data:T.slice(C+4)}}}e.WmPictureToken=I}(AsfObject)),AsfObject}var hasRequiredAsfParser;function requireAsfParser(){if(hasRequiredAsfParser)return AsfParser;hasRequiredAsfParser=1,Object.defineProperty(AsfParser,"__esModule",{value:!0}),AsfParser.AsfParser=void 0;const e=requireBrowser$3(),r=requireType(),n=requireGUID(),t=requireAsfObject(),o=requireBasicParser(),l=(0,e.default)("music-metadata:parser:ASF"),u="asf";let m=class extends o.BasicParser{async parse(){const i=await this.tokenizer.readToken(t.TopLevelHeaderObjectToken);if(!i.objectId.equals(n.default.HeaderObject))throw new Error("expected asf header; but was not found; got: "+i.objectId.str);try{await this.parseObjectHeader(i.numberOfHeaderObjects)}catch(c){l("Error while parsing ASF: %s",c)}}async parseObjectHeader(i){let c;do{const f=await this.tokenizer.readToken(t.HeaderObjectToken);switch(l("header GUID=%s",f.objectId.str),f.objectId.str){case t.FilePropertiesObject.guid.str:const s=await this.tokenizer.readToken(new t.FilePropertiesObject(f));this.metadata.setFormat("duration",Number(s.playDuration/BigInt(1e3))/1e4-Number(s.preroll)/1e3),this.metadata.setFormat("bitrate",s.maximumBitrate);break;case t.StreamPropertiesObject.guid.str:const a=await this.tokenizer.readToken(new t.StreamPropertiesObject(f));this.metadata.setFormat("container","ASF/"+a.streamType);break;case t.HeaderExtensionObject.guid.str:const p=await this.tokenizer.readToken(new t.HeaderExtensionObject);await this.parseExtensionObject(p.extensionDataSize);break;case t.ContentDescriptionObjectState.guid.str:c=await this.tokenizer.readToken(new t.ContentDescriptionObjectState(f)),this.addTags(c);break;case t.ExtendedContentDescriptionObjectState.guid.str:c=await this.tokenizer.readToken(new t.ExtendedContentDescriptionObjectState(f)),this.addTags(c);break;case n.default.CodecListObject.str:const h=await t.readCodecEntries(this.tokenizer);h.forEach(g=>{this.metadata.addStreamInfo({type:g.type.videoCodec?r.TrackType.video:r.TrackType.audio,codecName:g.codecName})});const b=h.filter(g=>g.type.audioCodec).map(g=>g.codecName).join("/");this.metadata.setFormat("codec",b);break;case n.default.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(f.objectSize-t.HeaderObjectToken.len);break;case n.default.PaddingObject.str:l("Padding: %s bytes",f.objectSize-t.HeaderObjectToken.len),await this.tokenizer.ignore(f.objectSize-t.HeaderObjectToken.len);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+f.objectId.str),l("Ignore ASF-Object-GUID: %s",f.objectId.str),await this.tokenizer.readToken(new t.IgnoreObjectState(f))}}while(--i)}addTags(i){i.forEach(c=>{this.metadata.addTag(u,c.id,c.value)})}async parseExtensionObject(i){do{const c=await this.tokenizer.readToken(t.HeaderObjectToken),f=c.objectSize-t.HeaderObjectToken.len;switch(c.objectId.str){case t.ExtendedStreamPropertiesObjectState.guid.str:await this.tokenizer.readToken(new t.ExtendedStreamPropertiesObjectState(c));break;case t.MetadataObjectState.guid.str:const s=await this.tokenizer.readToken(new t.MetadataObjectState(c));this.addTags(s);break;case t.MetadataLibraryObjectState.guid.str:const a=await this.tokenizer.readToken(new t.MetadataLibraryObjectState(c));this.addTags(a);break;case n.default.PaddingObject.str:await this.tokenizer.ignore(f);break;case n.default.CompatibilityObject.str:this.tokenizer.ignore(f);break;case n.default.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(f);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+c.objectId.str),await this.tokenizer.readToken(new t.IgnoreObjectState(c));break}i-=c.objectSize}while(i>0)}};return AsfParser.AsfParser=m,AsfParser}var FlacParser={},Vorbis={},hasRequiredVorbis;function requireVorbis(){if(hasRequiredVorbis)return Vorbis;hasRequiredVorbis=1,Object.defineProperty(Vorbis,"__esModule",{value:!0}),Vorbis.IdentificationHeader=Vorbis.CommonHeader=Vorbis.VorbisPictureToken=void 0;const e=requireLib$2(),r=requireID3v2Token();class n{static fromBase64(o){return this.fromBuffer(Buffer.from(o,"base64"))}static fromBuffer(o){return new n(o.length).get(o,0)}constructor(o){this.len=o}get(o,l){const u=r.AttachedPictureType[e.UINT32_BE.get(o,l)],m=e.UINT32_BE.get(o,l+=4),d=o.toString("utf-8",l+=4,l+m),i=e.UINT32_BE.get(o,l+=m),c=o.toString("utf-8",l+=4,l+i),f=e.UINT32_BE.get(o,l+=i),s=e.UINT32_BE.get(o,l+=4),a=e.UINT32_BE.get(o,l+=4),p=e.UINT32_BE.get(o,l+=4),h=e.UINT32_BE.get(o,l+=4),b=Buffer.from(o.slice(l+=4,l+h));return{type:u,format:d,description:c,width:f,height:s,colour_depth:a,indexed_color:p,data:b}}}return Vorbis.VorbisPictureToken=n,Vorbis.CommonHeader={len:7,get:(t,o)=>({packetType:t.readUInt8(o),vorbis:new e.StringType(6,"ascii").get(t,o+1)})},Vorbis.IdentificationHeader={len:23,get:(t,o)=>{const l=new DataView(t.buffer,t.byteOffset);return{version:l.getUint32(o+0,!0),channelMode:l.getUint8(o+4),sampleRate:l.getUint32(o+5,!0),bitrateMax:l.getUint32(o+9,!0),bitrateNominal:l.getUint32(o+13,!0),bitrateMin:l.getUint32(o+17,!0)}}},Vorbis}var AbstractID3Parser={},hasRequiredAbstractID3Parser;function requireAbstractID3Parser(){if(hasRequiredAbstractID3Parser)return AbstractID3Parser;hasRequiredAbstractID3Parser=1,Object.defineProperty(AbstractID3Parser,"__esModule",{value:!0}),AbstractID3Parser.AbstractID3Parser=void 0;const e=requireCore$2(),r=requireBrowser$3(),n=requireID3v2Token(),t=requireID3v2Parser(),o=requireID3v1Parser(),l=requireBasicParser(),u=(0,r.default)("music-metadata:parser:ID3");let m=class extends l.BasicParser{constructor(){super(...arguments),this.id3parser=new t.ID3v2Parser}static async startsWithID3v2Header(i){return(await i.peekToken(n.ID3v2Header)).fileIdentifier==="ID3"}async parse(){try{await this.parseID3v2()}catch(i){if(i instanceof e.EndOfStreamError)u("End-of-stream");else throw i}}finalize(){}async parseID3v2(){await this.tryReadId3v2Headers(),u("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny()?this.finalize():(await new o.ID3v1Parser().init(this.metadata,this.tokenizer,this.options).parse(),this.finalize())}async tryReadId3v2Headers(){if((await this.tokenizer.peekToken(n.ID3v2Header)).fileIdentifier==="ID3")return u("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}};return AbstractID3Parser.AbstractID3Parser=m,AbstractID3Parser}var VorbisParser={},VorbisDecoder={},hasRequiredVorbisDecoder;function requireVorbisDecoder(){if(hasRequiredVorbisDecoder)return VorbisDecoder;hasRequiredVorbisDecoder=1,Object.defineProperty(VorbisDecoder,"__esModule",{value:!0}),VorbisDecoder.VorbisDecoder=void 0;const e=requireLib$2();let r=class{constructor(t,o){this.data=t,this.offset=o}readInt32(){const t=e.UINT32_LE.get(this.data,this.offset);return this.offset+=4,t}readStringUtf8(){const t=this.readInt32(),o=Buffer.from(this.data).toString("utf-8",this.offset,this.offset+t);return this.offset+=t,o}parseUserComment(){const t=this.offset,o=this.readStringUtf8(),l=o.indexOf("=");return{key:o.slice(0,l).toUpperCase(),value:o.slice(l+1),len:this.offset-t}}};return VorbisDecoder.VorbisDecoder=r,VorbisDecoder}var hasRequiredVorbisParser;function requireVorbisParser(){if(hasRequiredVorbisParser)return VorbisParser;hasRequiredVorbisParser=1,Object.defineProperty(VorbisParser,"__esModule",{value:!0}),VorbisParser.VorbisParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),n=requireVorbisDecoder(),t=requireVorbis(),o=(0,r.default)("music-metadata:parser:ogg:vorbis1");let l=class{constructor(m,d){this.metadata=m,this.options=d,this.pageSegments=[]}parsePage(m,d){if(m.headerType.firstPage)this.parseFirstPage(m,d);else{if(m.headerType.continued){if(this.pageSegments.length===0)throw new Error("Cannot continue on previous page");this.pageSegments.push(d)}if(m.headerType.lastPage||!m.headerType.continued){if(this.pageSegments.length>0){const i=Buffer.concat(this.pageSegments);this.parseFullPage(i)}this.pageSegments=m.headerType.lastPage?[]:[d]}}m.headerType.lastPage&&this.calculateDuration(m)}flush(){this.parseFullPage(Buffer.concat(this.pageSegments))}parseUserComment(m,d){const c=new n.VorbisDecoder(m,d).parseUserComment();return this.addTag(c.key,c.value),c.len}addTag(m,d){if(m==="METADATA_BLOCK_PICTURE"&&typeof d=="string"){if(this.options.skipCovers){o("Ignore picture");return}d=t.VorbisPictureToken.fromBase64(d),o(`Push picture: id=${m}, format=${d.format}`)}else o(`Push tag: id=${m}, value=${d}`);this.metadata.addTag("vorbis",m,d)}calculateDuration(m){this.metadata.format.sampleRate&&m.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",m.absoluteGranulePosition),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate))}parseFirstPage(m,d){this.metadata.setFormat("codec","Vorbis I"),o("Parse first page");const i=t.CommonHeader.get(d,0);if(i.vorbis!=="vorbis")throw new Error("Metadata does not look like Vorbis");if(i.packetType===1){const c=t.IdentificationHeader.get(d,t.CommonHeader.len);this.metadata.setFormat("sampleRate",c.sampleRate),this.metadata.setFormat("bitrate",c.bitrateNominal),this.metadata.setFormat("numberOfChannels",c.channelMode),o("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",c.sampleRate,c.bitrateNominal,c.channelMode)}else throw new Error("First Ogg page should be type 1: the identification header")}parseFullPage(m){const d=t.CommonHeader.get(m,0);switch(o("Parse full page: type=%s, byteLength=%s",d.packetType,m.byteLength),d.packetType){case 3:return this.parseUserCommentList(m,t.CommonHeader.len)}}parseUserCommentList(m,d){const i=e.UINT32_LE.get(m,d);d+=4,d+=i;let c=e.UINT32_LE.get(m,d);for(d+=4;c-- >0;)d+=this.parseUserComment(m,d)}};return VorbisParser.VorbisParser=l,VorbisParser}var hasRequiredFlacParser;function requireFlacParser(){if(hasRequiredFlacParser)return FlacParser;hasRequiredFlacParser=1,Object.defineProperty(FlacParser,"__esModule",{value:!0}),FlacParser.FlacParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),n=requireUtil$1(),t=requireVorbis(),o=requireAbstractID3Parser(),l=requireFourCC(),u=requireVorbisParser(),m=requireVorbisDecoder(),d=(0,r.default)("music-metadata:parser:FLAC");var i;(function(s){s[s.STREAMINFO=0]="STREAMINFO",s[s.PADDING=1]="PADDING",s[s.APPLICATION=2]="APPLICATION",s[s.SEEKTABLE=3]="SEEKTABLE",s[s.VORBIS_COMMENT=4]="VORBIS_COMMENT",s[s.CUESHEET=5]="CUESHEET",s[s.PICTURE=6]="PICTURE"})(i||(i={}));let c=class extends o.AbstractID3Parser{constructor(){super(...arguments),this.padding=0}init(a,p,h){return super.init(a,p,h),this.vorbisParser=new u.VorbisParser(a,h),this}async postId3v2Parse(){if((await this.tokenizer.readToken(l.FourCcToken)).toString()!=="fLaC")throw new Error("Invalid FLAC preamble");let p;do p=await this.tokenizer.readToken(f.BlockHeader),await this.parseDataBlock(p);while(!p.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const h=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*h/this.metadata.format.duration)}}parseDataBlock(a){switch(d(`blockHeader type=${a.type}, length=${a.length}`),a.type){case i.STREAMINFO:return this.parseBlockStreamInfo(a.length);case i.PADDING:this.padding+=a.length;break;case i.APPLICATION:break;case i.SEEKTABLE:break;case i.VORBIS_COMMENT:return this.parseComment(a.length);case i.CUESHEET:break;case i.PICTURE:return this.parsePicture(a.length).then();default:this.metadata.addWarning("Unknown block type: "+a.type)}return this.tokenizer.ignore(a.length).then()}async parseBlockStreamInfo(a){if(a!==f.BlockStreamInfo.len)throw new Error("Unexpected block-stream-info length");const p=await this.tokenizer.readToken(f.BlockStreamInfo);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",p.channels),this.metadata.setFormat("bitsPerSample",p.bitsPerSample),this.metadata.setFormat("sampleRate",p.sampleRate),p.totalSamples>0&&this.metadata.setFormat("duration",p.totalSamples/p.sampleRate)}async parseComment(a){const p=await this.tokenizer.readToken(new e.Uint8ArrayType(a)),h=new m.VorbisDecoder(p,0);h.readStringUtf8();const b=h.readInt32();for(let g=0;g<b;g++){const y=h.parseUserComment();this.vorbisParser.addTag(y.key,y.value)}}async parsePicture(a){if(this.options.skipCovers)return this.tokenizer.ignore(a);{const p=await this.tokenizer.readToken(new t.VorbisPictureToken(a));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",p)}}};FlacParser.FlacParser=c;class f{}return f.BlockHeader={len:4,get:(s,a)=>({lastBlock:n.getBit(s,a,7),type:n.getBitAllignedNumber(s,a,1,7),length:e.UINT24_BE.get(s,a+1)})},f.BlockStreamInfo={len:34,get:(s,a)=>({minimumBlockSize:e.UINT16_BE.get(s,a),maximumBlockSize:e.UINT16_BE.get(s,a+2)/1e3,minimumFrameSize:e.UINT24_BE.get(s,a+4),maximumFrameSize:e.UINT24_BE.get(s,a+7),sampleRate:e.UINT24_BE.get(s,a+10)>>4,channels:n.getBitAllignedNumber(s,a+12,4,3)+1,bitsPerSample:n.getBitAllignedNumber(s,a+12,7,5)+1,totalSamples:n.getBitAllignedNumber(s,a+13,4,36),fileMD5:new e.Uint8ArrayType(16).get(s,a+18)})},FlacParser}var MP4Parser={},Atom={},AtomToken={},hasRequiredAtomToken;function requireAtomToken(){return hasRequiredAtomToken||(hasRequiredAtomToken=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ChapterText=e.StcoAtom=e.StszAtom=e.StscAtom=e.SampleToChunkToken=e.SttsAtom=e.TimeToSampleToken=e.SoundSampleDescriptionV0=e.SoundSampleDescriptionVersion=e.StsdAtom=e.TrackHeaderAtom=e.NameAtom=e.DataAtom=e.MvhdAtom=e.MdhdAtom=e.FixedLengthAtom=e.mhdr=e.tkhd=e.ftyp=e.ExtendedSize=e.Header=void 0;const r=requireLib$2(),n=requireBrowser$3(),t=requireFourCC(),o=(0,n.default)("music-metadata:parser:MP4:atom");e.Header={len:8,get:(k,T)=>{const w=r.UINT32_BE.get(k,T);if(w<0)throw new Error("Invalid atom header length");return{length:BigInt(w),name:new r.StringType(4,"binary").get(k,T+4)}},put:(k,T,w)=>(r.UINT32_BE.put(k,T,Number(w.length)),t.FourCcToken.put(k,T+4,w.name))},e.ExtendedSize=r.UINT64_BE,e.ftyp={len:4,get:(k,T)=>({type:new r.StringType(4,"ascii").get(k,T)})},e.tkhd={len:4,get:(k,T)=>({type:new r.StringType(4,"ascii").get(k,T)})},e.mhdr={len:8,get:(k,T)=>({version:r.UINT8.get(k,T),flags:r.UINT24_BE.get(k,T+1),nextItemID:r.UINT32_BE.get(k,T+4)})};class l{constructor(T,w,F){if(this.len=T,T<w)throw new Error(`Atom ${F} expected to be ${w}, but specifies ${T} bytes long.`);T>w&&o(`Warning: atom ${F} expected to be ${w}, but was actually ${T} bytes long.`)}}e.FixedLengthAtom=l;const u={len:4,get:(k,T)=>{const w=r.UINT32_BE.get(k,T)-2082844800;return new Date(w*1e3)}};class m extends l{constructor(T){super(T,24,"mdhd"),this.len=T}get(T,w){return{version:r.UINT8.get(T,w+0),flags:r.UINT24_BE.get(T,w+1),creationTime:u.get(T,w+4),modificationTime:u.get(T,w+8),timeScale:r.UINT32_BE.get(T,w+12),duration:r.UINT32_BE.get(T,w+16),language:r.UINT16_BE.get(T,w+20),quality:r.UINT16_BE.get(T,w+22)}}}e.MdhdAtom=m;class d extends l{constructor(T){super(T,100,"mvhd"),this.len=T}get(T,w){return{version:r.UINT8.get(T,w),flags:r.UINT24_BE.get(T,w+1),creationTime:u.get(T,w+4),modificationTime:u.get(T,w+8),timeScale:r.UINT32_BE.get(T,w+12),duration:r.UINT32_BE.get(T,w+16),preferredRate:r.UINT32_BE.get(T,w+20),preferredVolume:r.UINT16_BE.get(T,w+24),previewTime:r.UINT32_BE.get(T,w+72),previewDuration:r.UINT32_BE.get(T,w+76),posterTime:r.UINT32_BE.get(T,w+80),selectionTime:r.UINT32_BE.get(T,w+84),selectionDuration:r.UINT32_BE.get(T,w+88),currentTime:r.UINT32_BE.get(T,w+92),nextTrackID:r.UINT32_BE.get(T,w+96)}}}e.MvhdAtom=d;class i{constructor(T){this.len=T}get(T,w){return{type:{set:r.UINT8.get(T,w+0),type:r.UINT24_BE.get(T,w+1)},locale:r.UINT24_BE.get(T,w+4),value:Buffer.from(new r.Uint8ArrayType(this.len-8).get(T,w+8))}}}e.DataAtom=i;class c{constructor(T){this.len=T}get(T,w){return{version:r.UINT8.get(T,w),flags:r.UINT24_BE.get(T,w+1),name:new r.StringType(this.len-4,"utf-8").get(T,w+4)}}}e.NameAtom=c;class f{constructor(T){this.len=T}get(T,w){return{version:r.UINT8.get(T,w),flags:r.UINT24_BE.get(T,w+1),creationTime:u.get(T,w+4),modificationTime:u.get(T,w+8),trackId:r.UINT32_BE.get(T,w+12),duration:r.UINT32_BE.get(T,w+20),layer:r.UINT16_BE.get(T,w+24),alternateGroup:r.UINT16_BE.get(T,w+26),volume:r.UINT16_BE.get(T,w+28)}}}e.TrackHeaderAtom=f;const s={len:8,get:(k,T)=>({version:r.UINT8.get(k,T),flags:r.UINT24_BE.get(k,T+1),numberOfEntries:r.UINT32_BE.get(k,T+4)})};class a{constructor(T){this.len=T}get(T,w){return{dataFormat:t.FourCcToken.get(T,w),dataReferenceIndex:r.UINT16_BE.get(T,w+10),description:new r.Uint8ArrayType(this.len-12).get(T,w+12)}}}class p{constructor(T){this.len=T}get(T,w){const F=s.get(T,w);w+=s.len;const P=[];for(let C=0;C<F.numberOfEntries;++C){const B=r.UINT32_BE.get(T,w);w+=r.UINT32_BE.len,P.push(new a(B).get(T,w)),w+=B}return{header:F,table:P}}}e.StsdAtom=p,e.SoundSampleDescriptionVersion={len:8,get(k,T){return{version:r.INT16_BE.get(k,T),revision:r.INT16_BE.get(k,T+2),vendor:r.INT32_BE.get(k,T+4)}}},e.SoundSampleDescriptionV0={len:12,get(k,T){return{numAudioChannels:r.INT16_BE.get(k,T+0),sampleSize:r.INT16_BE.get(k,T+2),compressionId:r.INT16_BE.get(k,T+4),packetSize:r.INT16_BE.get(k,T+6),sampleRate:r.UINT16_BE.get(k,T+8)+r.UINT16_BE.get(k,T+10)/1e4}}};class h{constructor(T,w){this.len=T,this.token=w}get(T,w){const F=r.INT32_BE.get(T,w+4);return{version:r.INT8.get(T,w+0),flags:r.INT24_BE.get(T,w+1),numberOfEntries:F,entries:I(T,this.token,w+8,this.len-8,F)}}}e.TimeToSampleToken={len:8,get(k,T){return{count:r.INT32_BE.get(k,T+0),duration:r.INT32_BE.get(k,T+4)}}};class b extends h{constructor(T){super(T,e.TimeToSampleToken),this.len=T}}e.SttsAtom=b,e.SampleToChunkToken={len:12,get(k,T){return{firstChunk:r.INT32_BE.get(k,T),samplesPerChunk:r.INT32_BE.get(k,T+4),sampleDescriptionId:r.INT32_BE.get(k,T+8)}}};class g extends h{constructor(T){super(T,e.SampleToChunkToken),this.len=T}}e.StscAtom=g;class y{constructor(T){this.len=T}get(T,w){const F=r.INT32_BE.get(T,w+8);return{version:r.INT8.get(T,w),flags:r.INT24_BE.get(T,w+1),sampleSize:r.INT32_BE.get(T,w+4),numberOfEntries:F,entries:I(T,r.INT32_BE,w+12,this.len-12,F)}}}e.StszAtom=y;class S extends h{constructor(T){super(T,r.INT32_BE),this.len=T}}e.StcoAtom=S;class E{constructor(T){this.len=T}get(T,w){const F=r.INT16_BE.get(T,w+0);return new r.StringType(F,"utf-8").get(T,w+2)}}e.ChapterText=E;function I(k,T,w,F,P){if(o(`remainingLen=${F}, numberOfEntries=${P} * token-len=${T.len}`),F===0)return[];if(F!==P*T.len)throw new Error("mismatch number-of-entries with remaining atom-length");const C=[];for(let B=0;B<P;++B)C.push(T.get(k,w)),w+=T.len;return C}}(AtomToken)),AtomToken}var hasRequiredAtom;function requireAtom(){if(hasRequiredAtom)return Atom;hasRequiredAtom=1,Object.defineProperty(Atom,"__esModule",{value:!0}),Atom.Atom=void 0;const e=requireBrowser$3(),r=requireAtomToken(),n=(0,e.default)("music-metadata:parser:MP4:Atom");let t=class Oe{static async readAtom(l,u,m,d){const i=l.position,c=await l.readToken(r.Header);c.length===BigInt(1)&&(c.length=await l.readToken(r.ExtendedSize));const s=new Oe(c,c.length===BigInt(1),m),a=s.getPayloadLength(d);return n(`parse atom name=${s.atomPath}, extended=${s.extended}, offset=${i}, len=${s.header.length}`),await s.readData(l,u,a),s}constructor(l,u,m){this.header=l,this.extended=u,this.parent=m,this.children=[],this.atomPath=(this.parent?this.parent.atomPath+".":"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(l){return(this.header.length===BigInt(0)?l:Number(this.header.length))-this.getHeaderLength()}async readAtoms(l,u,m){for(;m>0;){const d=await Oe.readAtom(l,u,this,m);this.children.push(d),m-=d.header.length===BigInt(0)?m:Number(d.header.length)}}async readData(l,u,m){switch(this.header.name){case"moov":case"udta":case"trak":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":return this.readAtoms(l,u,this.getPayloadLength(m));case"meta":const i=(await l.peekToken(r.Header)).name==="hdlr"?0:4;return await l.ignore(i),this.readAtoms(l,u,this.getPayloadLength(m)-i);case"mdhd":case"mvhd":case"tkhd":case"stsz":case"mdat":default:return u(this,m)}}};return Atom.Atom=t,Atom}var hasRequiredMP4Parser;function requireMP4Parser(){if(hasRequiredMP4Parser)return MP4Parser;hasRequiredMP4Parser=1,Object.defineProperty(MP4Parser,"__esModule",{value:!0}),MP4Parser.MP4Parser=void 0;const e=requireBrowser$3(),r=requireLib$2(),n=requireBasicParser(),t=requireID3v1Parser(),o=requireType(),l=requireAtom(),u=requireAtomToken(),m=(0,e.default)("music-metadata:parser:MP4"),d="iTunes",i={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function c(s,a,p){return p.indexOf(s)===a}let f=class Le extends n.BasicParser{constructor(){super(...arguments),this.atomParsers={mvhd:async a=>{const p=await this.tokenizer.readToken(new u.MvhdAtom(a));this.metadata.setFormat("creationTime",p.creationTime),this.metadata.setFormat("modificationTime",p.modificationTime)},mdhd:async a=>{const p=await this.tokenizer.readToken(new u.MdhdAtom(a)),h=this.getTrackDescription();h.creationTime=p.creationTime,h.modificationTime=p.modificationTime,h.timeScale=p.timeScale,h.duration=p.duration},chap:async a=>{const p=this.getTrackDescription(),h=[];for(;a>=r.UINT32_BE.len;)h.push(await this.tokenizer.readNumber(r.UINT32_BE)),a-=r.UINT32_BE.len;p.chapterList=h},tkhd:async a=>{const p=await this.tokenizer.readToken(new u.TrackHeaderAtom(a));this.tracks.push(p)},mdat:async a=>{if(this.audioLengthInBytes=a,this.calculateBitRate(),this.options.includeChapters){const p=this.tracks.filter(h=>h.chapterList);if(p.length===1){const h=p[0].chapterList,b=this.tracks.filter(g=>h.indexOf(g.trackId)!==-1);if(b.length===1)return this.parseChapterTrack(b[0],p[0],a)}}await this.tokenizer.ignore(a)},ftyp:async a=>{const p=[];for(;a>0;){const b=await this.tokenizer.readToken(u.ftyp);a-=u.ftyp.len;const g=b.type.replace(/\W/g,"");g.length>0&&p.push(g)}m(`ftyp: ${p.join("/")}`);const h=p.filter(c).join("/");this.metadata.setFormat("container",h)},stsd:async a=>{const p=await this.tokenizer.readToken(new u.StsdAtom(a)),h=this.getTrackDescription();h.soundSampleDescription=p.table.map(b=>this.parseSoundSampleDescription(b))},stsc:async a=>{const p=await this.tokenizer.readToken(new u.StscAtom(a));this.getTrackDescription().sampleToChunkTable=p.entries},stts:async a=>{const p=await this.tokenizer.readToken(new u.SttsAtom(a));this.getTrackDescription().timeToSampleTable=p.entries},stsz:async a=>{const p=await this.tokenizer.readToken(new u.StszAtom(a)),h=this.getTrackDescription();h.sampleSize=p.sampleSize,h.sampleSizeTable=p.entries},stco:async a=>{const p=await this.tokenizer.readToken(new u.StcoAtom(a));this.getTrackDescription().chunkOffsetTable=p.entries},date:async a=>{const p=await this.tokenizer.readToken(new r.StringType(a,"utf-8"));this.addTag("date",p)}}}static read_BE_Integer(a,p){const h=(p?"INT":"UINT")+a.length*8+(a.length>1?"_BE":""),b=r[h];if(!b)throw new Error('Token for integer type not found: "'+h+'"');return Number(b.get(a,0))}async parse(){this.tracks=[];let a=this.tokenizer.fileInfo.size;for(;!this.tokenizer.fileInfo.size||a>0;){try{if((await this.tokenizer.peekToken(u.Header)).name==="\0\0\0\0"){const y=`Error at offset=${this.tokenizer.position}: box.id=0`;m(y),this.addWarning(y);break}}catch(g){const y=`Error at offset=${this.tokenizer.position}: ${g.message}`;m(y),this.addWarning(y);break}const b=await l.Atom.readAtom(this.tokenizer,(g,y)=>this.handleAtom(g,y),null,a);a-=b.header.length===BigInt(0)?a:Number(b.header.length)}const p=[];this.tracks.forEach(b=>{const g=[];b.soundSampleDescription.forEach(y=>{const S={},E=i[y.dataFormat];if(E?(g.push(E.format),S.codecName=E.format):S.codecName=`<${y.dataFormat}>`,y.description){const{description:I}=y;I.sampleRate>0&&(S.type=o.TrackType.audio,S.audio={samplingFrequency:I.sampleRate,bitDepth:I.sampleSize,channels:I.numAudioChannels})}this.metadata.addStreamInfo(S)}),g.length>=1&&p.push(g.join("/"))}),p.length>0&&this.metadata.setFormat("codec",p.filter(c).join("+"));const h=this.tracks.filter(b=>b.soundSampleDescription.length>=1&&b.soundSampleDescription[0].description&&b.soundSampleDescription[0].description.numAudioChannels>0);if(h.length>=1){const b=h[0];if(b.timeScale>0){const S=b.duration/b.timeScale;this.metadata.setFormat("duration",S)}const g=b.soundSampleDescription[0];if(g.description&&(this.metadata.setFormat("sampleRate",g.description.sampleRate),this.metadata.setFormat("bitsPerSample",g.description.sampleSize),this.metadata.setFormat("numberOfChannels",g.description.numAudioChannels),b.timeScale===0&&b.timeToSampleTable.length>0)){const E=b.timeToSampleTable.map(I=>I.count*I.duration).reduce((I,k)=>I+k)/g.description.sampleRate;this.metadata.setFormat("duration",E)}const y=i[g.dataFormat];y&&this.metadata.setFormat("lossless",!y.lossy),this.calculateBitRate()}}async handleAtom(a,p){if(a.parent)switch(a.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(a)}if(this.atomParsers[a.header.name])return this.atomParsers[a.header.name](p);m(`No parser for atom path=${a.atomPath}, payload-len=${p}, ignoring atom`),await this.tokenizer.ignore(p)}getTrackDescription(){return this.tracks[this.tracks.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}addTag(a,p){this.metadata.addTag(d,a,p)}addWarning(a){m("Warning: "+a),this.metadata.addWarning(a)}parseMetadataItemData(a){let p=a.header.name;return a.readAtoms(this.tokenizer,async(h,b)=>{const g=h.getPayloadLength(b);switch(h.header.name){case"data":return this.parseValueAtom(p,h);case"name":case"mean":case"rate":const y=await this.tokenizer.readToken(new u.NameAtom(g));p+=":"+y.name;break;default:const S=await this.tokenizer.readToken(new r.BufferType(g));this.addWarning("Unsupported meta-item: "+p+"["+h.header.name+"] => value="+S.toString("hex")+" ascii="+S.toString("ascii"))}},a.getPayloadLength(0))}async parseValueAtom(a,p){const h=await this.tokenizer.readToken(new u.DataAtom(Number(p.header.length)-u.Header.len));if(h.type.set!==0)throw new Error("Unsupported type-set != 0: "+h.type.set);switch(h.type.type){case 0:switch(a){case"trkn":case"disk":const b=r.UINT8.get(h.value,3),g=r.UINT8.get(h.value,5);this.addTag(a,b+"/"+g);break;case"gnre":const y=r.UINT8.get(h.value,1),S=t.Genres[y-1];this.addTag(a,S);break;case"rate":const E=h.value.toString("ascii");this.addTag(a,E);break;default:m("unknown proprietary value type for: "+p.atomPath)}break;case 1:case 18:this.addTag(a,h.value.toString("utf-8"));break;case 13:if(this.options.skipCovers)break;this.addTag(a,{format:"image/jpeg",data:Buffer.from(h.value)});break;case 14:if(this.options.skipCovers)break;this.addTag(a,{format:"image/png",data:Buffer.from(h.value)});break;case 21:this.addTag(a,Le.read_BE_Integer(h.value,!0));break;case 22:this.addTag(a,Le.read_BE_Integer(h.value,!1));break;case 65:this.addTag(a,h.value.readInt8(0));break;case 66:this.addTag(a,h.value.readInt16BE(0));break;case 67:this.addTag(a,h.value.readInt32BE(0));break;default:this.addWarning(`atom key=${a}, has unknown well-known-type (data-type): ${h.type.type}`)}}parseSoundSampleDescription(a){const p={dataFormat:a.dataFormat,dataReferenceIndex:a.dataReferenceIndex};let h=0;const b=u.SoundSampleDescriptionVersion.get(a.description,h);return h+=u.SoundSampleDescriptionVersion.len,b.version===0||b.version===1?p.description=u.SoundSampleDescriptionV0.get(a.description,h):m(`Warning: sound-sample-description ${b} not implemented`),p}async parseChapterTrack(a,p,h){if(!a.sampleSize&&a.chunkOffsetTable.length!==a.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const b=[];for(let g=0;g<a.chunkOffsetTable.length&&h>0;++g){const S=a.chunkOffsetTable[g]-this.tokenizer.position,E=a.sampleSize>0?a.sampleSize:a.sampleSizeTable[g];if(h-=S+E,h<0)throw new Error("Chapter chunk exceeding token length");await this.tokenizer.ignore(S);const I=await this.tokenizer.readToken(new u.ChapterText(E));m(`Chapter ${g+1}: ${I}`);const k={title:I,sampleOffset:this.findSampleOffset(p,this.tokenizer.position)};m(`Chapter title=${k.title}, offset=${k.sampleOffset}/${this.tracks[0].duration}`),b.push(k)}this.metadata.setFormat("chapters",b),await this.tokenizer.ignore(h)}findSampleOffset(a,p){let h=0;a.timeToSampleTable.forEach(g=>{h+=g.count*g.duration}),m(`Total duration=${h}`);let b=0;for(;b<a.chunkOffsetTable.length&&a.chunkOffsetTable[b]<p;)++b;return this.getChunkDuration(b+1,a)}getChunkDuration(a,p){let h=0,b=p.timeToSampleTable[h].count,g=p.timeToSampleTable[h].duration,y=1,S=this.getSamplesPerChunk(y,p.sampleToChunkTable),E=0;for(;y<a;){const I=Math.min(b,S);E+=I*g,b-=I,S-=I,S===0?(++y,S=this.getSamplesPerChunk(y,p.sampleToChunkTable)):(++h,b=p.timeToSampleTable[h].count,g=p.timeToSampleTable[h].duration)}return E}getSamplesPerChunk(a,p){for(let h=0;h<p.length-1;++h)if(a>=p[h].firstChunk&&a<p[h+1].firstChunk)return p[h].samplesPerChunk;return p[p.length-1].samplesPerChunk}};return MP4Parser.MP4Parser=f,MP4Parser}var MpegParser={},XingTag={},ExtendedLameHeader={},ReplayGainDataFormat={},hasRequiredReplayGainDataFormat;function requireReplayGainDataFormat(){if(hasRequiredReplayGainDataFormat)return ReplayGainDataFormat;hasRequiredReplayGainDataFormat=1,Object.defineProperty(ReplayGainDataFormat,"__esModule",{value:!0}),ReplayGainDataFormat.ReplayGain=void 0;const e=requireUtil$1();var r;(function(t){t[t.not_set=0]="not_set",t[t.radio=1]="radio",t[t.audiophile=2]="audiophile"})(r||(r={}));var n;return function(t){t[t.unspecified=0]="unspecified",t[t.engineer=1]="engineer",t[t.user=2]="user",t[t.automatic=3]="automatic",t[t.rms_average=4]="rms_average"}(n||(n={})),ReplayGainDataFormat.ReplayGain={len:2,get:(t,o)=>{const l=e.getBitAllignedNumber(t,o,0,3),u=e.getBitAllignedNumber(t,o,6,1),m=e.getBitAllignedNumber(t,o,7,9)/10;if(l>0)return{type:e.getBitAllignedNumber(t,o,0,3),origin:e.getBitAllignedNumber(t,o,3,3),adjustment:u?-m:m}}},ReplayGainDataFormat}var hasRequiredExtendedLameHeader;function requireExtendedLameHeader(){if(hasRequiredExtendedLameHeader)return ExtendedLameHeader;hasRequiredExtendedLameHeader=1,Object.defineProperty(ExtendedLameHeader,"__esModule",{value:!0}),ExtendedLameHeader.ExtendedLameHeader=void 0;const e=requireLib$2(),r=requireUtil$1(),n=requireReplayGainDataFormat();return ExtendedLameHeader.ExtendedLameHeader={len:27,get:(t,o)=>{const l=e.UINT32_BE.get(t,o+2);return{revision:r.getBitAllignedNumber(t,o,0,4),vbr_method:r.getBitAllignedNumber(t,o,4,4),lowpass_filter:100*e.UINT8.get(t,o+1),track_peak:l===0?void 0:l/Math.pow(2,23),track_gain:n.ReplayGain.get(t,6),album_gain:n.ReplayGain.get(t,8),music_length:e.UINT32_BE.get(t,o+20),music_crc:e.UINT8.get(t,o+24),header_crc:e.UINT16_BE.get(t,o+24)}}},ExtendedLameHeader}var hasRequiredXingTag;function requireXingTag(){return hasRequiredXingTag||(hasRequiredXingTag=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.readXingHeader=e.XingHeaderFlags=e.LameEncoderVersion=e.InfoTagHeaderTag=void 0;const r=requireLib$2(),n=requireUtil$1(),t=requireExtendedLameHeader();e.InfoTagHeaderTag=new r.StringType(4,"ascii"),e.LameEncoderVersion=new r.StringType(6,"ascii"),e.XingHeaderFlags={len:4,get:(l,u)=>({frames:n.isBitSet(l,u,31),bytes:n.isBitSet(l,u,30),toc:n.isBitSet(l,u,29),vbrScale:n.isBitSet(l,u,28)})};async function o(l){const u=await l.readToken(e.XingHeaderFlags),m={};if(u.frames&&(m.numFrames=await l.readToken(r.UINT32_BE)),u.bytes&&(m.streamSize=await l.readToken(r.UINT32_BE)),u.toc&&(m.toc=Buffer.alloc(100),await l.readBuffer(m.toc)),u.vbrScale&&(m.vbrScale=await l.readToken(r.UINT32_BE)),await l.peekToken(new r.StringType(4,"ascii"))==="LAME"&&(await l.ignore(4),m.lame={version:await l.readToken(new r.StringType(5,"ascii"))},m.lame.version.match(/\d+.\d+/g))){const f=m.lame.version.match(/\d+.\d+/g)[0].split(".").map(s=>parseInt(s,10));f[0]>=3&&f[1]>=90&&(m.lame.extended=await l.readToken(t.ExtendedLameHeader))}return m}e.readXingHeader=o}(XingTag)),XingTag}var hasRequiredMpegParser;function requireMpegParser(){if(hasRequiredMpegParser)return MpegParser;hasRequiredMpegParser=1,Object.defineProperty(MpegParser,"__esModule",{value:!0}),MpegParser.MpegParser=void 0;const e=requireLib$2(),r=requireCore$2(),n=requireBrowser$3(),t=requireUtil$1(),o=requireAbstractID3Parser(),l=requireXingTag(),u=(0,n.default)("music-metadata:parser:mpeg"),m=1024,d={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,void 0,void 0,-1]},i=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class c{constructor(h,b){this.versionIndex=t.getBitAllignedNumber(h,b+1,3,2),this.layer=c.LayerDescription[t.getBitAllignedNumber(h,b+1,5,2)],this.versionIndex>1&&this.layer===0?this.parseAdtsHeader(h,b):this.parseMpegHeader(h,b),this.isProtectedByCRC=!t.isBitSet(h,b+1,7)}calcDuration(h){return h*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return c.samplesInFrameTable[this.version===1?0:1][this.layer]}calculateSideInfoLength(){if(this.layer!==3)return 2;if(this.channelModeIndex===3){if(this.version===1)return 17;if(this.version===2||this.version===2.5)return 9}else{if(this.version===1)return 32;if(this.version===2||this.version===2.5)return 17}}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(h,b){this.container="MPEG",this.bitrateIndex=t.getBitAllignedNumber(h,b+2,0,4),this.sampRateFreqIndex=t.getBitAllignedNumber(h,b+2,4,2),this.padding=t.isBitSet(h,b+2,6),this.privateBit=t.isBitSet(h,b+2,7),this.channelModeIndex=t.getBitAllignedNumber(h,b+3,0,2),this.modeExtension=t.getBitAllignedNumber(h,b+3,2,2),this.isCopyrighted=t.isBitSet(h,b+3,4),this.isOriginalMedia=t.isBitSet(h,b+3,5),this.emphasis=t.getBitAllignedNumber(h,b+3,7,2),this.version=c.VersionID[this.versionIndex],this.channelMode=c.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const g=this.calcBitrate();if(!g)throw new Error("Cannot determine bit-rate");if(this.bitrate=g*1e3,this.samplingRate=this.calcSamplingRate(),this.samplingRate==null)throw new Error("Cannot determine sampling-rate")}parseAdtsHeader(h,b){u("layer=0 => ADTS"),this.version=this.versionIndex===2?4:2,this.container="ADTS/MPEG-"+this.version;const g=t.getBitAllignedNumber(h,b+2,0,2);this.codec="AAC",this.codecProfile=d.AudioObjectTypes[g],u(`MPEG-4 audio-codec=${this.codec}`);const y=t.getBitAllignedNumber(h,b+2,2,4);this.samplingRate=d.SamplingFrequencies[y],u(`sampling-rate=${this.samplingRate}`);const S=t.getBitAllignedNumber(h,b+2,7,3);this.mp4ChannelConfig=i[S],u(`channel-config=${this.mp4ChannelConfig.join("+")}`),this.frameLength=t.getBitAllignedNumber(h,b+3,6,2)<<11}calcBitrate(){if(this.bitrateIndex===0||this.bitrateIndex===15)return;const h=`${Math.floor(this.version)}${this.layer}`;return c.bitrate_index[this.bitrateIndex][h]}calcSamplingRate(){return this.sampRateFreqIndex===3?null:c.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}c.SyncByte1=255,c.SyncByte2=224,c.VersionID=[2.5,null,2,1],c.LayerDescription=[0,3,2,1],c.ChannelMode=["stereo","joint_stereo","dual_channel","mono"],c.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}},c.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}},c.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];const f={len:4,get:(p,h)=>new c(p,h)};function s(p){return"V"+Math.floor((100-p)/10)}let a=class extends o.AbstractID3Parser{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.calculateEofDuration=!1,this.buf_frame_header=Buffer.alloc(4),this.syncPeek={buf:Buffer.alloc(m),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1);try{let h=!1;for(;!h;)await this.sync(),h=await this.parseCommonMpegHeader()}catch(h){if(h instanceof r.EndOfStreamError){if(u("End-of-stream"),this.calculateEofDuration){const b=this.frameCount*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",b);const g=b/this.metadata.format.sampleRate;u(`Calculate duration at EOF: ${g} sec.`,g),this.metadata.setFormat("duration",g)}}else throw h}}finalize(){const h=this.metadata.format,b=this.metadata.native.hasOwnProperty("ID3v1");if(h.duration&&this.tokenizer.fileInfo.size){const g=this.tokenizer.fileInfo.size-this.mpegOffset-(b?128:0);h.codecProfile&&h.codecProfile[0]==="V"&&this.metadata.setFormat("bitrate",g*8/h.duration)}else if(this.tokenizer.fileInfo.size&&h.codecProfile==="CBR"){const g=this.tokenizer.fileInfo.size-this.mpegOffset-(b?128:0),y=Math.round(g/this.frame_size)*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",y);const S=y/h.sampleRate;u("Calculate CBR duration based on file size: %s",S),this.metadata.setFormat("duration",S)}}async sync(){let h=!1;for(;;){let b=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:m,mayBeLess:!0}),this.syncPeek.len<=163)throw new r.EndOfStreamError;for(;;)if(h&&(this.syncPeek.buf[b]&224)===224){this.buf_frame_header[0]=c.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[b],await this.tokenizer.ignore(b),u(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(u(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),this.syncFrameCount=this.frameCount;return}else if(h=!1,b=this.syncPeek.buf.indexOf(c.SyncByte1,b),b===-1){if(this.syncPeek.len<this.syncPeek.buf.length)throw new r.EndOfStreamError;await this.tokenizer.ignore(this.syncPeek.len);break}else++b,h=!0}}async parseCommonMpegHeader(){this.frameCount===0&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header,{offset:1,length:3});let h;try{h=f.get(this.buf_frame_header,0)}catch(b){return await this.tokenizer.ignore(1),this.metadata.addWarning("Parse error: "+b.message),!1}return await this.tokenizer.ignore(3),this.metadata.setFormat("container",h.container),this.metadata.setFormat("codec",h.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",h.samplingRate),this.frameCount++,h.version>=2&&h.layer===0?this.parseAdts(h):this.parseAudioFrameHeader(h)}async parseAudioFrameHeader(h){this.metadata.setFormat("numberOfChannels",h.channelMode==="mono"?1:2),this.metadata.setFormat("bitrate",h.bitrate),this.frameCount<20*1e4&&u("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,h.layer,h.bitrate,h.samplingRate);const b=h.calcSlotSize();if(b===null)throw new Error("invalid slot_size");const g=h.calcSamplesPerFrame();u(`samples_per_frame=${g}`);const S=g/8*h.bitrate/h.samplingRate+(h.padding?b:0);if(this.frame_size=Math.floor(S),this.audioFrameHeader=h,this.bitrates.push(h.bitrate),this.frameCount===1)return this.offset=f.len,await this.skipSideInformation(),!1;if(this.frameCount===3){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=g,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&this.frameCount===4&&(this.samplesPerFrame=g,this.calculateEofDuration=!0),this.offset=4,h.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(h){const b=Buffer.alloc(3);await this.tokenizer.readBuffer(b),h.frameLength+=t.getBitAllignedNumber(b,0,0,11),this.totalDataLength+=h.frameLength,this.samplesPerFrame=1024;const g=h.samplingRate/this.samplesPerFrame,S=8*(this.frameCount===0?0:this.totalDataLength/this.frameCount)*g+.5;if(this.metadata.setFormat("bitrate",S),u(`frame-count=${this.frameCount}, size=${h.frameLength} bytes, bit-rate=${S}`),await this.tokenizer.ignore(h.frameLength>7?h.frameLength-7:1),this.frameCount===3)if(this.metadata.setFormat("codecProfile",h.codecProfile),h.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",h.mp4ChannelConfig.length),this.options.duration)this.calculateEofDuration=!0;else return!0;return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(e.INT16_BE),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){const h=this.audioFrameHeader.calculateSideInfoLength();await this.tokenizer.readToken(new e.Uint8ArrayType(h)),this.offset+=h,await this.readXtraInfoHeader()}async readXtraInfoHeader(){const h=await this.tokenizer.readToken(l.InfoTagHeaderTag);switch(this.offset+=l.InfoTagHeaderTag.len,h){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":const g=await this.readXingInfoHeader(),y=s(g.vbrScale);return this.metadata.setFormat("codecProfile",y),null;case"Xtra":break;case"LAME":const S=await this.tokenizer.readToken(l.LameEncoderVersion);if(this.frame_size>=this.offset+l.LameEncoderVersion.len)return this.offset+=l.LameEncoderVersion.len,this.metadata.setFormat("tool","LAME "+S),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header");break}const b=this.frame_size-this.offset;return b<0?this.metadata.addWarning("Frame "+this.frameCount+"corrupt: negative frameDataLeft"):await this.skipFrameData(b),null}async readXingInfoHeader(){const h=this.tokenizer.position,b=await(0,l.readXingHeader)(this.tokenizer);if(this.offset+=this.tokenizer.position-h,b.lame&&(this.metadata.setFormat("tool","LAME "+t.stripNulls(b.lame.version)),b.lame.extended&&(this.metadata.setFormat("trackPeakLevel",b.lame.extended.track_peak),b.lame.extended.track_gain&&this.metadata.setFormat("trackGain",b.lame.extended.track_gain.adjustment),b.lame.extended.album_gain&&this.metadata.setFormat("albumGain",b.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",b.lame.extended.music_length/1e3))),b.streamSize){const y=this.audioFrameHeader.calcDuration(b.numFrames);return this.metadata.setFormat("duration",y),u("Get duration from Xing header: %s",this.metadata.format.duration),b}const g=this.frame_size-this.offset;return await this.skipFrameData(g),b}async skipFrameData(h){if(h<0)throw new Error("frame-data-left cannot be negative");await this.tokenizer.ignore(h),this.countSkipFrameData+=h}areAllSame(h){const b=h[0];return h.every(g=>g===b)}};return MpegParser.MpegParser=a,MpegParser}var musepack={},MpcSv8Parser={},StreamVersion8={},hasRequiredStreamVersion8;function requireStreamVersion8(){if(hasRequiredStreamVersion8)return StreamVersion8;hasRequiredStreamVersion8=1,Object.defineProperty(StreamVersion8,"__esModule",{value:!0}),StreamVersion8.StreamReader=void 0;const e=requireLib$2(),r=requireBrowser$3(),n=requireUtil$1(),t=(0,r.default)("music-metadata:parser:musepack:sv8"),o=new e.StringType(2,"binary"),l={len:5,get:(d,i)=>({crc:e.UINT32_LE.get(d,i),streamVersion:e.UINT8.get(d,i+4)})},u={len:2,get:(d,i)=>({sampleFrequency:[44100,48e3,37800,32e3][n.getBitAllignedNumber(d,i,0,3)],maxUsedBands:n.getBitAllignedNumber(d,i,3,5),channelCount:n.getBitAllignedNumber(d,i+1,0,4)+1,msUsed:n.isBitSet(d,i+1,4),audioBlockFrames:n.getBitAllignedNumber(d,i+1,5,3)})};class m{constructor(i){this.tokenizer=i}async readPacketHeader(){const i=await this.tokenizer.readToken(o),c=await this.readVariableSizeField();return{key:i,payloadLength:c.value-2-c.len}}async readStreamHeader(i){const c={};t(`Reading SH at offset=${this.tokenizer.position}`);const f=await this.tokenizer.readToken(l);i-=l.len,Object.assign(c,f),t(`SH.streamVersion = ${f.streamVersion}`);const s=await this.readVariableSizeField();i-=s.len,c.sampleCount=s.value;const a=await this.readVariableSizeField();i-=a.len,c.beginningOfSilence=a.value;const p=await this.tokenizer.readToken(u);return i-=u.len,Object.assign(c,p),await this.tokenizer.ignore(i),c}async readVariableSizeField(i=1,c=0){let f=await this.tokenizer.readNumber(e.UINT8);return(f&128)===0?{len:i,value:c+f}:(f&=127,f+=c,this.readVariableSizeField(i+1,f<<7))}}return StreamVersion8.StreamReader=m,StreamVersion8}var hasRequiredMpcSv8Parser;function requireMpcSv8Parser(){if(hasRequiredMpcSv8Parser)return MpcSv8Parser;hasRequiredMpcSv8Parser=1,Object.defineProperty(MpcSv8Parser,"__esModule",{value:!0}),MpcSv8Parser.MpcSv8Parser=void 0;const e=requireBrowser$3(),r=requireBasicParser(),n=requireAPEv2Parser(),t=requireFourCC(),o=requireStreamVersion8(),l=(0,e.default)("music-metadata:parser:musepack");let u=class extends r.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){if(await this.tokenizer.readToken(t.FourCcToken)!=="MPCK")throw new Error("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const d=new o.StreamReader(this.tokenizer);do{const i=await d.readPacketHeader();switch(l(`packet-header key=${i.key}, payloadLength=${i.payloadLength}`),i.key){case"SH":const c=await d.readStreamHeader(i.payloadLength);this.metadata.setFormat("numberOfSamples",c.sampleCount),this.metadata.setFormat("sampleRate",c.sampleFrequency),this.metadata.setFormat("duration",c.sampleCount/c.sampleFrequency),this.metadata.setFormat("numberOfChannels",c.channelCount);break;case"AP":this.audioLength+=i.payloadLength,await this.tokenizer.ignore(i.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(i.payloadLength);break;case"SE":return this.metadata.setFormat("bitrate",this.audioLength*8/this.metadata.format.duration),n.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options);default:throw new Error(`Unexpected header: ${i.key}`)}}while(!0)}};return MpcSv8Parser.MpcSv8Parser=u,MpcSv8Parser}var MpcSv7Parser={},BitReader={},hasRequiredBitReader;function requireBitReader(){if(hasRequiredBitReader)return BitReader;hasRequiredBitReader=1,Object.defineProperty(BitReader,"__esModule",{value:!0}),BitReader.BitReader=void 0;const e=requireLib$2();let r=class{constructor(t){this.tokenizer=t,this.pos=0,this.dword=void 0}async read(t){for(;this.dword===void 0;)this.dword=await this.tokenizer.readToken(e.UINT32_LE);let o=this.dword;return this.pos+=t,this.pos<32?(o>>>=32-this.pos,o&(1<<t)-1):(this.pos-=32,this.pos===0?(this.dword=void 0,o&(1<<t)-1):(this.dword=await this.tokenizer.readToken(e.UINT32_LE),this.pos&&(o<<=this.pos,o|=this.dword>>>32-this.pos),o&(1<<t)-1))}async ignore(t){if(this.pos>0){const u=32-this.pos;this.dword=void 0,t-=u,this.pos=0}const o=t%32,l=(t-o)/32;return await this.tokenizer.ignore(l*4),this.read(o)}};return BitReader.BitReader=r,BitReader}var StreamVersion7={},hasRequiredStreamVersion7;function requireStreamVersion7(){if(hasRequiredStreamVersion7)return StreamVersion7;hasRequiredStreamVersion7=1,Object.defineProperty(StreamVersion7,"__esModule",{value:!0}),StreamVersion7.Header=void 0;const e=requireLib$2(),r=requireUtil$1();return StreamVersion7.Header={len:6*4,get:(n,t)=>{const o={signature:Buffer.from(n).toString("latin1",t,t+3),streamMinorVersion:r.getBitAllignedNumber(n,t+3,0,4),streamMajorVersion:r.getBitAllignedNumber(n,t+3,4,4),frameCount:e.UINT32_LE.get(n,t+4),maxLevel:e.UINT16_LE.get(n,t+8),sampleFrequency:[44100,48e3,37800,32e3][r.getBitAllignedNumber(n,t+10,0,2)],link:r.getBitAllignedNumber(n,t+10,2,2),profile:r.getBitAllignedNumber(n,t+10,4,4),maxBand:r.getBitAllignedNumber(n,t+11,0,6),intensityStereo:r.isBitSet(n,t+11,6),midSideStereo:r.isBitSet(n,t+11,7),titlePeak:e.UINT16_LE.get(n,t+12),titleGain:e.UINT16_LE.get(n,t+14),albumPeak:e.UINT16_LE.get(n,t+16),albumGain:e.UINT16_LE.get(n,t+18),lastFrameLength:e.UINT32_LE.get(n,t+20)>>>20&2047,trueGapless:r.isBitSet(n,t+23,0)};return o.lastFrameLength=o.trueGapless?e.UINT32_LE.get(n,20)>>>20&2047:0,o}},StreamVersion7}var hasRequiredMpcSv7Parser;function requireMpcSv7Parser(){if(hasRequiredMpcSv7Parser)return MpcSv7Parser;hasRequiredMpcSv7Parser=1,Object.defineProperty(MpcSv7Parser,"__esModule",{value:!0}),MpcSv7Parser.MpcSv7Parser=void 0;const e=requireBrowser$3(),r=requireBasicParser(),n=requireAPEv2Parser(),t=requireBitReader(),o=requireStreamVersion7(),l=(0,e.default)("music-metadata:parser:musepack");let u=class extends r.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){const d=await this.tokenizer.readToken(o.Header);if(d.signature!=="MP+")throw new Error("Unexpected magic number");l(`stream-version=${d.streamMajorVersion}.${d.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",d.sampleFrequency);const i=1152*(d.frameCount-1)+d.lastFrameLength;this.metadata.setFormat("numberOfSamples",i),this.duration=i/d.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new t.BitReader(this.tokenizer),this.metadata.setFormat("numberOfChannels",d.midSideStereo||d.intensityStereo?2:1);const c=await this.bitreader.read(8);return this.metadata.setFormat("codec",(c/100).toFixed(2)),await this.skipAudioData(d.frameCount),l(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),n.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async skipAudioData(d){for(;d-- >0;){const c=await this.bitreader.read(20);this.audioLength+=20+c,await this.bitreader.ignore(c)}const i=await this.bitreader.read(11);this.audioLength+=i,this.metadata.setFormat("bitrate",this.audioLength/this.duration)}};return MpcSv7Parser.MpcSv7Parser=u,MpcSv7Parser}var hasRequiredMusepack;function requireMusepack(){if(hasRequiredMusepack)return musepack;hasRequiredMusepack=1,Object.defineProperty(musepack,"__esModule",{value:!0});const e=requireBrowser$3(),r=requireLib$2(),n=requireAbstractID3Parser(),t=requireMpcSv8Parser(),o=requireMpcSv7Parser(),l=(0,e.default)("music-metadata:parser:musepack");class u extends n.AbstractID3Parser{async postId3v2Parse(){const d=await this.tokenizer.peekToken(new r.StringType(3,"binary"));let i;switch(d){case"MP+":{l("Musepack stream-version 7"),i=new o.MpcSv7Parser;break}case"MPC":{l("Musepack stream-version 8"),i=new t.MpcSv8Parser;break}default:throw new Error("Invalid Musepack signature prefix")}return i.init(this.metadata,this.tokenizer,this.options),i.parse()}}return musepack.default=u,musepack}var OggParser={},OpusParser={},Opus={},hasRequiredOpus;function requireOpus(){if(hasRequiredOpus)return Opus;hasRequiredOpus=1,Object.defineProperty(Opus,"__esModule",{value:!0}),Opus.IdHeader=void 0;const e=requireLib$2();class r{constructor(t){if(this.len=t,t<19)throw new Error("ID-header-page 0 should be at least 19 bytes long")}get(t,o){return{magicSignature:new e.StringType(8,"ascii").get(t,o+0),version:t.readUInt8(o+8),channelCount:t.readUInt8(o+9),preSkip:t.readInt16LE(o+10),inputSampleRate:t.readInt32LE(o+12),outputGain:t.readInt16LE(o+16),channelMapping:t.readUInt8(o+18)}}}return Opus.IdHeader=r,Opus}var hasRequiredOpusParser;function requireOpusParser(){if(hasRequiredOpusParser)return OpusParser;hasRequiredOpusParser=1,Object.defineProperty(OpusParser,"__esModule",{value:!0}),OpusParser.OpusParser=void 0;const e=requireLib$2(),r=requireVorbisParser(),n=requireOpus();let t=class extends r.VorbisParser{constructor(l,u,m){super(l,u),this.tokenizer=m,this.lastPos=-1}parseFirstPage(l,u){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new n.IdHeader(u.length).get(u,0),this.idHeader.magicSignature!=="OpusHead")throw new Error("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount)}parseFullPage(l){switch(new e.StringType(8,"ascii").get(l,0)){case"OpusTags":this.parseUserCommentList(l,8),this.lastPos=this.tokenizer.position-l.length;break}}calculateDuration(l){if(this.metadata.format.sampleRate&&l.absoluteGranulePosition>=0){const u=l.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",u),this.metadata.setFormat("duration",u/48e3),this.lastPos!==-1&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const m=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*m/this.metadata.format.duration)}}}};return OpusParser.OpusParser=t,OpusParser}var SpeexParser={},Speex={},hasRequiredSpeex;function requireSpeex(){if(hasRequiredSpeex)return Speex;hasRequiredSpeex=1,Object.defineProperty(Speex,"__esModule",{value:!0}),Speex.Header=void 0;const e=requireLib$2(),r=requireUtil$1();return Speex.Header={len:80,get:(n,t)=>({speex:new e.StringType(8,"ascii").get(n,t+0),version:r.trimRightNull(new e.StringType(20,"ascii").get(n,t+8)),version_id:n.readInt32LE(t+28),header_size:n.readInt32LE(t+32),rate:n.readInt32LE(t+36),mode:n.readInt32LE(t+40),mode_bitstream_version:n.readInt32LE(t+44),nb_channels:n.readInt32LE(t+48),bitrate:n.readInt32LE(t+52),frame_size:n.readInt32LE(t+56),vbr:n.readInt32LE(t+60),frames_per_packet:n.readInt32LE(t+64),extra_headers:n.readInt32LE(t+68),reserved1:n.readInt32LE(t+72),reserved2:n.readInt32LE(t+76)})},Speex}var hasRequiredSpeexParser;function requireSpeexParser(){if(hasRequiredSpeexParser)return SpeexParser;hasRequiredSpeexParser=1,Object.defineProperty(SpeexParser,"__esModule",{value:!0}),SpeexParser.SpeexParser=void 0;const e=requireBrowser$3(),r=requireVorbisParser(),n=requireSpeex(),t=(0,e.default)("music-metadata:parser:ogg:speex");let o=class extends r.VorbisParser{constructor(u,m,d){super(u,m),this.tokenizer=d}parseFirstPage(u,m){t("First Ogg/Speex page");const d=n.Header.get(m,0);this.metadata.setFormat("codec",`Speex ${d.version}`),this.metadata.setFormat("numberOfChannels",d.nb_channels),this.metadata.setFormat("sampleRate",d.rate),d.bitrate!==-1&&this.metadata.setFormat("bitrate",d.bitrate)}};return SpeexParser.SpeexParser=o,SpeexParser}var TheoraParser={},Theora={},hasRequiredTheora;function requireTheora(){if(hasRequiredTheora)return Theora;hasRequiredTheora=1,Object.defineProperty(Theora,"__esModule",{value:!0}),Theora.IdentificationHeader=void 0;const e=requireLib$2();return Theora.IdentificationHeader={len:42,get:(r,n)=>({id:new e.StringType(7,"ascii").get(r,n),vmaj:r.readUInt8(n+7),vmin:r.readUInt8(n+8),vrev:r.readUInt8(n+9),vmbw:r.readUInt16BE(n+10),vmbh:r.readUInt16BE(n+17),nombr:e.UINT24_BE.get(r,n+37),nqual:r.readUInt8(n+40)})},Theora}var hasRequiredTheoraParser;function requireTheoraParser(){if(hasRequiredTheoraParser)return TheoraParser;hasRequiredTheoraParser=1,Object.defineProperty(TheoraParser,"__esModule",{value:!0}),TheoraParser.TheoraParser=void 0;const e=requireBrowser$3(),r=requireTheora(),n=(0,e.default)("music-metadata:parser:ogg:theora");let t=class{constructor(l,u,m){this.metadata=l,this.tokenizer=m}parsePage(l,u){l.headerType.firstPage&&this.parseFirstPage(l,u)}flush(){n("flush")}calculateDuration(l){n("duration calculation not implemented")}parseFirstPage(l,u){n("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const m=r.IdentificationHeader.get(u,0);this.metadata.setFormat("bitrate",m.nombr)}};return TheoraParser.TheoraParser=t,TheoraParser}var hasRequiredOggParser;function requireOggParser(){if(hasRequiredOggParser)return OggParser;hasRequiredOggParser=1,Object.defineProperty(OggParser,"__esModule",{value:!0}),OggParser.OggParser=OggParser.SegmentTable=void 0;const e=requireLib$2(),r=requireCore$2(),n=requireBrowser$3(),t=requireUtil$1(),o=requireFourCC(),l=requireBasicParser(),u=requireVorbisParser(),m=requireOpusParser(),d=requireSpeexParser(),i=requireTheoraParser(),c=(0,n.default)("music-metadata:parser:ogg");class f{static sum(p,h,b){let g=0;for(let y=h;y<h+b;++y)g+=p[y];return g}constructor(p){this.len=p.page_segments}get(p,h){return{totalPageSize:f.sum(p,h,this.len)}}}OggParser.SegmentTable=f;let s=class Ze extends l.BasicParser{async parse(){c("pos=%s, parsePage()",this.tokenizer.position);try{let p;do{if(p=await this.tokenizer.readToken(Ze.Header),p.capturePattern!=="OggS")throw new Error("Invalid Ogg capture pattern");this.metadata.setFormat("container","Ogg"),this.header=p,this.pageNumber=p.pageSequenceNo,c("page#=%s, Ogg.id=%s",p.pageSequenceNo,p.capturePattern);const h=await this.tokenizer.readToken(new f(p));c("totalPageSize=%s",h.totalPageSize);const b=await this.tokenizer.readToken(new e.Uint8ArrayType(h.totalPageSize));if(c("firstPage=%s, lastPage=%s, continued=%s",p.headerType.firstPage,p.headerType.lastPage,p.headerType.continued),p.headerType.firstPage){const g=new e.StringType(7,"ascii").get(Buffer.from(b),0);switch(g){case"vorbis":c("Set page consumer to Ogg/Vorbis"),this.pageConsumer=new u.VorbisParser(this.metadata,this.options);break;case"OpusHea":c("Set page consumer to Ogg/Opus"),this.pageConsumer=new m.OpusParser(this.metadata,this.options,this.tokenizer);break;case"Speex  ":c("Set page consumer to Ogg/Speex"),this.pageConsumer=new d.SpeexParser(this.metadata,this.options,this.tokenizer);break;case"fishead":case"\0theora":c("Set page consumer to Ogg/Theora"),this.pageConsumer=new i.TheoraParser(this.metadata,this.options,this.tokenizer);break;default:throw new Error("gg audio-codec not recognized (id="+g+")")}}this.pageConsumer.parsePage(p,b)}while(!p.headerType.lastPage)}catch(p){if(p instanceof r.EndOfStreamError)this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),c("End-of-stream"),this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),this.header&&this.pageConsumer.calculateDuration(this.header);else if(p.message.startsWith("FourCC"))this.pageNumber>0&&(this.metadata.addWarning("Invalid FourCC ID, maybe last OGG-page is not marked with last-page flag"),this.pageConsumer.flush());else throw p}}};return s.Header={len:27,get:(a,p)=>({capturePattern:o.FourCcToken.get(a,p),version:e.UINT8.get(a,p+4),headerType:{continued:t.getBit(a,p+5,0),firstPage:t.getBit(a,p+5,1),lastPage:t.getBit(a,p+5,2)},absoluteGranulePosition:Number(e.UINT64_LE.get(a,p+6)),streamSerialNumber:e.UINT32_LE.get(a,p+14),pageSequenceNo:e.UINT32_LE.get(a,p+18),pageChecksum:e.UINT32_LE.get(a,p+22),page_segments:e.UINT8.get(a,p+26)})},OggParser.OggParser=s,OggParser}var WaveParser={},RiffChunk={},hasRequiredRiffChunk;function requireRiffChunk(){if(hasRequiredRiffChunk)return RiffChunk;hasRequiredRiffChunk=1,Object.defineProperty(RiffChunk,"__esModule",{value:!0}),RiffChunk.ListInfoTagValue=RiffChunk.Header=void 0;const e=requireLib$2();RiffChunk.Header={len:8,get:(n,t)=>({chunkID:n.toString("binary",t,t+4),chunkSize:e.UINT32_LE.get(n,4)})};class r{constructor(t){this.tagHeader=t,this.len=t.chunkSize,this.len+=this.len&1}get(t,o){return new e.StringType(this.tagHeader.chunkSize,"ascii").get(t,o)}}return RiffChunk.ListInfoTagValue=r,RiffChunk}var WaveChunk={},hasRequiredWaveChunk;function requireWaveChunk(){return hasRequiredWaveChunk||(hasRequiredWaveChunk=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FactChunk=e.Format=e.WaveFormat=void 0,function(t){t[t.PCM=1]="PCM",t[t.ADPCM=2]="ADPCM",t[t.IEEE_FLOAT=3]="IEEE_FLOAT",t[t.MPEG_ADTS_AAC=5632]="MPEG_ADTS_AAC",t[t.MPEG_LOAS=5634]="MPEG_LOAS",t[t.RAW_AAC1=255]="RAW_AAC1",t[t.DOLBY_AC3_SPDIF=146]="DOLBY_AC3_SPDIF",t[t.DVM=8192]="DVM",t[t.RAW_SPORT=576]="RAW_SPORT",t[t.ESST_AC3=577]="ESST_AC3",t[t.DRM=9]="DRM",t[t.DTS2=8193]="DTS2",t[t.MPEG=80]="MPEG"}(e.WaveFormat||(e.WaveFormat={}));class r{constructor(o){if(o.chunkSize<16)throw new Error("Invalid chunk size");this.len=o.chunkSize}get(o,l){return{wFormatTag:o.readUInt16LE(l),nChannels:o.readUInt16LE(l+2),nSamplesPerSec:o.readUInt32LE(l+4),nAvgBytesPerSec:o.readUInt32LE(l+8),nBlockAlign:o.readUInt16LE(l+12),wBitsPerSample:o.readUInt16LE(l+14)}}}e.Format=r;class n{constructor(o){if(o.chunkSize<4)throw new Error("Invalid fact chunk size.");this.len=o.chunkSize}get(o,l){return{dwSampleLength:o.readUInt32LE(l)}}}e.FactChunk=n}(WaveChunk)),WaveChunk}var BwfChunk={},hasRequiredBwfChunk;function requireBwfChunk(){if(hasRequiredBwfChunk)return BwfChunk;hasRequiredBwfChunk=1,Object.defineProperty(BwfChunk,"__esModule",{value:!0}),BwfChunk.BroadcastAudioExtensionChunk=void 0;const e=requireLib$2(),r=requireUtil$1();return BwfChunk.BroadcastAudioExtensionChunk={len:420,get:(n,t)=>({description:(0,r.stripNulls)(new e.StringType(256,"ascii").get(n,t)).trim(),originator:(0,r.stripNulls)(new e.StringType(32,"ascii").get(n,t+256)).trim(),originatorReference:(0,r.stripNulls)(new e.StringType(32,"ascii").get(n,t+288)).trim(),originationDate:(0,r.stripNulls)(new e.StringType(10,"ascii").get(n,t+320)).trim(),originationTime:(0,r.stripNulls)(new e.StringType(8,"ascii").get(n,t+330)).trim(),timeReferenceLow:e.UINT32_LE.get(n,t+338),timeReferenceHigh:e.UINT32_LE.get(n,t+342),version:e.UINT16_LE.get(n,t+346),umid:new e.Uint8ArrayType(64).get(n,t+348),loudnessValue:e.UINT16_LE.get(n,t+412),maxTruePeakLevel:e.UINT16_LE.get(n,t+414),maxMomentaryLoudness:e.UINT16_LE.get(n,t+416),maxShortTermLoudness:e.UINT16_LE.get(n,t+418)})},BwfChunk}var hasRequiredWaveParser;function requireWaveParser(){if(hasRequiredWaveParser)return WaveParser;hasRequiredWaveParser=1,Object.defineProperty(WaveParser,"__esModule",{value:!0}),WaveParser.WaveParser=void 0;const e=requireCore$2(),r=requireLib$2(),n=requireBrowser$3(),t=requireRiffChunk(),o=requireWaveChunk(),l=requireID3v2Parser(),u=requireUtil$1(),m=requireFourCC(),d=requireBasicParser(),i=requireBwfChunk(),c=(0,n.default)("music-metadata:parser:RIFF");let f=class extends d.BasicParser{async parse(){const a=await this.tokenizer.readToken(t.Header);if(c(`pos=${this.tokenizer.position}, parse: chunkID=${a.chunkID}`),a.chunkID==="RIFF")return this.parseRiffChunk(a.chunkSize).catch(p=>{if(!(p instanceof e.EndOfStreamError))throw p})}async parseRiffChunk(a){const p=await this.tokenizer.readToken(m.FourCcToken);switch(this.metadata.setFormat("container",p),p){case"WAVE":return this.readWaveChunk(a-m.FourCcToken.len);default:throw new Error(`Unsupported RIFF format: RIFF/${p}`)}}async readWaveChunk(a){for(;a>=t.Header.len;){const p=await this.tokenizer.readToken(t.Header);switch(a-=t.Header.len+p.chunkSize,p.chunkSize>a&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=p,c(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${p.chunkID}`),p.chunkID){case"LIST":await this.parseListTag(p);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new o.FactChunk(p));break;case"fmt ":const h=await this.tokenizer.readToken(new o.Format(p));let b=o.WaveFormat[h.wFormatTag];b||(c("WAVE/non-PCM format="+h.wFormatTag),b="non-PCM ("+h.wFormatTag+")"),this.metadata.setFormat("codec",b),this.metadata.setFormat("bitsPerSample",h.wBitsPerSample),this.metadata.setFormat("sampleRate",h.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",h.nChannels),this.metadata.setFormat("bitrate",h.nBlockAlign*h.nSamplesPerSec*8),this.blockAlign=h.nBlockAlign;break;case"id3 ":case"ID3 ":const g=await this.tokenizer.readToken(new r.Uint8ArrayType(p.chunkSize)),y=e.fromBuffer(g);await new l.ID3v2Parser().parse(this.metadata,y,this.options);break;case"data":this.metadata.format.lossless!==!1&&this.metadata.setFormat("lossless",!0);let S=p.chunkSize;if(this.tokenizer.fileInfo.size){const T=this.tokenizer.fileInfo.size-this.tokenizer.position;T<S&&(this.metadata.addWarning("data chunk length exceeding file length"),S=T)}const E=this.fact?this.fact.dwSampleLength:S===4294967295?void 0:S/this.blockAlign;E&&(this.metadata.setFormat("numberOfSamples",E),this.metadata.setFormat("duration",E/this.metadata.format.sampleRate)),this.metadata.format.codec==="ADPCM"?this.metadata.setFormat("bitrate",352e3):this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(p.chunkSize);break;case"bext":const I=await this.tokenizer.readToken(i.BroadcastAudioExtensionChunk);Object.keys(I).forEach(T=>{this.metadata.addTag("exif","bext."+T,I[T])});const k=p.chunkSize-i.BroadcastAudioExtensionChunk.len;await this.tokenizer.ignore(k);break;case"\0\0\0\0":c(`Ignore padding chunk: RIFF/${p.chunkID} of ${p.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+p.chunkID),await this.tokenizer.ignore(p.chunkSize);break;default:c(`Ignore chunk: RIFF/${p.chunkID} of ${p.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+p.chunkID),await this.tokenizer.ignore(p.chunkSize)}this.header.chunkSize%2===1&&(c("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(a){const p=await this.tokenizer.readToken(new r.StringType(4,"binary"));switch(c("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,p),p){case"INFO":return this.parseRiffInfoTags(a.chunkSize-4);case"adtl":default:return this.metadata.addWarning("Ignore chunk: RIFF/WAVE/LIST/"+p),c("Ignoring chunkID=RIFF/WAVE/LIST/"+p),this.tokenizer.ignore(a.chunkSize-4).then()}}async parseRiffInfoTags(a){for(;a>=8;){const p=await this.tokenizer.readToken(t.Header),h=new t.ListInfoTagValue(p),b=await this.tokenizer.readToken(h);this.addTag(p.chunkID,u.stripNulls(b)),a-=8+h.len}if(a!==0)throw Error("Illegal remaining size: "+a)}addTag(a,p){this.metadata.addTag("exif",a,p)}};return WaveParser.WaveParser=f,WaveParser}var WavPackParser={},WavPackToken={},hasRequiredWavPackToken;function requireWavPackToken(){if(hasRequiredWavPackToken)return WavPackToken;hasRequiredWavPackToken=1,Object.defineProperty(WavPackToken,"__esModule",{value:!0}),WavPackToken.WavPack=void 0;const e=requireLib$2(),r=requireFourCC(),n=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1];class t{static isBitSet(l,u){return t.getBitAllignedNumber(l,u,1)===1}static getBitAllignedNumber(l,u,m){return l>>>u&4294967295>>>32-m}}return t.BlockHeaderToken={len:32,get:(o,l)=>{const u=e.UINT32_LE.get(o,l+24),m={BlockID:r.FourCcToken.get(o,l),blockSize:e.UINT32_LE.get(o,l+4),version:e.UINT16_LE.get(o,l+8),totalSamples:e.UINT32_LE.get(o,l+12),blockIndex:e.UINT32_LE.get(o,l+16),blockSamples:e.UINT32_LE.get(o,l+20),flags:{bitsPerSample:(1+t.getBitAllignedNumber(u,0,2))*8,isMono:t.isBitSet(u,2),isHybrid:t.isBitSet(u,3),isJointStereo:t.isBitSet(u,4),crossChannel:t.isBitSet(u,5),hybridNoiseShaping:t.isBitSet(u,6),floatingPoint:t.isBitSet(u,7),samplingRate:n[t.getBitAllignedNumber(u,23,4)],isDSD:t.isBitSet(u,31)},crc:new e.Uint8ArrayType(4).get(o,l+28)};return m.flags.isDSD&&(m.totalSamples*=8),m}},t.MetadataIdToken={len:1,get:(o,l)=>({functionId:t.getBitAllignedNumber(o[l],0,6),isOptional:t.isBitSet(o[l],5),isOddSize:t.isBitSet(o[l],6),largeBlock:t.isBitSet(o[l],7)})},WavPackToken.WavPack=t,WavPackToken}var hasRequiredWavPackParser;function requireWavPackParser(){if(hasRequiredWavPackParser)return WavPackParser;hasRequiredWavPackParser=1,Object.defineProperty(WavPackParser,"__esModule",{value:!0}),WavPackParser.WavPackParser=void 0;const e=requireLib$2(),r=requireAPEv2Parser(),n=requireFourCC(),t=requireBasicParser(),o=requireWavPackToken(),u=(0,requireBrowser$3().default)("music-metadata:parser:WavPack");let m=class extends t.BasicParser{async parse(){return this.audioDataSize=0,await this.parseWavPackBlocks(),r.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if(await this.tokenizer.peekToken(n.FourCcToken)!=="wvpk")break;const c=await this.tokenizer.readToken(o.WavPack.BlockHeaderToken);if(c.BlockID!=="wvpk")throw new Error("Invalid WavPack Block-ID");u(`WavPack header blockIndex=${c.blockIndex}, len=${o.WavPack.BlockHeaderToken.len}`),c.blockIndex===0&&!this.metadata.format.container&&(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!c.flags.isHybrid),this.metadata.setFormat("bitsPerSample",c.flags.bitsPerSample),c.flags.isDSD||(this.metadata.setFormat("sampleRate",c.flags.samplingRate),this.metadata.setFormat("duration",c.totalSamples/c.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",c.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",c.totalSamples),this.metadata.setFormat("codec",c.flags.isDSD?"DSD":"PCM"));const f=c.blockSize-(o.WavPack.BlockHeaderToken.len-8);await(c.blockIndex===0?this.parseMetadataSubBlock(c,f):this.tokenizer.ignore(f)),c.blockSamples>0&&(this.audioDataSize+=c.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=o.WavPack.BlockHeaderToken.len);this.metadata.setFormat("bitrate",this.audioDataSize*8/this.metadata.format.duration)}async parseMetadataSubBlock(i,c){for(;c>o.WavPack.MetadataIdToken.len;){const f=await this.tokenizer.readToken(o.WavPack.MetadataIdToken),s=await this.tokenizer.readNumber(f.largeBlock?e.UINT24_LE:e.UINT8),a=Buffer.alloc(s*2-(f.isOddSize?1:0));switch(await this.tokenizer.readBuffer(a),u(`Metadata Sub-Blocks functionId=0x${f.functionId.toString(16)}, id.largeBlock=${f.largeBlock},data-size=${a.length}`),f.functionId){case 0:break;case 14:u("ID_DSD_BLOCK");const p=1<<a.readUInt8(0),h=i.flags.samplingRate*p*8;if(!i.flags.isDSD)throw new Error("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",h),this.metadata.setFormat("duration",i.totalSamples/h);break;case 36:u("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",a);break;case 47:u(`ID_BLOCK_CHECKSUM: checksum=${a.toString("hex")}`);break;default:u(`Ignore unsupported meta-sub-block-id functionId=0x${f.functionId.toString(16)}`);break}c-=o.WavPack.MetadataIdToken.len+(f.largeBlock?e.UINT24_LE.len:e.UINT8.len)+s*2,u(`remainingLength=${c}`),f.isOddSize&&this.tokenizer.ignore(1)}if(c!==0)throw new Error("metadata-sub-block should fit it remaining length")}};return WavPackParser.WavPackParser=m,WavPackParser}var DsfParser={},DsfChunk={},hasRequiredDsfChunk;function requireDsfChunk(){return hasRequiredDsfChunk||(hasRequiredDsfChunk=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FormatChunk=e.ChannelType=e.DsdChunk=e.ChunkHeader=void 0;const r=requireLib$2(),n=requireFourCC();e.ChunkHeader={len:12,get:(t,o)=>({id:n.FourCcToken.get(t,o),size:r.UINT64_LE.get(t,o+4)})},e.DsdChunk={len:16,get:(t,o)=>({fileSize:r.INT64_LE.get(t,o),metadataPointer:r.INT64_LE.get(t,o+8)})},function(t){t[t.mono=1]="mono",t[t.stereo=2]="stereo",t[t.channels=3]="channels",t[t.quad=4]="quad",t[t["4 channels"]=5]="4 channels",t[t["5 channels"]=6]="5 channels",t[t["5.1 channels"]=7]="5.1 channels"}(e.ChannelType||(e.ChannelType={})),e.FormatChunk={len:40,get:(t,o)=>({formatVersion:r.INT32_LE.get(t,o),formatID:r.INT32_LE.get(t,o+4),channelType:r.INT32_LE.get(t,o+8),channelNum:r.INT32_LE.get(t,o+12),samplingFrequency:r.INT32_LE.get(t,o+16),bitsPerSample:r.INT32_LE.get(t,o+20),sampleCount:r.INT64_LE.get(t,o+24),blockSizePerChannel:r.INT32_LE.get(t,o+32)})}}(DsfChunk)),DsfChunk}var hasRequiredDsfParser;function requireDsfParser(){if(hasRequiredDsfParser)return DsfParser;hasRequiredDsfParser=1,Object.defineProperty(DsfParser,"__esModule",{value:!0}),DsfParser.DsfParser=void 0;const e=requireBrowser$3(),r=requireAbstractID3Parser(),n=requireDsfChunk(),t=requireID3v2Parser(),o=(0,e.default)("music-metadata:parser:DSF");let l=class extends r.AbstractID3Parser{async postId3v2Parse(){const m=this.tokenizer.position,d=await this.tokenizer.readToken(n.ChunkHeader);if(d.id!=="DSD ")throw new Error("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0);const i=await this.tokenizer.readToken(n.DsdChunk);if(i.metadataPointer===BigInt(0))o("No ID3v2 tag present");else return o(`expect ID3v2 at offset=${i.metadataPointer}`),await this.parseChunks(i.fileSize-d.size),await this.tokenizer.ignore(Number(i.metadataPointer)-this.tokenizer.position-m),new t.ID3v2Parser().parse(this.metadata,this.tokenizer,this.options)}async parseChunks(m){for(;m>=n.ChunkHeader.len;){const d=await this.tokenizer.readToken(n.ChunkHeader);switch(o(`Parsing chunk name=${d.id} size=${d.size}`),d.id){case"fmt ":const i=await this.tokenizer.readToken(n.FormatChunk);this.metadata.setFormat("numberOfChannels",i.channelNum),this.metadata.setFormat("sampleRate",i.samplingFrequency),this.metadata.setFormat("bitsPerSample",i.bitsPerSample),this.metadata.setFormat("numberOfSamples",i.sampleCount),this.metadata.setFormat("duration",Number(i.sampleCount)/i.samplingFrequency);const c=i.bitsPerSample*i.samplingFrequency*i.channelNum;this.metadata.setFormat("bitrate",c);return;default:this.tokenizer.ignore(Number(d.size)-n.ChunkHeader.len);break}m-=d.size}}};return DsfParser.DsfParser=l,DsfParser}var DsdiffParser={},DsdiffToken={},hasRequiredDsdiffToken;function requireDsdiffToken(){if(hasRequiredDsdiffToken)return DsdiffToken;hasRequiredDsdiffToken=1,Object.defineProperty(DsdiffToken,"__esModule",{value:!0}),DsdiffToken.ChunkHeader64=void 0;const e=requireLib$2(),r=requireFourCC();return DsdiffToken.ChunkHeader64={len:12,get:(n,t)=>({chunkID:r.FourCcToken.get(n,t),chunkSize:e.INT64_BE.get(n,t+4)})},DsdiffToken}var hasRequiredDsdiffParser;function requireDsdiffParser(){if(hasRequiredDsdiffParser)return DsdiffParser;hasRequiredDsdiffParser=1,Object.defineProperty(DsdiffParser,"__esModule",{value:!0}),DsdiffParser.DsdiffParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),n=requireCore$2(),t=requireFourCC(),o=requireBasicParser(),l=requireID3v2Parser(),u=requireDsdiffToken(),m=(0,r.default)("music-metadata:parser:aiff");let d=class extends o.BasicParser{async parse(){const c=await this.tokenizer.readToken(u.ChunkHeader64);if(c.chunkID!=="FRM8")throw new Error("Unexpected chunk-ID");const f=(await this.tokenizer.readToken(t.FourCcToken)).trim();switch(f){case"DSD":return this.metadata.setFormat("container",`DSDIFF/${f}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(c.chunkSize-BigInt(t.FourCcToken.len));default:throw Error(`Unsupported DSDIFF type: ${f}`)}}async readFmt8Chunks(c){for(;c>=u.ChunkHeader64.len;){const f=await this.tokenizer.readToken(u.ChunkHeader64);m(`Chunk id=${f.chunkID}`),await this.readData(f),c-=BigInt(u.ChunkHeader64.len)+f.chunkSize}}async readData(c){m(`Reading data of chunk[ID=${c.chunkID}, size=${c.chunkSize}]`);const f=this.tokenizer.position;switch(c.chunkID.trim()){case"FVER":const a=await this.tokenizer.readToken(e.UINT32_LE);m(`DSDIFF version=${a}`);break;case"PROP":if(await this.tokenizer.readToken(t.FourCcToken)!=="SND ")throw new Error("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(c.chunkSize-BigInt(t.FourCcToken.len));break;case"ID3":const h=await this.tokenizer.readToken(new e.Uint8ArrayType(Number(c.chunkSize))),b=n.fromBuffer(h);await new l.ID3v2Parser().parse(this.metadata,b,this.options);break;default:m(`Ignore chunk[ID=${c.chunkID}, size=${c.chunkSize}]`);break;case"DSD":this.metadata.setFormat("numberOfSamples",Number(c.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break}const s=c.chunkSize-BigInt(this.tokenizer.position-f);s>0&&(m(`After Parsing chunk, remaining ${s} bytes`),await this.tokenizer.ignore(Number(s)))}async handleSoundPropertyChunks(c){for(m(`Parsing sound-property-chunks, remainingSize=${c}`);c>0;){const f=await this.tokenizer.readToken(u.ChunkHeader64);m(`Sound-property-chunk[ID=${f.chunkID}, size=${f.chunkSize}]`);const s=this.tokenizer.position;switch(f.chunkID.trim()){case"FS":const p=await this.tokenizer.readToken(e.UINT32_BE);this.metadata.setFormat("sampleRate",p);break;case"CHNL":const h=await this.tokenizer.readToken(e.UINT16_BE);this.metadata.setFormat("numberOfChannels",h),await this.handleChannelChunks(f.chunkSize-BigInt(e.UINT16_BE.len));break;case"CMPR":const b=(await this.tokenizer.readToken(t.FourCcToken)).trim(),g=await this.tokenizer.readToken(e.UINT8),y=await this.tokenizer.readToken(new e.StringType(g,"ascii"));b==="DSD"&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${b} (${y})`);break;case"ABSS":const S=await this.tokenizer.readToken(e.UINT16_BE),E=await this.tokenizer.readToken(e.UINT8),I=await this.tokenizer.readToken(e.UINT8),k=await this.tokenizer.readToken(e.UINT32_BE);m(`ABSS ${S}:${E}:${I}.${k}`);break;case"LSCO":const T=await this.tokenizer.readToken(e.UINT16_BE);m(`LSCO lsConfig=${T}`);break;case"COMT":default:m(`Unknown sound-property-chunk[ID=${f.chunkID}, size=${f.chunkSize}]`),await this.tokenizer.ignore(Number(f.chunkSize))}const a=f.chunkSize-BigInt(this.tokenizer.position-s);a>0&&(m(`After Parsing sound-property-chunk ${f.chunkSize}, remaining ${a} bytes`),await this.tokenizer.ignore(Number(a))),c-=BigInt(u.ChunkHeader64.len)+f.chunkSize,m(`Parsing sound-property-chunks, remainingSize=${c}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const f=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",f)}}async handleChannelChunks(c){m(`Parsing channel-chunks, remainingSize=${c}`);const f=[];for(;c>=t.FourCcToken.len;){const s=await this.tokenizer.readToken(t.FourCcToken);m(`Channel[ID=${s}]`),f.push(s),c-=BigInt(t.FourCcToken.len)}return m(`Channels: ${f.join(", ")}`),f}};return DsdiffParser.DsdiffParser=d,DsdiffParser}var MatroskaParser={},MatroskaDtd={},hasRequiredMatroskaDtd;function requireMatroskaDtd(){if(hasRequiredMatroskaDtd)return MatroskaDtd;hasRequiredMatroskaDtd=1,Object.defineProperty(MatroskaDtd,"__esModule",{value:!0}),MatroskaDtd.elements=void 0;const e=requireTypes();return MatroskaDtd.elements={440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:e.DataType.uint},17143:{name:"ebmlReadVersion",value:e.DataType.uint},17138:{name:"ebmlMaxIDWidth",value:e.DataType.uint},17139:{name:"ebmlMaxSizeWidth",value:e.DataType.uint},17026:{name:"docType",value:e.DataType.string},17031:{name:"docTypeVersion",value:e.DataType.uint},17029:{name:"docTypeReadVersion",value:e.DataType.uint}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",container:{21419:{name:"seekId",value:e.DataType.binary},21420:{name:"seekPosition",value:e.DataType.uint}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:e.DataType.uid},29572:{name:"filename",value:e.DataType.string},3979555:{name:"prevUID",value:e.DataType.uid},3965867:{name:"prevFilename",value:e.DataType.string},4110627:{name:"nextUID",value:e.DataType.uid},4096955:{name:"nextFilename",value:e.DataType.string},2807729:{name:"timecodeScale",value:e.DataType.uint},17545:{name:"duration",value:e.DataType.float},17505:{name:"dateUTC",value:e.DataType.uint},31657:{name:"title",value:e.DataType.string},19840:{name:"muxingApp",value:e.DataType.string},22337:{name:"writingApp",value:e.DataType.string}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:e.DataType.uid},163:{name:"unknown",value:e.DataType.binary},167:{name:"position",value:e.DataType.uid},171:{name:"prevSize",value:e.DataType.uid}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:e.DataType.uint},29637:{name:"uid",value:e.DataType.uid},131:{name:"trackType",value:e.DataType.uint},185:{name:"flagEnabled",value:e.DataType.bool},136:{name:"flagDefault",value:e.DataType.bool},21930:{name:"flagForced",value:e.DataType.bool},156:{name:"flagLacing",value:e.DataType.bool},28135:{name:"minCache",value:e.DataType.uint},28136:{name:"maxCache",value:e.DataType.uint},2352003:{name:"defaultDuration",value:e.DataType.uint},2306383:{name:"timecodeScale",value:e.DataType.float},21358:{name:"name",value:e.DataType.string},2274716:{name:"language",value:e.DataType.string},134:{name:"codecID",value:e.DataType.string},25506:{name:"codecPrivate",value:e.DataType.binary},2459272:{name:"codecName",value:e.DataType.string},3839639:{name:"codecSettings",value:e.DataType.string},3883072:{name:"codecInfoUrl",value:e.DataType.string},2536e3:{name:"codecDownloadUrl",value:e.DataType.string},170:{name:"codecDecodeAll",value:e.DataType.bool},28587:{name:"trackOverlay",value:e.DataType.uint},224:{name:"video",container:{154:{name:"flagInterlaced",value:e.DataType.bool},21432:{name:"stereoMode",value:e.DataType.uint},176:{name:"pixelWidth",value:e.DataType.uint},186:{name:"pixelHeight",value:e.DataType.uint},21680:{name:"displayWidth",value:e.DataType.uint},21690:{name:"displayHeight",value:e.DataType.uint},21683:{name:"aspectRatioType",value:e.DataType.uint},3061028:{name:"colourSpace",value:e.DataType.uint},3126563:{name:"gammaValue",value:e.DataType.float}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:e.DataType.float},30901:{name:"outputSamplingFrequency",value:e.DataType.float},159:{name:"channels",value:e.DataType.uint},148:{name:"channels",value:e.DataType.uint},32123:{name:"channelPositions",value:e.DataType.binary},25188:{name:"bitDepth",value:e.DataType.uint}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:e.DataType.uint},20530:{name:"scope",value:e.DataType.bool},20531:{name:"type",value:e.DataType.uint},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:e.DataType.uint},16981:{name:"contentCompSettings",value:e.DataType.binary}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:e.DataType.uint},18402:{name:"contentEncKeyID",value:e.DataType.binary},18403:{name:"contentSignature ",value:e.DataType.binary},18404:{name:"ContentSigKeyID  ",value:e.DataType.binary},18405:{name:"contentSigAlgo ",value:e.DataType.uint},18406:{name:"contentSigHashAlgo ",value:e.DataType.uint}}},25188:{name:"bitDepth",value:e.DataType.uint}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:e.DataType.uid},183:{name:"positions",container:{247:{name:"track",value:e.DataType.uint},241:{name:"clusterPosition",value:e.DataType.uint},21368:{name:"blockNumber",value:e.DataType.uint},234:{name:"codecState",value:e.DataType.uint},219:{name:"reference",container:{150:{name:"time",value:e.DataType.uint},151:{name:"cluster",value:e.DataType.uint},21343:{name:"number",value:e.DataType.uint},235:{name:"codecState",value:e.DataType.uint}}},240:{name:"relativePosition",value:e.DataType.uint}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:e.DataType.string},18030:{name:"name",value:e.DataType.string},18016:{name:"mimeType",value:e.DataType.string},18012:{name:"data",value:e.DataType.binary},18094:{name:"uid",value:e.DataType.uid}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:e.DataType.uid},145:{name:"timeStart",value:e.DataType.uint},146:{name:"timeEnd",value:e.DataType.uid},152:{name:"hidden",value:e.DataType.bool},17816:{name:"enabled",value:e.DataType.uid},143:{name:"track",container:{137:{name:"trackNumber",value:e.DataType.uid},128:{name:"display",container:{133:{name:"string",value:e.DataType.string},17276:{name:"language ",value:e.DataType.string},17278:{name:"country ",value:e.DataType.string}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:e.DataType.uid},25540:{name:"tagChapterUID",value:e.DataType.uint},25542:{name:"tagAttachmentUID",value:e.DataType.uid},25546:{name:"targetType",value:e.DataType.string},26826:{name:"targetTypeValue",value:e.DataType.uint},25545:{name:"tagEditionUID",value:e.DataType.uid}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:e.DataType.string},17543:{name:"string",value:e.DataType.string},17541:{name:"binary",value:e.DataType.binary},17530:{name:"language",value:e.DataType.string},17531:{name:"languageIETF",value:e.DataType.string},17540:{name:"default",value:e.DataType.bool}}}}}}}}}},MatroskaDtd}var hasRequiredMatroskaParser;function requireMatroskaParser(){if(hasRequiredMatroskaParser)return MatroskaParser;hasRequiredMatroskaParser=1,Object.defineProperty(MatroskaParser,"__esModule",{value:!0}),MatroskaParser.MatroskaParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),n=requireBasicParser(),t=requireTypes(),o=requireMatroskaDtd(),l=(0,r.default)("music-metadata:parser:matroska");let u=class extends n.BasicParser{constructor(){super(),this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.parserMap.set(t.DataType.uint,d=>this.readUint(d)),this.parserMap.set(t.DataType.string,d=>this.readString(d)),this.parserMap.set(t.DataType.binary,d=>this.readBuffer(d)),this.parserMap.set(t.DataType.uid,async d=>await this.readUint(d)===1),this.parserMap.set(t.DataType.bool,d=>this.readFlag(d)),this.parserMap.set(t.DataType.float,d=>this.readFloat(d))}init(d,i,c){return super.init(d,i,c),this}async parse(){const d=await this.parseContainer(o.elements,this.tokenizer.fileInfo.size,[]);if(this.metadata.setFormat("container",`EBML/${d.ebml.docType}`),d.segment){const i=d.segment.info;if(i){const f=i.timecodeScale?i.timecodeScale:1e6;if(typeof i.duration=="number"){const s=i.duration*f/1e9;this.addTag("segment:title",i.title),this.metadata.setFormat("duration",s)}}const c=d.segment.tracks;if(c&&c.entries){c.entries.forEach(s=>{const a={codecName:s.codecID.replace("A_","").replace("V_",""),codecSettings:s.codecSettings,flagDefault:s.flagDefault,flagLacing:s.flagLacing,flagEnabled:s.flagEnabled,language:s.language,name:s.name,type:s.trackType,audio:s.audio,video:s.video};this.metadata.addStreamInfo(a)});const f=c.entries.filter(s=>s.trackType===t.TrackType.audio.valueOf()).reduce((s,a)=>!s||!s.flagDefault&&a.flagDefault||a.trackNumber&&a.trackNumber<s.trackNumber?a:s,null);f&&(this.metadata.setFormat("codec",f.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",f.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",f.audio.channels)),d.segment.tags&&d.segment.tags.tag.forEach(s=>{const a=s.target,p=a!=null&&a.targetTypeValue?t.TargetType[a.targetTypeValue]:a!=null&&a.targetType?a.targetType:"track";s.simpleTags.forEach(h=>{const b=h.string?h.string:h.binary;this.addTag(`${p}:${h.name}`,b)})}),d.segment.attachments&&d.segment.attachments.attachedFiles.filter(s=>s.mimeType.startsWith("image/")).map(s=>({data:s.data,format:s.mimeType,description:s.description,name:s.name})).forEach(s=>{this.addTag("picture",s)})}}}async parseContainer(d,i,c){const f={};for(;this.tokenizer.position<i;){let s;try{s=await this.readElement()}catch(p){if(p.message==="End-Of-Stream")break;throw p}const a=d[s.id];if(a)if(l(`Element: name=${a.name}, container=${!!a.container}`),a.container){const p=await this.parseContainer(a.container,s.len>=0?this.tokenizer.position+s.len:-1,c.concat([a.name]));a.multiple?(f[a.name]||(f[a.name]=[]),f[a.name].push(p)):f[a.name]=p}else f[a.name]=await this.parserMap.get(a.value)(s);else switch(s.id){case 236:this.padding+=s.len,await this.tokenizer.ignore(s.len);break;default:l(`parseEbml: path=${c.join("/")}, unknown element: id=${s.id.toString(16)}`),this.padding+=s.len,await this.tokenizer.ignore(s.len)}}return f}async readVintData(d){const i=await this.tokenizer.peekNumber(e.UINT8);let c=128,f=1;for(;(i&c)===0;){if(f>d)throw new Error("VINT value exceeding maximum size");++f,c>>=1}const s=Buffer.alloc(f);return await this.tokenizer.readBuffer(s),s}async readElement(){const d=await this.readVintData(this.ebmlMaxIDLength),i=await this.readVintData(this.ebmlMaxSizeLength);i[0]^=128>>i.length-1;const c=Math.min(6,i.length);return{id:d.readUIntBE(0,d.length),len:i.readUIntBE(i.length-c,c)}}isMaxValue(d){if(d.length===this.ebmlMaxSizeLength){for(let i=1;i<this.ebmlMaxSizeLength;++i)if(d[i]!==255)return!1;return!0}return!1}async readFloat(d){switch(d.len){case 0:return 0;case 4:return this.tokenizer.readNumber(e.Float32_BE);case 8:return this.tokenizer.readNumber(e.Float64_BE);case 10:return this.tokenizer.readNumber(e.Float64_BE);default:throw new Error(`Invalid IEEE-754 float length: ${d.len}`)}}async readFlag(d){return await this.readUint(d)===1}async readUint(d){const i=await this.readBuffer(d),c=Math.min(6,d.len);return i.readUIntBE(d.len-c,c)}async readString(d){return(await this.tokenizer.readToken(new e.StringType(d.len,"utf-8"))).replace(/\00.*$/g,"")}async readBuffer(d){const i=Buffer.alloc(d.len);return await this.tokenizer.readBuffer(i),i}addTag(d,i){this.metadata.addTag("matroska",d,i)}};return MatroskaParser.MatroskaParser=u,MatroskaParser}var hasRequiredParserFactory;function requireParserFactory(){if(hasRequiredParserFactory)return ParserFactory;hasRequiredParserFactory=1,Object.defineProperty(ParserFactory,"__esModule",{value:!0}),ParserFactory.ParserFactory=ParserFactory.parseHttpContentType=void 0;const e=requireCore$1(),r=requireContentType(),n=requireMediaTyper(),t=requireBrowser$3(),o=requireMetadataCollector(),l=requireAiffParser(),u=requireAPEv2Parser(),m=requireAsfParser(),d=requireFlacParser(),i=requireMP4Parser(),c=requireMpegParser(),f=requireMusepack(),s=requireOggParser(),a=requireWaveParser(),p=requireWavPackParser(),h=requireDsfParser(),b=requireDsdiffParser(),g=requireMatroskaParser(),y=(0,t.default)("music-metadata:parser:factory");function S(k){const T=r.parse(k),w=n.parse(T.type);return{type:w.type,subtype:w.subtype,suffix:w.suffix,parameters:T.parameters}}ParserFactory.parseHttpContentType=S;async function E(k,T,w={}){const F=await I.loadParser(T),P=new o.MetadataCollector(w);return await F.init(P,k,w).parse(),P.toCommonMetadata()}let I=class Pe{static async parseOnContentType(T,w){const{mimeType:F,path:P,url:C}=await T.fileInfo,B=Pe.getParserIdForMimeType(F)||Pe.getParserIdForExtension(P)||Pe.getParserIdForExtension(C);return B||y("No parser found for MIME-type / extension: "+F),this.parse(T,B,w)}static async parse(T,w,F){if(!w){y("Guess parser on content...");const P=Buffer.alloc(4100);if(await T.peekBuffer(P,{mayBeLess:!0}),T.fileInfo.path&&(w=this.getParserIdForExtension(T.fileInfo.path)),!w){const C=await e.fromBuffer(P);if(!C)throw new Error("Failed to determine audio format");if(y(`Guessed file type is mime=${C.mime}, extension=${C.ext}`),w=Pe.getParserIdForMimeType(C.mime),!w)throw new Error("Guessed MIME-type not supported: "+C.mime)}}return E(T,w,F)}static getParserIdForExtension(T){if(!T)return;switch(this.getExtension(T).toLocaleLowerCase()||T){case".mp2":case".mp3":case".m2a":case".aac":return"mpeg";case".ape":return"apev2";case".mp4":case".m4a":case".m4b":case".m4pa":case".m4v":case".m4r":case".3gp":return"mp4";case".wma":case".wmv":case".asf":return"asf";case".flac":return"flac";case".ogg":case".ogv":case".oga":case".ogm":case".ogx":case".opus":case".spx":return"ogg";case".aif":case".aiff":case".aifc":return"aiff";case".wav":case".bwf":return"riff";case".wv":case".wvp":return"wavpack";case".mpc":return"musepack";case".dsf":return"dsf";case".dff":return"dsdiff";case".mka":case".mkv":case".mk3d":case".mks":case".webm":return"matroska"}}static async loadParser(T){switch(T){case"aiff":return new l.AIFFParser;case"adts":case"mpeg":return new c.MpegParser;case"apev2":return new u.APEv2Parser;case"asf":return new m.AsfParser;case"dsf":return new h.DsfParser;case"dsdiff":return new b.DsdiffParser;case"flac":return new d.FlacParser;case"mp4":return new i.MP4Parser;case"musepack":return new f.default;case"ogg":return new s.OggParser;case"riff":return new a.WaveParser;case"wavpack":return new p.WavPackParser;case"matroska":return new g.MatroskaParser;default:throw new Error(`Unknown parser type: ${T}`)}}static getExtension(T){const w=T.lastIndexOf(".");return w===-1?"":T.slice(w)}static getParserIdForMimeType(T){let w;try{w=S(T)}catch{y(`Invalid HTTP Content-Type header value: ${T}`);return}const F=w.subtype.indexOf("x-")===0?w.subtype.substring(2):w.subtype;switch(w.type){case"audio":switch(F){case"mp3":case"mpeg":return"mpeg";case"aac":case"aacp":return"adts";case"flac":return"flac";case"ape":case"monkeys-audio":return"apev2";case"mp4":case"m4a":return"mp4";case"ogg":case"opus":case"speex":return"ogg";case"ms-wma":case"ms-wmv":case"ms-asf":return"asf";case"aiff":case"aif":case"aifc":return"aiff";case"vnd.wave":case"wav":case"wave":return"riff";case"wavpack":return"wavpack";case"musepack":return"musepack";case"matroska":case"webm":return"matroska";case"dsf":return"dsf"}break;case"video":switch(F){case"ms-asf":case"ms-wmv":return"asf";case"m4v":case"mp4":return"mp4";case"ogg":return"ogg";case"matroska":case"webm":return"matroska"}break;case"application":switch(F){case"vnd.ms-asf":return"asf";case"ogg":return"ogg"}break}}};return ParserFactory.ParserFactory=I,ParserFactory}var RandomUint8ArrayReader={},hasRequiredRandomUint8ArrayReader;function requireRandomUint8ArrayReader(){if(hasRequiredRandomUint8ArrayReader)return RandomUint8ArrayReader;hasRequiredRandomUint8ArrayReader=1,Object.defineProperty(RandomUint8ArrayReader,"__esModule",{value:!0}),RandomUint8ArrayReader.RandomUint8ArrayReader=void 0;let e=class{constructor(n){this.uint8Array=n,this.fileSize=n.length}async randomRead(n,t,o,l){return n.set(this.uint8Array.subarray(l,l+o),t),o}};return RandomUint8ArrayReader.RandomUint8ArrayReader=e,RandomUint8ArrayReader}var Lyrics3={},hasRequiredLyrics3;function requireLyrics3(){return hasRequiredLyrics3||(hasRequiredLyrics3=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getLyricsHeaderLength=e.endTag2=void 0,e.endTag2="LYRICS200";async function r(n){if(n.fileSize>=143){const t=Buffer.alloc(15);await n.randomRead(t,0,t.length,n.fileSize-143);const o=t.toString("binary");if(o.substr(6)===e.endTag2)return parseInt(o.substr(0,6),10)+15}return 0}e.getLyricsHeaderLength=r}(Lyrics3)),Lyrics3}var hasRequiredCore;function requireCore(){if(hasRequiredCore)return core$2;hasRequiredCore=1,Object.defineProperty(core$2,"__esModule",{value:!0}),core$2.scanAppendingHeaders=core$2.selectCover=core$2.ratingToStars=core$2.orderTags=core$2.parseFromTokenizer=core$2.parseBuffer=core$2.parseStream=void 0;const e=requireCore$2(),r=requireParserFactory(),n=requireRandomUint8ArrayReader(),t=requireAPEv2Parser(),o=requireID3v1Parser(),l=requireLyrics3();function u(a,p,h={}){return d(e.fromStream(a,typeof p=="string"?{mimeType:p}:p),h)}core$2.parseStream=u;async function m(a,p,h={}){const b=new n.RandomUint8ArrayReader(a);await s(b,h);const g=e.fromBuffer(a,typeof p=="string"?{mimeType:p}:p);return d(g,h)}core$2.parseBuffer=m;function d(a,p){return r.ParserFactory.parseOnContentType(a,p)}core$2.parseFromTokenizer=d;function i(a){const p={};for(const h of a)(p[h.id]=p[h.id]||[]).push(h.value);return p}core$2.orderTags=i;function c(a){return a===void 0?0:1+Math.round(a*4)}core$2.ratingToStars=c;function f(a){return a?a.reduce((p,h)=>h.name&&h.name.toLowerCase()in["front","cover","cover (front)"]?h:p):null}core$2.selectCover=f;async function s(a,p={}){let h=a.fileSize;if(await(0,o.hasID3v1Header)(a)){h-=128;const b=await(0,l.getLyricsHeaderLength)(a);h-=b}p.apeHeader=await t.APEv2Parser.findApeFooterOffset(a,h)}return core$2.scanAppendingHeaders=s,core$2}var lib={},browser$2={exports:{}},stream={exports:{}},primordials,hasRequiredPrimordials;function requirePrimordials(){if(hasRequiredPrimordials)return primordials;hasRequiredPrimordials=1;class e extends Error{constructor(n){if(!Array.isArray(n))throw new TypeError(`Expected input to be an Array, got ${typeof n}`);let t="";for(let o=0;o<n.length;o++)t+=`    ${n[o].stack}
`;super(t),this.name="AggregateError",this.errors=n}}return primordials={AggregateError:e,ArrayIsArray(r){return Array.isArray(r)},ArrayPrototypeIncludes(r,n){return r.includes(n)},ArrayPrototypeIndexOf(r,n){return r.indexOf(n)},ArrayPrototypeJoin(r,n){return r.join(n)},ArrayPrototypeMap(r,n){return r.map(n)},ArrayPrototypePop(r,n){return r.pop(n)},ArrayPrototypePush(r,n){return r.push(n)},ArrayPrototypeSlice(r,n,t){return r.slice(n,t)},Error,FunctionPrototypeCall(r,n,...t){return r.call(n,...t)},FunctionPrototypeSymbolHasInstance(r,n){return Function.prototype[Symbol.hasInstance].call(r,n)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(r,n){return Object.defineProperties(r,n)},ObjectDefineProperty(r,n,t){return Object.defineProperty(r,n,t)},ObjectGetOwnPropertyDescriptor(r,n){return Object.getOwnPropertyDescriptor(r,n)},ObjectKeys(r){return Object.keys(r)},ObjectSetPrototypeOf(r,n){return Object.setPrototypeOf(r,n)},Promise,PromisePrototypeCatch(r,n){return r.catch(n)},PromisePrototypeThen(r,n,t){return r.then(n,t)},PromiseReject(r){return Promise.reject(r)},PromiseResolve(r){return Promise.resolve(r)},ReflectApply:Reflect.apply,RegExpPrototypeTest(r,n){return r.test(n)},SafeSet:Set,String,StringPrototypeSlice(r,n,t){return r.slice(n,t)},StringPrototypeToLowerCase(r){return r.toLowerCase()},StringPrototypeToUpperCase(r){return r.toUpperCase()},StringPrototypeTrim(r){return r.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(r,n,t){return r.set(n,t)},Boolean,Uint8Array},primordials}var util={exports:{}},inspect,hasRequiredInspect;function requireInspect(){return hasRequiredInspect||(hasRequiredInspect=1,inspect={format(e,...r){return e.replace(/%([sdifj])/g,function(...[n,t]){const o=r.shift();return t==="f"?o.toFixed(6):t==="j"?JSON.stringify(o):t==="s"&&typeof o=="object"?`${o.constructor!==Object?o.constructor.name:""} {}`.trim():o.toString()})},inspect(e){switch(typeof e){case"string":if(e.includes("'"))if(e.includes('"')){if(!e.includes("`")&&!e.includes("${"))return`\`${e}\``}else return`"${e}"`;return`'${e}'`;case"number":return isNaN(e)?"NaN":Object.is(e,-0)?String(e):e;case"bigint":return`${String(e)}n`;case"boolean":case"undefined":return String(e);case"object":return"{}"}}}),inspect}var errors,hasRequiredErrors;function requireErrors(){if(hasRequiredErrors)return errors;hasRequiredErrors=1;const{format:e,inspect:r}=requireInspect(),{AggregateError:n}=requirePrimordials(),t=globalThis.AggregateError||n,o=Symbol("kIsNodeError"),l=["string","function","number","object","Function","Object","boolean","bigint","symbol"],u=/^([A-Z][a-z0-9]*)+$/,m="__node_internal_",d={};function i(b,g){if(!b)throw new d.ERR_INTERNAL_ASSERTION(g)}function c(b){let g="",y=b.length;const S=b[0]==="-"?1:0;for(;y>=S+4;y-=3)g=`_${b.slice(y-3,y)}${g}`;return`${b.slice(0,y)}${g}`}function f(b,g,y){if(typeof g=="function")return i(g.length<=y.length,`Code: ${b}; The provided arguments length (${y.length}) does not match the required ones (${g.length}).`),g(...y);const S=(g.match(/%[dfijoOs]/g)||[]).length;return i(S===y.length,`Code: ${b}; The provided arguments length (${y.length}) does not match the required ones (${S}).`),y.length===0?g:e(g,...y)}function s(b,g,y){y||(y=Error);class S extends y{constructor(...I){super(f(b,g,I))}toString(){return`${this.name} [${b}]: ${this.message}`}}Object.defineProperties(S.prototype,{name:{value:y.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${b}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),S.prototype.code=b,S.prototype[o]=!0,d[b]=S}function a(b){const g=m+b.name;return Object.defineProperty(b,"name",{value:g}),b}function p(b,g){if(b&&g&&b!==g){if(Array.isArray(g.errors))return g.errors.push(b),g;const y=new t([g,b],g.message);return y.code=g.code,y}return b||g}class h extends Error{constructor(g="The operation was aborted",y=void 0){if(y!==void 0&&typeof y!="object")throw new d.ERR_INVALID_ARG_TYPE("options","Object",y);super(g,y),this.code="ABORT_ERR",this.name="AbortError"}}return s("ERR_ASSERTION","%s",Error),s("ERR_INVALID_ARG_TYPE",(b,g,y)=>{i(typeof b=="string","'name' must be a string"),Array.isArray(g)||(g=[g]);let S="The ";b.endsWith(" argument")?S+=`${b} `:S+=`"${b}" ${b.includes(".")?"property":"argument"} `,S+="must be ";const E=[],I=[],k=[];for(const w of g)i(typeof w=="string","All expected entries have to be of type string"),l.includes(w)?E.push(w.toLowerCase()):u.test(w)?I.push(w):(i(w!=="object",'The value "object" should be written as "Object"'),k.push(w));if(I.length>0){const w=E.indexOf("object");w!==-1&&(E.splice(E,w,1),I.push("Object"))}if(E.length>0){switch(E.length){case 1:S+=`of type ${E[0]}`;break;case 2:S+=`one of type ${E[0]} or ${E[1]}`;break;default:{const w=E.pop();S+=`one of type ${E.join(", ")}, or ${w}`}}(I.length>0||k.length>0)&&(S+=" or ")}if(I.length>0){switch(I.length){case 1:S+=`an instance of ${I[0]}`;break;case 2:S+=`an instance of ${I[0]} or ${I[1]}`;break;default:{const w=I.pop();S+=`an instance of ${I.join(", ")}, or ${w}`}}k.length>0&&(S+=" or ")}switch(k.length){case 0:break;case 1:k[0].toLowerCase()!==k[0]&&(S+="an "),S+=`${k[0]}`;break;case 2:S+=`one of ${k[0]} or ${k[1]}`;break;default:{const w=k.pop();S+=`one of ${k.join(", ")}, or ${w}`}}if(y==null)S+=`. Received ${y}`;else if(typeof y=="function"&&y.name)S+=`. Received function ${y.name}`;else if(typeof y=="object"){var T;if((T=y.constructor)!==null&&T!==void 0&&T.name)S+=`. Received an instance of ${y.constructor.name}`;else{const w=r(y,{depth:-1});S+=`. Received ${w}`}}else{let w=r(y,{colors:!1});w.length>25&&(w=`${w.slice(0,25)}...`),S+=`. Received type ${typeof y} (${w})`}return S},TypeError),s("ERR_INVALID_ARG_VALUE",(b,g,y="is invalid")=>{let S=r(g);return S.length>128&&(S=S.slice(0,128)+"..."),`The ${b.includes(".")?"property":"argument"} '${b}' ${y}. Received ${S}`},TypeError),s("ERR_INVALID_RETURN_VALUE",(b,g,y)=>{var S;const E=y!=null&&(S=y.constructor)!==null&&S!==void 0&&S.name?`instance of ${y.constructor.name}`:`type ${typeof y}`;return`Expected ${b} to be returned from the "${g}" function but got ${E}.`},TypeError),s("ERR_MISSING_ARGS",(...b)=>{i(b.length>0,"At least one arg needs to be specified");let g;const y=b.length;switch(b=(Array.isArray(b)?b:[b]).map(S=>`"${S}"`).join(" or "),y){case 1:g+=`The ${b[0]} argument`;break;case 2:g+=`The ${b[0]} and ${b[1]} arguments`;break;default:{const S=b.pop();g+=`The ${b.join(", ")}, and ${S} arguments`}break}return`${g} must be specified`},TypeError),s("ERR_OUT_OF_RANGE",(b,g,y)=>{i(g,'Missing "range" argument');let S;if(Number.isInteger(y)&&Math.abs(y)>2**32)S=c(String(y));else if(typeof y=="bigint"){S=String(y);const E=BigInt(2)**BigInt(32);(y>E||y<-E)&&(S=c(S)),S+="n"}else S=r(y);return`The value of "${b}" is out of range. It must be ${g}. Received ${S}`},RangeError),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),s("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),s("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),s("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),s("ERR_STREAM_WRITE_AFTER_END","write after end",Error),s("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),errors={AbortError:h,aggregateTwoErrors:a(p),hideStackFrames:a,codes:d},errors}var browser$1={exports:{}},hasRequiredBrowser$2;function requireBrowser$2(){if(hasRequiredBrowser$2)return browser$1.exports;hasRequiredBrowser$2=1;const{AbortController:e,AbortSignal:r}=typeof self<"u"?self:typeof window<"u"?window:void 0;return browser$1.exports=e,browser$1.exports.AbortSignal=r,browser$1.exports.default=e,browser$1.exports}var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(I,k,T){return Function.prototype.apply.call(I,k,T)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:n=function(I){return Object.getOwnPropertyNames(I)};function t(E){console&&console.warn&&console.warn(E)}var o=Number.isNaN||function(I){return I!==I};function l(){l.init.call(this)}events.exports=l,events.exports.once=g,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function m(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(E){if(typeof E!="number"||E<0||o(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");u=E}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||o(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function d(E){return E._maxListeners===void 0?l.defaultMaxListeners:E._maxListeners}l.prototype.getMaxListeners=function(){return d(this)},l.prototype.emit=function(I){for(var k=[],T=1;T<arguments.length;T++)k.push(arguments[T]);var w=I==="error",F=this._events;if(F!==void 0)w=w&&F.error===void 0;else if(!w)return!1;if(w){var P;if(k.length>0&&(P=k[0]),P instanceof Error)throw P;var C=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw C.context=P,C}var B=F[I];if(B===void 0)return!1;if(typeof B=="function")r(B,this,k);else for(var D=B.length,V=p(B,D),T=0;T<D;++T)r(V[T],this,k);return!0};function i(E,I,k,T){var w,F,P;if(m(k),F=E._events,F===void 0?(F=E._events=Object.create(null),E._eventsCount=0):(F.newListener!==void 0&&(E.emit("newListener",I,k.listener?k.listener:k),F=E._events),P=F[I]),P===void 0)P=F[I]=k,++E._eventsCount;else if(typeof P=="function"?P=F[I]=T?[k,P]:[P,k]:T?P.unshift(k):P.push(k),w=d(E),w>0&&P.length>w&&!P.warned){P.warned=!0;var C=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");C.name="MaxListenersExceededWarning",C.emitter=E,C.type=I,C.count=P.length,t(C)}return E}l.prototype.addListener=function(I,k){return i(this,I,k,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(I,k){return i(this,I,k,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(E,I,k){var T={fired:!1,wrapFn:void 0,target:E,type:I,listener:k},w=c.bind(T);return w.listener=k,T.wrapFn=w,w}l.prototype.once=function(I,k){return m(k),this.on(I,f(this,I,k)),this},l.prototype.prependOnceListener=function(I,k){return m(k),this.prependListener(I,f(this,I,k)),this},l.prototype.removeListener=function(I,k){var T,w,F,P,C;if(m(k),w=this._events,w===void 0)return this;if(T=w[I],T===void 0)return this;if(T===k||T.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete w[I],w.removeListener&&this.emit("removeListener",I,T.listener||k));else if(typeof T!="function"){for(F=-1,P=T.length-1;P>=0;P--)if(T[P]===k||T[P].listener===k){C=T[P].listener,F=P;break}if(F<0)return this;F===0?T.shift():h(T,F),T.length===1&&(w[I]=T[0]),w.removeListener!==void 0&&this.emit("removeListener",I,C||k)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(I){var k,T,w;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[I]),this;if(arguments.length===0){var F=Object.keys(T),P;for(w=0;w<F.length;++w)P=F[w],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=T[I],typeof k=="function")this.removeListener(I,k);else if(k!==void 0)for(w=k.length-1;w>=0;w--)this.removeListener(I,k[w]);return this};function s(E,I,k){var T=E._events;if(T===void 0)return[];var w=T[I];return w===void 0?[]:typeof w=="function"?k?[w.listener||w]:[w]:k?b(w):p(w,w.length)}l.prototype.listeners=function(I){return s(this,I,!0)},l.prototype.rawListeners=function(I){return s(this,I,!1)},l.listenerCount=function(E,I){return typeof E.listenerCount=="function"?E.listenerCount(I):a.call(E,I)},l.prototype.listenerCount=a;function a(E){var I=this._events;if(I!==void 0){var k=I[E];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function p(E,I){for(var k=new Array(I),T=0;T<I;++T)k[T]=E[T];return k}function h(E,I){for(;I+1<E.length;I++)E[I]=E[I+1];E.pop()}function b(E){for(var I=new Array(E.length),k=0;k<I.length;++k)I[k]=E[k].listener||E[k];return I}function g(E,I){return new Promise(function(k,T){function w(P){E.removeListener(I,F),T(P)}function F(){typeof E.removeListener=="function"&&E.removeListener("error",w),k([].slice.call(arguments))}S(E,I,F,{once:!0}),I!=="error"&&y(E,w,{once:!0})})}function y(E,I,k){typeof E.on=="function"&&S(E,"error",I,k)}function S(E,I,k,T){if(typeof E.on=="function")T.once?E.once(I,k):E.on(I,k);else if(typeof E.addEventListener=="function")E.addEventListener(I,function w(F){T.once&&E.removeEventListener(I,w),k(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return events.exports}var hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,function(e){const r=requireBuffer(),{format:n,inspect:t}=requireInspect(),{codes:{ERR_INVALID_ARG_TYPE:o}}=requireErrors(),{kResistStopPropagation:l,AggregateError:u,SymbolDispose:m}=requirePrimordials(),d=globalThis.AbortSignal||requireBrowser$2().AbortSignal,i=globalThis.AbortController||requireBrowser$2().AbortController,c=Object.getPrototypeOf(async function(){}).constructor,f=globalThis.Blob||r.Blob,s=typeof f<"u"?function(b){return b instanceof f}:function(b){return!1},a=(h,b)=>{if(h!==void 0&&(h===null||typeof h!="object"||!("aborted"in h)))throw new o(b,"AbortSignal",h)},p=(h,b)=>{if(typeof h!="function")throw new o(b,"Function",h)};e.exports={AggregateError:u,kEmptyObject:Object.freeze({}),once(h){let b=!1;return function(...g){b||(b=!0,h.apply(this,g))}},createDeferredPromise:function(){let h,b;return{promise:new Promise((y,S)=>{h=y,b=S}),resolve:h,reject:b}},promisify(h){return new Promise((b,g)=>{h((y,...S)=>y?g(y):b(...S))})},debuglog(){return function(){}},format:n,inspect:t,types:{isAsyncFunction(h){return h instanceof c},isArrayBufferView(h){return ArrayBuffer.isView(h)}},isBlob:s,deprecate(h,b){return h},addAbortListener:requireEvents().addAbortListener||function(b,g){if(b===void 0)throw new o("signal","AbortSignal",b);a(b,"signal"),p(g,"listener");let y;return b.aborted?queueMicrotask(()=>g()):(b.addEventListener("abort",g,{__proto__:null,once:!0,[l]:!0}),y=()=>{b.removeEventListener("abort",g)}),{__proto__:null,[m](){var S;(S=y)===null||S===void 0||S()}}},AbortSignalAny:d.any||function(b){if(b.length===1)return b[0];const g=new i,y=()=>g.abort();return b.forEach(S=>{a(S,"signals"),S.addEventListener("abort",y,{once:!0})}),g.signal.addEventListener("abort",()=>{b.forEach(S=>S.removeEventListener("abort",y))},{once:!0}),g.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}(util)),util.exports}var operators={},validators,hasRequiredValidators;function requireValidators(){if(hasRequiredValidators)return validators;hasRequiredValidators=1;const{ArrayIsArray:e,ArrayPrototypeIncludes:r,ArrayPrototypeJoin:n,ArrayPrototypeMap:t,NumberIsInteger:o,NumberIsNaN:l,NumberMAX_SAFE_INTEGER:u,NumberMIN_SAFE_INTEGER:m,NumberParseInt:d,ObjectPrototypeHasOwnProperty:i,RegExpPrototypeExec:c,String:f,StringPrototypeToUpperCase:s,StringPrototypeTrim:a}=requirePrimordials(),{hideStackFrames:p,codes:{ERR_SOCKET_BAD_PORT:h,ERR_INVALID_ARG_TYPE:b,ERR_INVALID_ARG_VALUE:g,ERR_OUT_OF_RANGE:y,ERR_UNKNOWN_SIGNAL:S}}=requireErrors(),{normalizeEncoding:E}=requireUtil(),{isAsyncFunction:I,isArrayBufferView:k}=requireUtil().types,T={};function w(R){return R===(R|0)}function F(R){return R===R>>>0}const P=/^[0-7]+$/,C="must be a 32-bit unsigned integer or an octal string";function B(R,j,H){if(typeof R>"u"&&(R=H),typeof R=="string"){if(c(P,R)===null)throw new g(j,R,C);R=d(R,8)}return Q(R,j),R}const D=p((R,j,H=m,U=u)=>{if(typeof R!="number")throw new b(j,"number",R);if(!o(R))throw new y(j,"an integer",R);if(R<H||R>U)throw new y(j,`>= ${H} && <= ${U}`,R)}),V=p((R,j,H=-2147483648,U=2147483647)=>{if(typeof R!="number")throw new b(j,"number",R);if(!o(R))throw new y(j,"an integer",R);if(R<H||R>U)throw new y(j,`>= ${H} && <= ${U}`,R)}),Q=p((R,j,H=!1)=>{if(typeof R!="number")throw new b(j,"number",R);if(!o(R))throw new y(j,"an integer",R);const U=H?1:0,ce=4294967295;if(R<U||R>ce)throw new y(j,`>= ${U} && <= ${ce}`,R)});function ee(R,j){if(typeof R!="string")throw new b(j,"string",R)}function ue(R,j,H=void 0,U){if(typeof R!="number")throw new b(j,"number",R);if(H!=null&&R<H||U!=null&&R>U||(H!=null||U!=null)&&l(R))throw new y(j,`${H!=null?`>= ${H}`:""}${H!=null&&U!=null?" && ":""}${U!=null?`<= ${U}`:""}`,R)}const N=p((R,j,H)=>{if(!r(H,R)){const ce="must be one of: "+n(t(H,pe=>typeof pe=="string"?`'${pe}'`:f(pe)),", ");throw new g(j,R,ce)}});function te(R,j){if(typeof R!="boolean")throw new b(j,"boolean",R)}function x(R,j,H){return R==null||!i(R,j)?H:R[j]}const z=p((R,j,H=null)=>{const U=x(H,"allowArray",!1),ce=x(H,"allowFunction",!1);if(!x(H,"nullable",!1)&&R===null||!U&&e(R)||typeof R!="object"&&(!ce||typeof R!="function"))throw new b(j,"Object",R)}),K=p((R,j)=>{if(R!=null&&typeof R!="object"&&typeof R!="function")throw new b(j,"a dictionary",R)}),L=p((R,j,H=0)=>{if(!e(R))throw new b(j,"Array",R);if(R.length<H){const U=`must be longer than ${H}`;throw new g(j,R,U)}});function ae(R,j){L(R,j);for(let H=0;H<R.length;H++)ee(R[H],`${j}[${H}]`)}function ie(R,j){L(R,j);for(let H=0;H<R.length;H++)te(R[H],`${j}[${H}]`)}function le(R,j){L(R,j);for(let H=0;H<R.length;H++){const U=R[H],ce=`${j}[${H}]`;if(U==null)throw new b(ce,"AbortSignal",U);se(U,ce)}}function oe(R,j="signal"){if(ee(R,j),T[R]===void 0)throw T[s(R)]!==void 0?new S(R+" (signals must use all capital letters)"):new S(R)}const O=p((R,j="buffer")=>{if(!k(R))throw new b(j,["Buffer","TypedArray","DataView"],R)});function $(R,j){const H=E(j),U=R.length;if(H==="hex"&&U%2!==0)throw new g("encoding",j,`is invalid for data of length ${U}`)}function J(R,j="Port",H=!0){if(typeof R!="number"&&typeof R!="string"||typeof R=="string"&&a(R).length===0||+R!==+R>>>0||R>65535||R===0&&!H)throw new h(j,R,H);return R|0}const se=p((R,j)=>{if(R!==void 0&&(R===null||typeof R!="object"||!("aborted"in R)))throw new b(j,"AbortSignal",R)}),ne=p((R,j)=>{if(typeof R!="function")throw new b(j,"Function",R)}),A=p((R,j)=>{if(typeof R!="function"||I(R))throw new b(j,"Function",R)}),M=p((R,j)=>{if(R!==void 0)throw new b(j,"undefined",R)});function q(R,j,H){if(!r(H,R))throw new b(j,`('${n(H,"|")}')`,R)}const X=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function G(R,j){if(typeof R>"u"||!c(X,R))throw new g(j,R,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function W(R){if(typeof R=="string")return G(R,"hints"),R;if(e(R)){const j=R.length;let H="";if(j===0)return H;for(let U=0;U<j;U++){const ce=R[U];G(ce,"hints"),H+=ce,U!==j-1&&(H+=", ")}return H}throw new g("hints",R,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}return validators={isInt32:w,isUint32:F,parseFileMode:B,validateArray:L,validateStringArray:ae,validateBooleanArray:ie,validateAbortSignalArray:le,validateBoolean:te,validateBuffer:O,validateDictionary:K,validateEncoding:$,validateFunction:ne,validateInt32:V,validateInteger:D,validateNumber:ue,validateObject:z,validateOneOf:N,validatePlainFunction:A,validatePort:J,validateSignalName:oe,validateString:ee,validateUint32:Q,validateUndefined:M,validateUnion:q,validateAbortSignal:se,validateLinkHeaderValue:W},validators}var endOfStream={exports:{}},browser={exports:{}},hasRequiredBrowser$1;function requireBrowser$1(){if(hasRequiredBrowser$1)return browser.exports;hasRequiredBrowser$1=1;var e=browser.exports={},r,n;function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?r=setTimeout:r=t}catch{r=t}try{typeof clearTimeout=="function"?n=clearTimeout:n=o}catch{n=o}})();function l(h){if(r===setTimeout)return setTimeout(h,0);if((r===t||!r)&&setTimeout)return r=setTimeout,setTimeout(h,0);try{return r(h,0)}catch{try{return r.call(null,h,0)}catch{return r.call(this,h,0)}}}function u(h){if(n===clearTimeout)return clearTimeout(h);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(h);try{return n(h)}catch{try{return n.call(null,h)}catch{return n.call(this,h)}}}var m=[],d=!1,i,c=-1;function f(){!d||!i||(d=!1,i.length?m=i.concat(m):c=-1,m.length&&s())}function s(){if(!d){var h=l(f);d=!0;for(var b=m.length;b;){for(i=m,m=[];++c<b;)i&&i[c].run();c=-1,b=m.length}i=null,d=!1,u(h)}}e.nextTick=function(h){var b=new Array(arguments.length-1);if(arguments.length>1)for(var g=1;g<arguments.length;g++)b[g-1]=arguments[g];m.push(new a(h,b)),m.length===1&&!d&&l(s)};function a(h,b){this.fun=h,this.array=b}a.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={};function p(){}return e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.prependListener=p,e.prependOnceListener=p,e.listeners=function(h){return[]},e.binding=function(h){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(h){throw new Error("process.chdir is not supported")},e.umask=function(){return 0},browser.exports}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const{SymbolAsyncIterator:e,SymbolIterator:r,SymbolFor:n}=requirePrimordials(),t=n("nodejs.stream.destroyed"),o=n("nodejs.stream.errored"),l=n("nodejs.stream.readable"),u=n("nodejs.stream.writable"),m=n("nodejs.stream.disturbed"),d=n("nodejs.webstream.isClosedPromise"),i=n("nodejs.webstream.controllerErrorFunction");function c(x,z=!1){var K;return!!(x&&typeof x.pipe=="function"&&typeof x.on=="function"&&(!z||typeof x.pause=="function"&&typeof x.resume=="function")&&(!x._writableState||((K=x._readableState)===null||K===void 0?void 0:K.readable)!==!1)&&(!x._writableState||x._readableState))}function f(x){var z;return!!(x&&typeof x.write=="function"&&typeof x.on=="function"&&(!x._readableState||((z=x._writableState)===null||z===void 0?void 0:z.writable)!==!1))}function s(x){return!!(x&&typeof x.pipe=="function"&&x._readableState&&typeof x.on=="function"&&typeof x.write=="function")}function a(x){return x&&(x._readableState||x._writableState||typeof x.write=="function"&&typeof x.on=="function"||typeof x.pipe=="function"&&typeof x.on=="function")}function p(x){return!!(x&&!a(x)&&typeof x.pipeThrough=="function"&&typeof x.getReader=="function"&&typeof x.cancel=="function")}function h(x){return!!(x&&!a(x)&&typeof x.getWriter=="function"&&typeof x.abort=="function")}function b(x){return!!(x&&!a(x)&&typeof x.readable=="object"&&typeof x.writable=="object")}function g(x){return p(x)||h(x)||b(x)}function y(x,z){return x==null?!1:z===!0?typeof x[e]=="function":z===!1?typeof x[r]=="function":typeof x[e]=="function"||typeof x[r]=="function"}function S(x){if(!a(x))return null;const z=x._writableState,K=x._readableState,L=z||K;return!!(x.destroyed||x[t]||L!=null&&L.destroyed)}function E(x){if(!f(x))return null;if(x.writableEnded===!0)return!0;const z=x._writableState;return z!=null&&z.errored?!1:typeof(z==null?void 0:z.ended)!="boolean"?null:z.ended}function I(x,z){if(!f(x))return null;if(x.writableFinished===!0)return!0;const K=x._writableState;return K!=null&&K.errored?!1:typeof(K==null?void 0:K.finished)!="boolean"?null:!!(K.finished||z===!1&&K.ended===!0&&K.length===0)}function k(x){if(!c(x))return null;if(x.readableEnded===!0)return!0;const z=x._readableState;return!z||z.errored?!1:typeof(z==null?void 0:z.ended)!="boolean"?null:z.ended}function T(x,z){if(!c(x))return null;const K=x._readableState;return K!=null&&K.errored?!1:typeof(K==null?void 0:K.endEmitted)!="boolean"?null:!!(K.endEmitted||z===!1&&K.ended===!0&&K.length===0)}function w(x){return x&&x[l]!=null?x[l]:typeof(x==null?void 0:x.readable)!="boolean"?null:S(x)?!1:c(x)&&x.readable&&!T(x)}function F(x){return x&&x[u]!=null?x[u]:typeof(x==null?void 0:x.writable)!="boolean"?null:S(x)?!1:f(x)&&x.writable&&!E(x)}function P(x,z){return a(x)?S(x)?!0:!((z==null?void 0:z.readable)!==!1&&w(x)||(z==null?void 0:z.writable)!==!1&&F(x)):null}function C(x){var z,K;return a(x)?x.writableErrored?x.writableErrored:(z=(K=x._writableState)===null||K===void 0?void 0:K.errored)!==null&&z!==void 0?z:null:null}function B(x){var z,K;return a(x)?x.readableErrored?x.readableErrored:(z=(K=x._readableState)===null||K===void 0?void 0:K.errored)!==null&&z!==void 0?z:null:null}function D(x){if(!a(x))return null;if(typeof x.closed=="boolean")return x.closed;const z=x._writableState,K=x._readableState;return typeof(z==null?void 0:z.closed)=="boolean"||typeof(K==null?void 0:K.closed)=="boolean"?(z==null?void 0:z.closed)||(K==null?void 0:K.closed):typeof x._closed=="boolean"&&V(x)?x._closed:null}function V(x){return typeof x._closed=="boolean"&&typeof x._defaultKeepAlive=="boolean"&&typeof x._removedConnection=="boolean"&&typeof x._removedContLen=="boolean"}function Q(x){return typeof x._sent100=="boolean"&&V(x)}function ee(x){var z;return typeof x._consuming=="boolean"&&typeof x._dumped=="boolean"&&((z=x.req)===null||z===void 0?void 0:z.upgradeOrConnect)===void 0}function ue(x){if(!a(x))return null;const z=x._writableState,K=x._readableState,L=z||K;return!L&&Q(x)||!!(L&&L.autoDestroy&&L.emitClose&&L.closed===!1)}function N(x){var z;return!!(x&&((z=x[m])!==null&&z!==void 0?z:x.readableDidRead||x.readableAborted))}function te(x){var z,K,L,ae,ie,le,oe,O,$,J;return!!(x&&((z=(K=(L=(ae=(ie=(le=x[o])!==null&&le!==void 0?le:x.readableErrored)!==null&&ie!==void 0?ie:x.writableErrored)!==null&&ae!==void 0?ae:(oe=x._readableState)===null||oe===void 0?void 0:oe.errorEmitted)!==null&&L!==void 0?L:(O=x._writableState)===null||O===void 0?void 0:O.errorEmitted)!==null&&K!==void 0?K:($=x._readableState)===null||$===void 0?void 0:$.errored)!==null&&z!==void 0?z:!((J=x._writableState)===null||J===void 0)&&J.errored))}return utils={isDestroyed:S,kIsDestroyed:t,isDisturbed:N,kIsDisturbed:m,isErrored:te,kIsErrored:o,isReadable:w,kIsReadable:l,kIsClosedPromise:d,kControllerErrorFunction:i,kIsWritable:u,isClosed:D,isDuplexNodeStream:s,isFinished:P,isIterable:y,isReadableNodeStream:c,isReadableStream:p,isReadableEnded:k,isReadableFinished:T,isReadableErrored:B,isNodeStream:a,isWebStream:g,isWritable:F,isWritableNodeStream:f,isWritableStream:h,isWritableEnded:E,isWritableFinished:I,isWritableErrored:C,isServerRequest:ee,isServerResponse:Q,willEmitClose:ue,isTransformStream:b},utils}var hasRequiredEndOfStream;function requireEndOfStream(){if(hasRequiredEndOfStream)return endOfStream.exports;hasRequiredEndOfStream=1;const e=requireBrowser$1(),{AbortError:r,codes:n}=requireErrors(),{ERR_INVALID_ARG_TYPE:t,ERR_STREAM_PREMATURE_CLOSE:o}=n,{kEmptyObject:l,once:u}=requireUtil(),{validateAbortSignal:m,validateFunction:d,validateObject:i,validateBoolean:c}=requireValidators(),{Promise:f,PromisePrototypeThen:s,SymbolDispose:a}=requirePrimordials(),{isClosed:p,isReadable:h,isReadableNodeStream:b,isReadableStream:g,isReadableFinished:y,isReadableErrored:S,isWritable:E,isWritableNodeStream:I,isWritableStream:k,isWritableFinished:T,isWritableErrored:w,isNodeStream:F,willEmitClose:P,kIsClosedPromise:C}=requireUtils();let B;function D(N){return N.setHeader&&typeof N.abort=="function"}const V=()=>{};function Q(N,te,x){var z,K;if(arguments.length===2?(x=te,te=l):te==null?te=l:i(te,"options"),d(x,"callback"),m(te.signal,"options.signal"),x=u(x),g(N)||k(N))return ee(N,te,x);if(!F(N))throw new t("stream",["ReadableStream","WritableStream","Stream"],N);const L=(z=te.readable)!==null&&z!==void 0?z:b(N),ae=(K=te.writable)!==null&&K!==void 0?K:I(N),ie=N._writableState,le=N._readableState,oe=()=>{N.writable||J()};let O=P(N)&&b(N)===L&&I(N)===ae,$=T(N,!1);const J=()=>{$=!0,N.destroyed&&(O=!1),!(O&&(!N.readable||L))&&(!L||se)&&x.call(N)};let se=y(N,!1);const ne=()=>{se=!0,N.destroyed&&(O=!1),!(O&&(!N.writable||ae))&&(!ae||$)&&x.call(N)},A=R=>{x.call(N,R)};let M=p(N);const q=()=>{M=!0;const R=w(N)||S(N);if(R&&typeof R!="boolean")return x.call(N,R);if(L&&!se&&b(N,!0)&&!y(N,!1))return x.call(N,new o);if(ae&&!$&&!T(N,!1))return x.call(N,new o);x.call(N)},X=()=>{M=!0;const R=w(N)||S(N);if(R&&typeof R!="boolean")return x.call(N,R);x.call(N)},G=()=>{N.req.on("finish",J)};D(N)?(N.on("complete",J),O||N.on("abort",q),N.req?G():N.on("request",G)):ae&&!ie&&(N.on("end",oe),N.on("close",oe)),!O&&typeof N.aborted=="boolean"&&N.on("aborted",q),N.on("end",ne),N.on("finish",J),te.error!==!1&&N.on("error",A),N.on("close",q),M?e.nextTick(q):ie!=null&&ie.errorEmitted||le!=null&&le.errorEmitted?O||e.nextTick(X):(!L&&(!O||h(N))&&($||E(N)===!1)||!ae&&(!O||E(N))&&(se||h(N)===!1)||le&&N.req&&N.aborted)&&e.nextTick(X);const W=()=>{x=V,N.removeListener("aborted",q),N.removeListener("complete",J),N.removeListener("abort",q),N.removeListener("request",G),N.req&&N.req.removeListener("finish",J),N.removeListener("end",oe),N.removeListener("close",oe),N.removeListener("finish",J),N.removeListener("end",ne),N.removeListener("error",A),N.removeListener("close",q)};if(te.signal&&!M){const R=()=>{const j=x;W(),j.call(N,new r(void 0,{cause:te.signal.reason}))};if(te.signal.aborted)e.nextTick(R);else{B=B||requireUtil().addAbortListener;const j=B(te.signal,R),H=x;x=u((...U)=>{j[a](),H.apply(N,U)})}}return W}function ee(N,te,x){let z=!1,K=V;if(te.signal)if(K=()=>{z=!0,x.call(N,new r(void 0,{cause:te.signal.reason}))},te.signal.aborted)e.nextTick(K);else{B=B||requireUtil().addAbortListener;const ae=B(te.signal,K),ie=x;x=u((...le)=>{ae[a](),ie.apply(N,le)})}const L=(...ae)=>{z||e.nextTick(()=>x.apply(N,ae))};return s(N[C].promise,L,L),V}function ue(N,te){var x;let z=!1;return te===null&&(te=l),(x=te)!==null&&x!==void 0&&x.cleanup&&(c(te.cleanup,"cleanup"),z=te.cleanup),new f((K,L)=>{const ae=Q(N,te,ie=>{z&&ae(),ie?L(ie):K()})})}return endOfStream.exports=Q,endOfStream.exports.finished=ue,endOfStream.exports}var destroy_1,hasRequiredDestroy;function requireDestroy(){if(hasRequiredDestroy)return destroy_1;hasRequiredDestroy=1;const e=requireBrowser$1(),{aggregateTwoErrors:r,codes:{ERR_MULTIPLE_CALLBACK:n},AbortError:t}=requireErrors(),{Symbol:o}=requirePrimordials(),{kIsDestroyed:l,isDestroyed:u,isFinished:m,isServerRequest:d}=requireUtils(),i=o("kDestroy"),c=o("kConstruct");function f(P,C,B){P&&(P.stack,C&&!C.errored&&(C.errored=P),B&&!B.errored&&(B.errored=P))}function s(P,C){const B=this._readableState,D=this._writableState,V=D||B;return D!=null&&D.destroyed||B!=null&&B.destroyed?(typeof C=="function"&&C(),this):(f(P,D,B),D&&(D.destroyed=!0),B&&(B.destroyed=!0),V.constructed?a(this,P,C):this.once(i,function(Q){a(this,r(Q,P),C)}),this)}function a(P,C,B){let D=!1;function V(Q){if(D)return;D=!0;const ee=P._readableState,ue=P._writableState;f(Q,ue,ee),ue&&(ue.closed=!0),ee&&(ee.closed=!0),typeof B=="function"&&B(Q),Q?e.nextTick(p,P,Q):e.nextTick(h,P)}try{P._destroy(C||null,V)}catch(Q){V(Q)}}function p(P,C){b(P,C),h(P)}function h(P){const C=P._readableState,B=P._writableState;B&&(B.closeEmitted=!0),C&&(C.closeEmitted=!0),(B!=null&&B.emitClose||C!=null&&C.emitClose)&&P.emit("close")}function b(P,C){const B=P._readableState,D=P._writableState;D!=null&&D.errorEmitted||B!=null&&B.errorEmitted||(D&&(D.errorEmitted=!0),B&&(B.errorEmitted=!0),P.emit("error",C))}function g(){const P=this._readableState,C=this._writableState;P&&(P.constructed=!0,P.closed=!1,P.closeEmitted=!1,P.destroyed=!1,P.errored=null,P.errorEmitted=!1,P.reading=!1,P.ended=P.readable===!1,P.endEmitted=P.readable===!1),C&&(C.constructed=!0,C.destroyed=!1,C.closed=!1,C.closeEmitted=!1,C.errored=null,C.errorEmitted=!1,C.finalCalled=!1,C.prefinished=!1,C.ended=C.writable===!1,C.ending=C.writable===!1,C.finished=C.writable===!1)}function y(P,C,B){const D=P._readableState,V=P._writableState;if(V!=null&&V.destroyed||D!=null&&D.destroyed)return this;D!=null&&D.autoDestroy||V!=null&&V.autoDestroy?P.destroy(C):C&&(C.stack,V&&!V.errored&&(V.errored=C),D&&!D.errored&&(D.errored=C),B?e.nextTick(b,P,C):b(P,C))}function S(P,C){if(typeof P._construct!="function")return;const B=P._readableState,D=P._writableState;B&&(B.constructed=!1),D&&(D.constructed=!1),P.once(c,C),!(P.listenerCount(c)>1)&&e.nextTick(E,P)}function E(P){let C=!1;function B(D){if(C){y(P,D??new n);return}C=!0;const V=P._readableState,Q=P._writableState,ee=Q||V;V&&(V.constructed=!0),Q&&(Q.constructed=!0),ee.destroyed?P.emit(i,D):D?y(P,D,!0):e.nextTick(I,P)}try{P._construct(D=>{e.nextTick(B,D)})}catch(D){e.nextTick(B,D)}}function I(P){P.emit(c)}function k(P){return(P==null?void 0:P.setHeader)&&typeof P.abort=="function"}function T(P){P.emit("close")}function w(P,C){P.emit("error",C),e.nextTick(T,P)}function F(P,C){!P||u(P)||(!C&&!m(P)&&(C=new t),d(P)?(P.socket=null,P.destroy(C)):k(P)?P.abort():k(P.req)?P.req.abort():typeof P.destroy=="function"?P.destroy(C):typeof P.close=="function"?P.close():C?e.nextTick(w,P,C):e.nextTick(T,P),P.destroyed||(P[l]=!0))}return destroy_1={construct:S,destroyer:F,destroy:s,undestroy:g,errorOrDestroy:y},destroy_1}var legacy,hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1;const{ArrayIsArray:e,ObjectSetPrototypeOf:r}=requirePrimordials(),{EventEmitter:n}=requireEvents();function t(l){n.call(this,l)}r(t.prototype,n.prototype),r(t,n),t.prototype.pipe=function(l,u){const m=this;function d(h){l.writable&&l.write(h)===!1&&m.pause&&m.pause()}m.on("data",d);function i(){m.readable&&m.resume&&m.resume()}l.on("drain",i),!l._isStdio&&(!u||u.end!==!1)&&(m.on("end",f),m.on("close",s));let c=!1;function f(){c||(c=!0,l.end())}function s(){c||(c=!0,typeof l.destroy=="function"&&l.destroy())}function a(h){p(),n.listenerCount(this,"error")===0&&this.emit("error",h)}o(m,"error",a),o(l,"error",a);function p(){m.removeListener("data",d),l.removeListener("drain",i),m.removeListener("end",f),m.removeListener("close",s),m.removeListener("error",a),l.removeListener("error",a),m.removeListener("end",p),m.removeListener("close",p),l.removeListener("close",p)}return m.on("end",p),m.on("close",p),l.on("close",p),l.emit("pipe",m),l};function o(l,u,m){if(typeof l.prependListener=="function")return l.prependListener(u,m);!l._events||!l._events[u]?l.on(u,m):e(l._events[u])?l._events[u].unshift(m):l._events[u]=[m,l._events[u]]}return legacy={Stream:t,prependListener:o},legacy}var addAbortSignal={exports:{}},hasRequiredAddAbortSignal;function requireAddAbortSignal(){return hasRequiredAddAbortSignal||(hasRequiredAddAbortSignal=1,function(e){const{SymbolDispose:r}=requirePrimordials(),{AbortError:n,codes:t}=requireErrors(),{isNodeStream:o,isWebStream:l,kControllerErrorFunction:u}=requireUtils(),m=requireEndOfStream(),{ERR_INVALID_ARG_TYPE:d}=t;let i;const c=(f,s)=>{if(typeof f!="object"||!("aborted"in f))throw new d(s,"AbortSignal",f)};e.exports.addAbortSignal=function(s,a){if(c(s,"signal"),!o(a)&&!l(a))throw new d("stream",["ReadableStream","WritableStream","Stream"],a);return e.exports.addAbortSignalNoValidate(s,a)},e.exports.addAbortSignalNoValidate=function(f,s){if(typeof f!="object"||!("aborted"in f))return s;const a=o(s)?()=>{s.destroy(new n(void 0,{cause:f.reason}))}:()=>{s[u](new n(void 0,{cause:f.reason}))};if(f.aborted)a();else{i=i||requireUtil().addAbortListener;const p=i(f,a);m(s,p[r])}return s}}(addAbortSignal)),addAbortSignal.exports}var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;const{StringPrototypeSlice:e,SymbolIterator:r,TypedArrayPrototypeSet:n,Uint8Array:t}=requirePrimordials(),{Buffer:o}=requireBuffer(),{inspect:l}=requireUtil();return buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(m){const d={data:m,next:null};this.length>0?this.tail.next=d:this.head=d,this.tail=d,++this.length}unshift(m){const d={data:m,next:this.head};this.length===0&&(this.tail=d),this.head=d,++this.length}shift(){if(this.length===0)return;const m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}clear(){this.head=this.tail=null,this.length=0}join(m){if(this.length===0)return"";let d=this.head,i=""+d.data;for(;(d=d.next)!==null;)i+=m+d.data;return i}concat(m){if(this.length===0)return o.alloc(0);const d=o.allocUnsafe(m>>>0);let i=this.head,c=0;for(;i;)n(d,i.data,c),c+=i.data.length,i=i.next;return d}consume(m,d){const i=this.head.data;if(m<i.length){const c=i.slice(0,m);return this.head.data=i.slice(m),c}return m===i.length?this.shift():d?this._getString(m):this._getBuffer(m)}first(){return this.head.data}*[r](){for(let m=this.head;m;m=m.next)yield m.data}_getString(m){let d="",i=this.head,c=0;do{const f=i.data;if(m>f.length)d+=f,m-=f.length;else{m===f.length?(d+=f,++c,i.next?this.head=i.next:this.head=this.tail=null):(d+=e(f,0,m),this.head=i,i.data=e(f,m));break}++c}while((i=i.next)!==null);return this.length-=c,d}_getBuffer(m){const d=o.allocUnsafe(m),i=m;let c=this.head,f=0;do{const s=c.data;if(m>s.length)n(d,s,i-m),m-=s.length;else{m===s.length?(n(d,s,i-m),++f,c.next?this.head=c.next:this.head=this.tail=null):(n(d,new t(s.buffer,s.byteOffset,m),i-m),this.head=c,c.data=s.slice(m));break}++f}while((c=c.next)!==null);return this.length-=f,d}[Symbol.for("nodejs.util.inspect.custom")](m,d){return l(this,{...d,depth:0,customInspect:!1})}},buffer_list}var state,hasRequiredState;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;const{MathFloor:e,NumberIsInteger:r}=requirePrimordials(),{validateInteger:n}=requireValidators(),{ERR_INVALID_ARG_VALUE:t}=requireErrors().codes;let o=16*1024,l=16;function u(c,f,s){return c.highWaterMark!=null?c.highWaterMark:f?c[s]:null}function m(c){return c?l:o}function d(c,f){n(f,"value",0),c?l=f:o=f}function i(c,f,s,a){const p=u(f,a,s);if(p!=null){if(!r(p)||p<0){const h=a?`options.${s}`:"options.highWaterMark";throw new t(h,p)}return e(p)}return m(c.objectMode)}return state={getHighWaterMark:i,getDefaultHighWaterMark:m,setDefaultHighWaterMark:d},state}var string_decoder={},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,function(e,r){var n=requireBuffer(),t=n.Buffer;function o(u,m){for(var d in u)m[d]=u[d]}t.from&&t.alloc&&t.allocUnsafe&&t.allocUnsafeSlow?e.exports=n:(o(n,r),r.Buffer=l);function l(u,m,d){return t(u,m,d)}l.prototype=Object.create(t.prototype),o(t,l),l.from=function(u,m,d){if(typeof u=="number")throw new TypeError("Argument must not be a number");return t(u,m,d)},l.alloc=function(u,m,d){if(typeof u!="number")throw new TypeError("Argument must be a number");var i=t(u);return m!==void 0?typeof d=="string"?i.fill(m,d):i.fill(m):i.fill(0),i},l.allocUnsafe=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return t(u)},l.allocUnsafeSlow=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(u)}}(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var e=requireSafeBuffer().Buffer,r=e.isEncoding||function(g){switch(g=""+g,g&&g.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(g){if(!g)return"utf8";for(var y;;)switch(g){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return g;default:if(y)return;g=(""+g).toLowerCase(),y=!0}}function t(g){var y=n(g);if(typeof y!="string"&&(e.isEncoding===r||!r(g)))throw new Error("Unknown encoding: "+g);return y||g}string_decoder.StringDecoder=o;function o(g){this.encoding=t(g);var y;switch(this.encoding){case"utf16le":this.text=f,this.end=s,y=4;break;case"utf8":this.fillLast=d,y=4;break;case"base64":this.text=a,this.end=p,y=3;break;default:this.write=h,this.end=b;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(y)}o.prototype.write=function(g){if(g.length===0)return"";var y,S;if(this.lastNeed){if(y=this.fillLast(g),y===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<g.length?y?y+this.text(g,S):this.text(g,S):y||""},o.prototype.end=c,o.prototype.text=i,o.prototype.fillLast=function(g){if(this.lastNeed<=g.length)return g.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);g.copy(this.lastChar,this.lastTotal-this.lastNeed,0,g.length),this.lastNeed-=g.length};function l(g){return g<=127?0:g>>5===6?2:g>>4===14?3:g>>3===30?4:g>>6===2?-1:-2}function u(g,y,S){var E=y.length-1;if(E<S)return 0;var I=l(y[E]);return I>=0?(I>0&&(g.lastNeed=I-1),I):--E<S||I===-2?0:(I=l(y[E]),I>=0?(I>0&&(g.lastNeed=I-2),I):--E<S||I===-2?0:(I=l(y[E]),I>=0?(I>0&&(I===2?I=0:g.lastNeed=I-3),I):0))}function m(g,y,S){if((y[0]&192)!==128)return g.lastNeed=0,"�";if(g.lastNeed>1&&y.length>1){if((y[1]&192)!==128)return g.lastNeed=1,"�";if(g.lastNeed>2&&y.length>2&&(y[2]&192)!==128)return g.lastNeed=2,"�"}}function d(g){var y=this.lastTotal-this.lastNeed,S=m(this,g);if(S!==void 0)return S;if(this.lastNeed<=g.length)return g.copy(this.lastChar,y,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);g.copy(this.lastChar,y,0,g.length),this.lastNeed-=g.length}function i(g,y){var S=u(this,g,y);if(!this.lastNeed)return g.toString("utf8",y);this.lastTotal=S;var E=g.length-(S-this.lastNeed);return g.copy(this.lastChar,0,E),g.toString("utf8",y,E)}function c(g){var y=g&&g.length?this.write(g):"";return this.lastNeed?y+"�":y}function f(g,y){if((g.length-y)%2===0){var S=g.toString("utf16le",y);if(S){var E=S.charCodeAt(S.length-1);if(E>=55296&&E<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=g[g.length-2],this.lastChar[1]=g[g.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=g[g.length-1],g.toString("utf16le",y,g.length-1)}function s(g){var y=g&&g.length?this.write(g):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return y+this.lastChar.toString("utf16le",0,S)}return y}function a(g,y){var S=(g.length-y)%3;return S===0?g.toString("base64",y):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=g[g.length-1]:(this.lastChar[0]=g[g.length-2],this.lastChar[1]=g[g.length-1]),g.toString("base64",y,g.length-S))}function p(g){var y=g&&g.length?this.write(g):"";return this.lastNeed?y+this.lastChar.toString("base64",0,3-this.lastNeed):y}function h(g){return g.toString(this.encoding)}function b(g){return g&&g.length?this.write(g):""}return string_decoder}var from_1,hasRequiredFrom;function requireFrom(){if(hasRequiredFrom)return from_1;hasRequiredFrom=1;const e=requireBrowser$1(),{PromisePrototypeThen:r,SymbolAsyncIterator:n,SymbolIterator:t}=requirePrimordials(),{Buffer:o}=requireBuffer(),{ERR_INVALID_ARG_TYPE:l,ERR_STREAM_NULL_VALUES:u}=requireErrors().codes;function m(d,i,c){let f;if(typeof i=="string"||i instanceof o)return new d({objectMode:!0,...c,read(){this.push(i),this.push(null)}});let s;if(i&&i[n])s=!0,f=i[n]();else if(i&&i[t])s=!1,f=i[t]();else throw new l("iterable",["Iterable"],i);const a=new d({objectMode:!0,highWaterMark:1,...c});let p=!1;a._read=function(){p||(p=!0,b())},a._destroy=function(g,y){r(h(g),()=>e.nextTick(y,g),S=>e.nextTick(y,S||g))};async function h(g){const y=g!=null,S=typeof f.throw=="function";if(y&&S){const{value:E,done:I}=await f.throw(g);if(await E,I)return}if(typeof f.return=="function"){const{value:E}=await f.return();await E}}async function b(){for(;;){try{const{value:g,done:y}=s?await f.next():f.next();if(y)a.push(null);else{const S=g&&typeof g.then=="function"?await g:g;if(S===null)throw p=!1,new u;if(a.push(S))continue;p=!1}}catch(g){a.destroy(g)}break}}return a}return from_1=m,from_1}var readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const e=requireBrowser$1(),{ArrayPrototypeIndexOf:r,NumberIsInteger:n,NumberIsNaN:t,NumberParseInt:o,ObjectDefineProperties:l,ObjectKeys:u,ObjectSetPrototypeOf:m,Promise:d,SafeSet:i,SymbolAsyncDispose:c,SymbolAsyncIterator:f,Symbol:s}=requirePrimordials();readable=U,U.ReadableState=H;const{EventEmitter:a}=requireEvents(),{Stream:p,prependListener:h}=requireLegacy(),{Buffer:b}=requireBuffer(),{addAbortSignal:g}=requireAddAbortSignal(),y=requireEndOfStream();let S=requireUtil().debuglog("stream",_=>{S=_});const E=requireBuffer_list(),I=requireDestroy(),{getHighWaterMark:k,getDefaultHighWaterMark:T}=requireState(),{aggregateTwoErrors:w,codes:{ERR_INVALID_ARG_TYPE:F,ERR_METHOD_NOT_IMPLEMENTED:P,ERR_OUT_OF_RANGE:C,ERR_STREAM_PUSH_AFTER_EOF:B,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:D},AbortError:V}=requireErrors(),{validateObject:Q}=requireValidators(),ee=s("kPaused"),{StringDecoder:ue}=requireString_decoder(),N=requireFrom();m(U.prototype,p.prototype),m(U,p);const te=()=>{},{errorOrDestroy:x}=I,z=1,K=2,L=4,ae=8,ie=16,le=32,oe=64,O=128,$=256,J=512,se=1024,ne=2048,A=4096,M=8192,q=16384,X=32768,G=65536,W=1<<17,R=1<<18;function j(_){return{enumerable:!1,get(){return(this.state&_)!==0},set(v){v?this.state|=_:this.state&=~_}}}l(H.prototype,{objectMode:j(z),ended:j(K),endEmitted:j(L),reading:j(ae),constructed:j(ie),sync:j(le),needReadable:j(oe),emittedReadable:j(O),readableListening:j($),resumeScheduled:j(J),errorEmitted:j(se),emitClose:j(ne),autoDestroy:j(A),destroyed:j(M),closed:j(q),closeEmitted:j(X),multiAwaitDrain:j(G),readingMore:j(W),dataEmitted:j(R)});function H(_,v,Y){typeof Y!="boolean"&&(Y=v instanceof requireDuplex()),this.state=ne|A|ie|le,_&&_.objectMode&&(this.state|=z),Y&&_&&_.readableObjectMode&&(this.state|=z),this.highWaterMark=_?k(this,_,"readableHighWaterMark",Y):T(!1),this.buffer=new E,this.length=0,this.pipes=[],this.flowing=null,this[ee]=null,_&&_.emitClose===!1&&(this.state&=-2049),_&&_.autoDestroy===!1&&(this.state&=-4097),this.errored=null,this.defaultEncoding=_&&_.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,_&&_.encoding&&(this.decoder=new ue(_.encoding),this.encoding=_.encoding)}function U(_){if(!(this instanceof U))return new U(_);const v=this instanceof requireDuplex();this._readableState=new H(_,this,v),_&&(typeof _.read=="function"&&(this._read=_.read),typeof _.destroy=="function"&&(this._destroy=_.destroy),typeof _.construct=="function"&&(this._construct=_.construct),_.signal&&!v&&g(_.signal,this)),p.call(this,_),I.construct(this,()=>{this._readableState.needReadable&&ge(this,this._readableState)})}U.prototype.destroy=I.destroy,U.prototype._undestroy=I.undestroy,U.prototype._destroy=function(_,v){v(_)},U.prototype[a.captureRejectionSymbol]=function(_){this.destroy(_)},U.prototype[c]=function(){let _;return this.destroyed||(_=this.readableEnded?null:new V,this.destroy(_)),new d((v,Y)=>y(this,Z=>Z&&Z!==_?Y(Z):v(null)))},U.prototype.push=function(_,v){return ce(this,_,v,!1)},U.prototype.unshift=function(_,v){return ce(this,_,v,!0)};function ce(_,v,Y,Z){S("readableAddChunk",v);const re=_._readableState;let me;if((re.state&z)===0&&(typeof v=="string"?(Y=Y||re.defaultEncoding,re.encoding!==Y&&(Z&&re.encoding?v=b.from(v,Y).toString(re.encoding):(v=b.from(v,Y),Y=""))):v instanceof b?Y="":p._isUint8Array(v)?(v=p._uint8ArrayToBuffer(v),Y=""):v!=null&&(me=new F("chunk",["string","Buffer","Uint8Array"],v))),me)x(_,me);else if(v===null)re.state&=-9,Te(_,re);else if((re.state&z)!==0||v&&v.length>0)if(Z)if((re.state&L)!==0)x(_,new D);else{if(re.destroyed||re.errored)return!1;pe(_,re,v,!0)}else if(re.ended)x(_,new B);else{if(re.destroyed||re.errored)return!1;re.state&=-9,re.decoder&&!Y?(v=re.decoder.write(v),re.objectMode||v.length!==0?pe(_,re,v,!1):ge(_,re)):pe(_,re,v,!1)}else Z||(re.state&=-9,ge(_,re));return!re.ended&&(re.length<re.highWaterMark||re.length===0)}function pe(_,v,Y,Z){v.flowing&&v.length===0&&!v.sync&&_.listenerCount("data")>0?((v.state&G)!==0?v.awaitDrainWriters.clear():v.awaitDrainWriters=null,v.dataEmitted=!0,_.emit("data",Y)):(v.length+=v.objectMode?1:Y.length,Z?v.buffer.unshift(Y):v.buffer.push(Y),(v.state&oe)!==0&&Se(_)),ge(_,v)}U.prototype.isPaused=function(){const _=this._readableState;return _[ee]===!0||_.flowing===!1},U.prototype.setEncoding=function(_){const v=new ue(_);this._readableState.decoder=v,this._readableState.encoding=this._readableState.decoder.encoding;const Y=this._readableState.buffer;let Z="";for(const re of Y)Z+=v.write(re);return Y.clear(),Z!==""&&Y.push(Z),this._readableState.length=Z.length,this};const de=1073741824;function he(_){if(_>de)throw new C("size","<= 1GiB",_);return _--,_|=_>>>1,_|=_>>>2,_|=_>>>4,_|=_>>>8,_|=_>>>16,_++,_}function fe(_,v){return _<=0||v.length===0&&v.ended?0:(v.state&z)!==0?1:t(_)?v.flowing&&v.length?v.buffer.first().length:v.length:_<=v.length?_:v.ended?v.length:0}U.prototype.read=function(_){S("read",_),_===void 0?_=NaN:n(_)||(_=o(_,10));const v=this._readableState,Y=_;if(_>v.highWaterMark&&(v.highWaterMark=he(_)),_!==0&&(v.state&=-129),_===0&&v.needReadable&&((v.highWaterMark!==0?v.length>=v.highWaterMark:v.length>0)||v.ended))return S("read: emitReadable",v.length,v.ended),v.length===0&&v.ended?Ae(this):Se(this),null;if(_=fe(_,v),_===0&&v.ended)return v.length===0&&Ae(this),null;let Z=(v.state&oe)!==0;if(S("need readable",Z),(v.length===0||v.length-_<v.highWaterMark)&&(Z=!0,S("length less than watermark",Z)),v.ended||v.reading||v.destroyed||v.errored||!v.constructed)Z=!1,S("reading, ended or constructing",Z);else if(Z){S("do read"),v.state|=ae|le,v.length===0&&(v.state|=oe);try{this._read(v.highWaterMark)}catch(me){x(this,me)}v.state&=-33,v.reading||(_=fe(Y,v))}let re;return _>0?re=$e(_,v):re=null,re===null?(v.needReadable=v.length<=v.highWaterMark,_=0):(v.length-=_,v.multiAwaitDrain?v.awaitDrainWriters.clear():v.awaitDrainWriters=null),v.length===0&&(v.ended||(v.needReadable=!0),Y!==_&&v.ended&&Ae(this)),re!==null&&!v.errorEmitted&&!v.closeEmitted&&(v.dataEmitted=!0,this.emit("data",re)),re};function Te(_,v){if(S("onEofChunk"),!v.ended){if(v.decoder){const Y=v.decoder.end();Y&&Y.length&&(v.buffer.push(Y),v.length+=v.objectMode?1:Y.length)}v.ended=!0,v.sync?Se(_):(v.needReadable=!1,v.emittedReadable=!0,Re(_))}}function Se(_){const v=_._readableState;S("emitReadable",v.needReadable,v.emittedReadable),v.needReadable=!1,v.emittedReadable||(S("emitReadable",v.flowing),v.emittedReadable=!0,e.nextTick(Re,_))}function Re(_){const v=_._readableState;S("emitReadable_",v.destroyed,v.length,v.ended),!v.destroyed&&!v.errored&&(v.length||v.ended)&&(_.emit("readable"),v.emittedReadable=!1),v.needReadable=!v.flowing&&!v.ended&&v.length<=v.highWaterMark,Ue(_)}function ge(_,v){!v.readingMore&&v.constructed&&(v.readingMore=!0,e.nextTick(Ke,_,v))}function Ke(_,v){for(;!v.reading&&!v.ended&&(v.length<v.highWaterMark||v.flowing&&v.length===0);){const Y=v.length;if(S("maybeReadMore read 0"),_.read(0),Y===v.length)break}v.readingMore=!1}U.prototype._read=function(_){throw new P("_read()")},U.prototype.pipe=function(_,v){const Y=this,Z=this._readableState;Z.pipes.length===1&&(Z.multiAwaitDrain||(Z.multiAwaitDrain=!0,Z.awaitDrainWriters=new i(Z.awaitDrainWriters?[Z.awaitDrainWriters]:[]))),Z.pipes.push(_),S("pipe count=%d opts=%j",Z.pipes.length,v);const me=(!v||v.end!==!1)&&_!==e.stdout&&_!==e.stderr?We:Ie;Z.endEmitted?e.nextTick(me):Y.once("end",me),_.on("unpipe",be);function be(Ee,ye){S("onunpipe"),Ee===Y&&ye&&ye.hasUnpiped===!1&&(ye.hasUnpiped=!0,nt())}function We(){S("onend"),_.end()}let ke,He=!1;function nt(){S("cleanup"),_.removeListener("close",De),_.removeListener("finish",Be),ke&&_.removeListener("drain",ke),_.removeListener("error",Me),_.removeListener("unpipe",be),Y.removeListener("end",We),Y.removeListener("end",Ie),Y.removeListener("data",Ve),He=!0,ke&&Z.awaitDrainWriters&&(!_._writableState||_._writableState.needDrain)&&ke()}function Ge(){He||(Z.pipes.length===1&&Z.pipes[0]===_?(S("false write response, pause",0),Z.awaitDrainWriters=_,Z.multiAwaitDrain=!1):Z.pipes.length>1&&Z.pipes.includes(_)&&(S("false write response, pause",Z.awaitDrainWriters.size),Z.awaitDrainWriters.add(_)),Y.pause()),ke||(ke=Je(Y,_),_.on("drain",ke))}Y.on("data",Ve);function Ve(Ee){S("ondata");const ye=_.write(Ee);S("dest.write",ye),ye===!1&&Ge()}function Me(Ee){if(S("onerror",Ee),Ie(),_.removeListener("error",Me),_.listenerCount("error")===0){const ye=_._writableState||_._readableState;ye&&!ye.errorEmitted?x(_,Ee):_.emit("error",Ee)}}h(_,"error",Me);function De(){_.removeListener("finish",Be),Ie()}_.once("close",De);function Be(){S("onfinish"),_.removeListener("close",De),Ie()}_.once("finish",Be);function Ie(){S("unpipe"),Y.unpipe(_)}return _.emit("pipe",Y),_.writableNeedDrain===!0?Ge():Z.flowing||(S("pipe resume"),Y.resume()),_};function Je(_,v){return function(){const Z=_._readableState;Z.awaitDrainWriters===v?(S("pipeOnDrain",1),Z.awaitDrainWriters=null):Z.multiAwaitDrain&&(S("pipeOnDrain",Z.awaitDrainWriters.size),Z.awaitDrainWriters.delete(v)),(!Z.awaitDrainWriters||Z.awaitDrainWriters.size===0)&&_.listenerCount("data")&&_.resume()}}U.prototype.unpipe=function(_){const v=this._readableState,Y={hasUnpiped:!1};if(v.pipes.length===0)return this;if(!_){const re=v.pipes;v.pipes=[],this.pause();for(let me=0;me<re.length;me++)re[me].emit("unpipe",this,{hasUnpiped:!1});return this}const Z=r(v.pipes,_);return Z===-1?this:(v.pipes.splice(Z,1),v.pipes.length===0&&this.pause(),_.emit("unpipe",this,Y),this)},U.prototype.on=function(_,v){const Y=p.prototype.on.call(this,_,v),Z=this._readableState;return _==="data"?(Z.readableListening=this.listenerCount("readable")>0,Z.flowing!==!1&&this.resume()):_==="readable"&&!Z.endEmitted&&!Z.readableListening&&(Z.readableListening=Z.needReadable=!0,Z.flowing=!1,Z.emittedReadable=!1,S("on readable",Z.length,Z.reading),Z.length?Se(this):Z.reading||e.nextTick(Qe,this)),Y},U.prototype.addListener=U.prototype.on,U.prototype.removeListener=function(_,v){const Y=p.prototype.removeListener.call(this,_,v);return _==="readable"&&e.nextTick(Ne,this),Y},U.prototype.off=U.prototype.removeListener,U.prototype.removeAllListeners=function(_){const v=p.prototype.removeAllListeners.apply(this,arguments);return(_==="readable"||_===void 0)&&e.nextTick(Ne,this),v};function Ne(_){const v=_._readableState;v.readableListening=_.listenerCount("readable")>0,v.resumeScheduled&&v[ee]===!1?v.flowing=!0:_.listenerCount("data")>0?_.resume():v.readableListening||(v.flowing=null)}function Qe(_){S("readable nexttick read 0"),_.read(0)}U.prototype.resume=function(){const _=this._readableState;return _.flowing||(S("resume"),_.flowing=!_.readableListening,et(this,_)),_[ee]=!1,this};function et(_,v){v.resumeScheduled||(v.resumeScheduled=!0,e.nextTick(tt,_,v))}function tt(_,v){S("resume",v.reading),v.reading||_.read(0),v.resumeScheduled=!1,_.emit("resume"),Ue(_),v.flowing&&!v.reading&&_.read(0)}U.prototype.pause=function(){return S("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(S("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[ee]=!0,this};function Ue(_){const v=_._readableState;for(S("flow",v.flowing);v.flowing&&_.read()!==null;);}U.prototype.wrap=function(_){let v=!1;_.on("data",Z=>{!this.push(Z)&&_.pause&&(v=!0,_.pause())}),_.on("end",()=>{this.push(null)}),_.on("error",Z=>{x(this,Z)}),_.on("close",()=>{this.destroy()}),_.on("destroy",()=>{this.destroy()}),this._read=()=>{v&&_.resume&&(v=!1,_.resume())};const Y=u(_);for(let Z=1;Z<Y.length;Z++){const re=Y[Z];this[re]===void 0&&typeof _[re]=="function"&&(this[re]=_[re].bind(_))}return this},U.prototype[f]=function(){return ze(this)},U.prototype.iterator=function(_){return _!==void 0&&Q(_,"options"),ze(this,_)};function ze(_,v){typeof _.read!="function"&&(_=U.wrap(_,{objectMode:!0}));const Y=rt(_,v);return Y.stream=_,Y}async function*rt(_,v){let Y=te;function Z(be){this===_?(Y(),Y=te):Y=be}_.on("readable",Z);let re;const me=y(_,{writable:!1},be=>{re=be?w(re,be):null,Y(),Y=te});try{for(;;){const be=_.destroyed?null:_.read();if(be!==null)yield be;else{if(re)throw re;if(re===null)return;await new d(Z)}}}catch(be){throw re=w(re,be),re}finally{(re||(v==null?void 0:v.destroyOnReturn)!==!1)&&(re===void 0||_._readableState.autoDestroy)?I.destroyer(_,null):(_.off("readable",Z),me())}}l(U.prototype,{readable:{__proto__:null,get(){const _=this._readableState;return!!_&&_.readable!==!1&&!_.destroyed&&!_.errorEmitted&&!_.endEmitted},set(_){this._readableState&&(this._readableState.readable=!!_)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(_){this._readableState&&(this._readableState.flowing=_)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(_){this._readableState&&(this._readableState.destroyed=_)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),l(H.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[ee]!==!1},set(_){this[ee]=!!_}}}),U._fromList=$e;function $e(_,v){if(v.length===0)return null;let Y;return v.objectMode?Y=v.buffer.shift():!_||_>=v.length?(v.decoder?Y=v.buffer.join(""):v.buffer.length===1?Y=v.buffer.first():Y=v.buffer.concat(v.length),v.buffer.clear()):Y=v.buffer.consume(_,v.decoder),Y}function Ae(_){const v=_._readableState;S("endReadable",v.endEmitted),v.endEmitted||(v.ended=!0,e.nextTick(at,v,_))}function at(_,v){if(S("endReadableNT",_.endEmitted,_.length),!_.errored&&!_.closeEmitted&&!_.endEmitted&&_.length===0){if(_.endEmitted=!0,v.emit("end"),v.writable&&v.allowHalfOpen===!1)e.nextTick(it,v);else if(_.autoDestroy){const Y=v._writableState;(!Y||Y.autoDestroy&&(Y.finished||Y.writable===!1))&&v.destroy()}}}function it(_){_.writable&&!_.writableEnded&&!_.destroyed&&_.end()}U.from=function(_,v){return N(U,_,v)};let Ce;function je(){return Ce===void 0&&(Ce={}),Ce}return U.fromWeb=function(_,v){return je().newStreamReadableFromReadableStream(_,v)},U.toWeb=function(_,v){return je().newReadableStreamFromStreamReadable(_,v)},U.wrap=function(_,v){var Y,Z;return new U({objectMode:(Y=(Z=_.readableObjectMode)!==null&&Z!==void 0?Z:_.objectMode)!==null&&Y!==void 0?Y:!0,...v,destroy(re,me){I.destroyer(_,re),me(re)}}).wrap(_)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const e=requireBrowser$1(),{ArrayPrototypeSlice:r,Error:n,FunctionPrototypeSymbolHasInstance:t,ObjectDefineProperty:o,ObjectDefineProperties:l,ObjectSetPrototypeOf:u,StringPrototypeToLowerCase:m,Symbol:d,SymbolHasInstance:i}=requirePrimordials();writable=Q,Q.WritableState=D;const{EventEmitter:c}=requireEvents(),f=requireLegacy().Stream,{Buffer:s}=requireBuffer(),a=requireDestroy(),{addAbortSignal:p}=requireAddAbortSignal(),{getHighWaterMark:h,getDefaultHighWaterMark:b}=requireState(),{ERR_INVALID_ARG_TYPE:g,ERR_METHOD_NOT_IMPLEMENTED:y,ERR_MULTIPLE_CALLBACK:S,ERR_STREAM_CANNOT_PIPE:E,ERR_STREAM_DESTROYED:I,ERR_STREAM_ALREADY_FINISHED:k,ERR_STREAM_NULL_VALUES:T,ERR_STREAM_WRITE_AFTER_END:w,ERR_UNKNOWN_ENCODING:F}=requireErrors().codes,{errorOrDestroy:P}=a;u(Q.prototype,f.prototype),u(Q,f);function C(){}const B=d("kOnFinished");function D(A,M,q){typeof q!="boolean"&&(q=M instanceof requireDuplex()),this.objectMode=!!(A&&A.objectMode),q&&(this.objectMode=this.objectMode||!!(A&&A.writableObjectMode)),this.highWaterMark=A?h(this,A,"writableHighWaterMark",q):b(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const X=!!(A&&A.decodeStrings===!1);this.decodeStrings=!X,this.defaultEncoding=A&&A.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=x.bind(void 0,M),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,V(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!A||A.emitClose!==!1,this.autoDestroy=!A||A.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[B]=[]}function V(A){A.buffered=[],A.bufferedIndex=0,A.allBuffers=!0,A.allNoop=!0}D.prototype.getBuffer=function(){return r(this.buffered,this.bufferedIndex)},o(D.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function Q(A){const M=this instanceof requireDuplex();if(!M&&!t(Q,this))return new Q(A);this._writableState=new D(A,this,M),A&&(typeof A.write=="function"&&(this._write=A.write),typeof A.writev=="function"&&(this._writev=A.writev),typeof A.destroy=="function"&&(this._destroy=A.destroy),typeof A.final=="function"&&(this._final=A.final),typeof A.construct=="function"&&(this._construct=A.construct),A.signal&&p(A.signal,this)),f.call(this,A),a.construct(this,()=>{const q=this._writableState;q.writing||ae(this,q),O(this,q)})}o(Q,i,{__proto__:null,value:function(A){return t(this,A)?!0:this!==Q?!1:A&&A._writableState instanceof D}}),Q.prototype.pipe=function(){P(this,new E)};function ee(A,M,q,X){const G=A._writableState;if(typeof q=="function")X=q,q=G.defaultEncoding;else{if(!q)q=G.defaultEncoding;else if(q!=="buffer"&&!s.isEncoding(q))throw new F(q);typeof X!="function"&&(X=C)}if(M===null)throw new T;if(!G.objectMode)if(typeof M=="string")G.decodeStrings!==!1&&(M=s.from(M,q),q="buffer");else if(M instanceof s)q="buffer";else if(f._isUint8Array(M))M=f._uint8ArrayToBuffer(M),q="buffer";else throw new g("chunk",["string","Buffer","Uint8Array"],M);let W;return G.ending?W=new w:G.destroyed&&(W=new I("write")),W?(e.nextTick(X,W),P(A,W,!0),W):(G.pendingcb++,ue(A,G,M,q,X))}Q.prototype.write=function(A,M,q){return ee(this,A,M,q)===!0},Q.prototype.cork=function(){this._writableState.corked++},Q.prototype.uncork=function(){const A=this._writableState;A.corked&&(A.corked--,A.writing||ae(this,A))},Q.prototype.setDefaultEncoding=function(M){if(typeof M=="string"&&(M=m(M)),!s.isEncoding(M))throw new F(M);return this._writableState.defaultEncoding=M,this};function ue(A,M,q,X,G){const W=M.objectMode?1:q.length;M.length+=W;const R=M.length<M.highWaterMark;return R||(M.needDrain=!0),M.writing||M.corked||M.errored||!M.constructed?(M.buffered.push({chunk:q,encoding:X,callback:G}),M.allBuffers&&X!=="buffer"&&(M.allBuffers=!1),M.allNoop&&G!==C&&(M.allNoop=!1)):(M.writelen=W,M.writecb=G,M.writing=!0,M.sync=!0,A._write(q,X,M.onwrite),M.sync=!1),R&&!M.errored&&!M.destroyed}function N(A,M,q,X,G,W,R){M.writelen=X,M.writecb=R,M.writing=!0,M.sync=!0,M.destroyed?M.onwrite(new I("write")):q?A._writev(G,M.onwrite):A._write(G,W,M.onwrite),M.sync=!1}function te(A,M,q,X){--M.pendingcb,X(q),L(M),P(A,q)}function x(A,M){const q=A._writableState,X=q.sync,G=q.writecb;if(typeof G!="function"){P(A,new S);return}q.writing=!1,q.writecb=null,q.length-=q.writelen,q.writelen=0,M?(M.stack,q.errored||(q.errored=M),A._readableState&&!A._readableState.errored&&(A._readableState.errored=M),X?e.nextTick(te,A,q,M,G):te(A,q,M,G)):(q.buffered.length>q.bufferedIndex&&ae(A,q),X?q.afterWriteTickInfo!==null&&q.afterWriteTickInfo.cb===G?q.afterWriteTickInfo.count++:(q.afterWriteTickInfo={count:1,cb:G,stream:A,state:q},e.nextTick(z,q.afterWriteTickInfo)):K(A,q,1,G))}function z({stream:A,state:M,count:q,cb:X}){return M.afterWriteTickInfo=null,K(A,M,q,X)}function K(A,M,q,X){for(!M.ending&&!A.destroyed&&M.length===0&&M.needDrain&&(M.needDrain=!1,A.emit("drain"));q-- >0;)M.pendingcb--,X();M.destroyed&&L(M),O(A,M)}function L(A){if(A.writing)return;for(let G=A.bufferedIndex;G<A.buffered.length;++G){var M;const{chunk:W,callback:R}=A.buffered[G],j=A.objectMode?1:W.length;A.length-=j,R((M=A.errored)!==null&&M!==void 0?M:new I("write"))}const q=A[B].splice(0);for(let G=0;G<q.length;G++){var X;q[G]((X=A.errored)!==null&&X!==void 0?X:new I("end"))}V(A)}function ae(A,M){if(M.corked||M.bufferProcessing||M.destroyed||!M.constructed)return;const{buffered:q,bufferedIndex:X,objectMode:G}=M,W=q.length-X;if(!W)return;let R=X;if(M.bufferProcessing=!0,W>1&&A._writev){M.pendingcb-=W-1;const j=M.allNoop?C:U=>{for(let ce=R;ce<q.length;++ce)q[ce].callback(U)},H=M.allNoop&&R===0?q:r(q,R);H.allBuffers=M.allBuffers,N(A,M,!0,M.length,H,"",j),V(M)}else{do{const{chunk:j,encoding:H,callback:U}=q[R];q[R++]=null;const ce=G?1:j.length;N(A,M,!1,ce,j,H,U)}while(R<q.length&&!M.writing);R===q.length?V(M):R>256?(q.splice(0,R),M.bufferedIndex=0):M.bufferedIndex=R}M.bufferProcessing=!1}Q.prototype._write=function(A,M,q){if(this._writev)this._writev([{chunk:A,encoding:M}],q);else throw new y("_write()")},Q.prototype._writev=null,Q.prototype.end=function(A,M,q){const X=this._writableState;typeof A=="function"?(q=A,A=null,M=null):typeof M=="function"&&(q=M,M=null);let G;if(A!=null){const W=ee(this,A,M);W instanceof n&&(G=W)}return X.corked&&(X.corked=1,this.uncork()),G||(!X.errored&&!X.ending?(X.ending=!0,O(this,X,!0),X.ended=!0):X.finished?G=new k("end"):X.destroyed&&(G=new I("end"))),typeof q=="function"&&(G||X.finished?e.nextTick(q,G):X[B].push(q)),this};function ie(A){return A.ending&&!A.destroyed&&A.constructed&&A.length===0&&!A.errored&&A.buffered.length===0&&!A.finished&&!A.writing&&!A.errorEmitted&&!A.closeEmitted}function le(A,M){let q=!1;function X(G){if(q){P(A,G??S());return}if(q=!0,M.pendingcb--,G){const W=M[B].splice(0);for(let R=0;R<W.length;R++)W[R](G);P(A,G,M.sync)}else ie(M)&&(M.prefinished=!0,A.emit("prefinish"),M.pendingcb++,e.nextTick($,A,M))}M.sync=!0,M.pendingcb++;try{A._final(X)}catch(G){X(G)}M.sync=!1}function oe(A,M){!M.prefinished&&!M.finalCalled&&(typeof A._final=="function"&&!M.destroyed?(M.finalCalled=!0,le(A,M)):(M.prefinished=!0,A.emit("prefinish")))}function O(A,M,q){ie(M)&&(oe(A,M),M.pendingcb===0&&(q?(M.pendingcb++,e.nextTick((X,G)=>{ie(G)?$(X,G):G.pendingcb--},A,M)):ie(M)&&(M.pendingcb++,$(A,M))))}function $(A,M){M.pendingcb--,M.finished=!0;const q=M[B].splice(0);for(let X=0;X<q.length;X++)q[X]();if(A.emit("finish"),M.autoDestroy){const X=A._readableState;(!X||X.autoDestroy&&(X.endEmitted||X.readable===!1))&&A.destroy()}}l(Q.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(A){this._writableState&&(this._writableState.destroyed=A)}},writable:{__proto__:null,get(){const A=this._writableState;return!!A&&A.writable!==!1&&!A.destroyed&&!A.errored&&!A.ending&&!A.ended},set(A){this._writableState&&(this._writableState.writable=!!A)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const A=this._writableState;return A?!A.destroyed&&!A.ending&&A.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const J=a.destroy;Q.prototype.destroy=function(A,M){const q=this._writableState;return!q.destroyed&&(q.bufferedIndex<q.buffered.length||q[B].length)&&e.nextTick(L,q),J.call(this,A,M),this},Q.prototype._undestroy=a.undestroy,Q.prototype._destroy=function(A,M){M(A)},Q.prototype[c.captureRejectionSymbol]=function(A){this.destroy(A)};let se;function ne(){return se===void 0&&(se={}),se}return Q.fromWeb=function(A,M){return ne().newStreamWritableFromWritableStream(A,M)},Q.toWeb=function(A){return ne().newWritableStreamFromStreamWritable(A)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const e=requireBrowser$1(),r=requireBuffer(),{isReadable:n,isWritable:t,isIterable:o,isNodeStream:l,isReadableNodeStream:u,isWritableNodeStream:m,isDuplexNodeStream:d,isReadableStream:i,isWritableStream:c}=requireUtils(),f=requireEndOfStream(),{AbortError:s,codes:{ERR_INVALID_ARG_TYPE:a,ERR_INVALID_RETURN_VALUE:p}}=requireErrors(),{destroyer:h}=requireDestroy(),b=requireDuplex(),g=requireReadable(),y=requireWritable(),{createDeferredPromise:S}=requireUtil(),E=requireFrom(),I=globalThis.Blob||r.Blob,k=typeof I<"u"?function(D){return D instanceof I}:function(D){return!1},T=globalThis.AbortController||requireBrowser$2().AbortController,{FunctionPrototypeCall:w}=requirePrimordials();class F extends b{constructor(D){super(D),(D==null?void 0:D.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(D==null?void 0:D.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function B(D,V){if(d(D))return D;if(u(D))return C({readable:D});if(m(D))return C({writable:D});if(l(D))return C({writable:!1,readable:!1});if(i(D))return C({readable:g.fromWeb(D)});if(c(D))return C({writable:y.fromWeb(D)});if(typeof D=="function"){const{value:ee,write:ue,final:N,destroy:te}=P(D);if(o(ee))return E(F,ee,{objectMode:!0,write:ue,final:N,destroy:te});const x=ee==null?void 0:ee.then;if(typeof x=="function"){let z;const K=w(x,ee,L=>{if(L!=null)throw new p("nully","body",L)},L=>{h(z,L)});return z=new F({objectMode:!0,readable:!1,write:ue,final(L){N(async()=>{try{await K,e.nextTick(L,null)}catch(ae){e.nextTick(L,ae)}})},destroy:te})}throw new p("Iterable, AsyncIterable or AsyncFunction",V,ee)}if(k(D))return B(D.arrayBuffer());if(o(D))return E(F,D,{objectMode:!0,writable:!1});if(i(D==null?void 0:D.readable)&&c(D==null?void 0:D.writable))return F.fromWeb(D);if(typeof(D==null?void 0:D.writable)=="object"||typeof(D==null?void 0:D.readable)=="object"){const ee=D!=null&&D.readable?u(D==null?void 0:D.readable)?D==null?void 0:D.readable:B(D.readable):void 0,ue=D!=null&&D.writable?m(D==null?void 0:D.writable)?D==null?void 0:D.writable:B(D.writable):void 0;return C({readable:ee,writable:ue})}const Q=D==null?void 0:D.then;if(typeof Q=="function"){let ee;return w(Q,D,ue=>{ue!=null&&ee.push(ue),ee.push(null)},ue=>{h(ee,ue)}),ee=new F({objectMode:!0,writable:!1,read(){}})}throw new a(V,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],D)};function P(B){let{promise:D,resolve:V}=S();const Q=new T,ee=Q.signal;return{value:B(async function*(){for(;;){const N=D;D=null;const{chunk:te,done:x,cb:z}=await N;if(e.nextTick(z),x)return;if(ee.aborted)throw new s(void 0,{cause:ee.reason});({promise:D,resolve:V}=S()),yield te}}(),{signal:ee}),write(N,te,x){const z=V;V=null,z({chunk:N,done:!1,cb:x})},final(N){const te=V;V=null,te({done:!0,cb:N})},destroy(N,te){Q.abort(),te(N)}}}function C(B){const D=B.readable&&typeof B.readable.read!="function"?g.wrap(B.readable):B.readable,V=B.writable;let Q=!!n(D),ee=!!t(V),ue,N,te,x,z;function K(L){const ae=x;x=null,ae?ae(L):L&&z.destroy(L)}return z=new F({readableObjectMode:!!(D!=null&&D.readableObjectMode),writableObjectMode:!!(V!=null&&V.writableObjectMode),readable:Q,writable:ee}),ee&&(f(V,L=>{ee=!1,L&&h(D,L),K(L)}),z._write=function(L,ae,ie){V.write(L,ae)?ie():ue=ie},z._final=function(L){V.end(),N=L},V.on("drain",function(){if(ue){const L=ue;ue=null,L()}}),V.on("finish",function(){if(N){const L=N;N=null,L()}})),Q&&(f(D,L=>{Q=!1,L&&h(D,L),K(L)}),D.on("readable",function(){if(te){const L=te;te=null,L()}}),D.on("end",function(){z.push(null)}),z._read=function(){for(;;){const L=D.read();if(L===null){te=z._read;return}if(!z.push(L))return}}),z._destroy=function(L,ae){!L&&x!==null&&(L=new s),te=null,ue=null,N=null,x===null?ae(L):(x=ae,h(V,L),h(D,L))},z}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:e,ObjectGetOwnPropertyDescriptor:r,ObjectKeys:n,ObjectSetPrototypeOf:t}=requirePrimordials();duplex=u;const o=requireReadable(),l=requireWritable();t(u.prototype,o.prototype),t(u,o);{const c=n(l.prototype);for(let f=0;f<c.length;f++){const s=c[f];u.prototype[s]||(u.prototype[s]=l.prototype[s])}}function u(c){if(!(this instanceof u))return new u(c);o.call(this,c),l.call(this,c),c?(this.allowHalfOpen=c.allowHalfOpen!==!1,c.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),c.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}e(u.prototype,{writable:{__proto__:null,...r(l.prototype,"writable")},writableHighWaterMark:{__proto__:null,...r(l.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...r(l.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...r(l.prototype,"writableBuffer")},writableLength:{__proto__:null,...r(l.prototype,"writableLength")},writableFinished:{__proto__:null,...r(l.prototype,"writableFinished")},writableCorked:{__proto__:null,...r(l.prototype,"writableCorked")},writableEnded:{__proto__:null,...r(l.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...r(l.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(c){this._readableState&&this._writableState&&(this._readableState.destroyed=c,this._writableState.destroyed=c)}}});let m;function d(){return m===void 0&&(m={}),m}u.fromWeb=function(c,f){return d().newStreamDuplexFromReadableWritablePair(c,f)},u.toWeb=function(c){return d().newReadableWritablePairFromDuplex(c)};let i;return u.from=function(c){return i||(i=requireDuplexify()),i(c,"body")},duplex}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1;const{ObjectSetPrototypeOf:e,Symbol:r}=requirePrimordials();transform=u;const{ERR_METHOD_NOT_IMPLEMENTED:n}=requireErrors().codes,t=requireDuplex(),{getHighWaterMark:o}=requireState();e(u.prototype,t.prototype),e(u,t);const l=r("kCallback");function u(i){if(!(this instanceof u))return new u(i);const c=i?o(this,i,"readableHighWaterMark",!0):null;c===0&&(i={...i,highWaterMark:null,readableHighWaterMark:c,writableHighWaterMark:i.writableHighWaterMark||0}),t.call(this,i),this._readableState.sync=!1,this[l]=null,i&&(typeof i.transform=="function"&&(this._transform=i.transform),typeof i.flush=="function"&&(this._flush=i.flush)),this.on("prefinish",d)}function m(i){typeof this._flush=="function"&&!this.destroyed?this._flush((c,f)=>{if(c){i?i(c):this.destroy(c);return}f!=null&&this.push(f),this.push(null),i&&i()}):(this.push(null),i&&i())}function d(){this._final!==m&&m.call(this)}return u.prototype._final=m,u.prototype._transform=function(i,c,f){throw new n("_transform()")},u.prototype._write=function(i,c,f){const s=this._readableState,a=this._writableState,p=s.length;this._transform(i,c,(h,b)=>{if(h){f(h);return}b!=null&&this.push(b),a.ended||p===s.length||s.length<s.highWaterMark?f():this[l]=f})},u.prototype._read=function(){if(this[l]){const i=this[l];this[l]=null,i()}},transform}var passthrough,hasRequiredPassthrough;function requirePassthrough(){if(hasRequiredPassthrough)return passthrough;hasRequiredPassthrough=1;const{ObjectSetPrototypeOf:e}=requirePrimordials();passthrough=n;const r=requireTransform();e(n.prototype,r.prototype),e(n,r);function n(t){if(!(this instanceof n))return new n(t);r.call(this,t)}return n.prototype._transform=function(t,o,l){l(null,t)},passthrough}var pipeline_1,hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline_1;hasRequiredPipeline=1;const e=requireBrowser$1(),{ArrayIsArray:r,Promise:n,SymbolAsyncIterator:t,SymbolDispose:o}=requirePrimordials(),l=requireEndOfStream(),{once:u}=requireUtil(),m=requireDestroy(),d=requireDuplex(),{aggregateTwoErrors:i,codes:{ERR_INVALID_ARG_TYPE:c,ERR_INVALID_RETURN_VALUE:f,ERR_MISSING_ARGS:s,ERR_STREAM_DESTROYED:a,ERR_STREAM_PREMATURE_CLOSE:p},AbortError:h}=requireErrors(),{validateFunction:b,validateAbortSignal:g}=requireValidators(),{isIterable:y,isReadable:S,isReadableNodeStream:E,isNodeStream:I,isTransformStream:k,isWebStream:T,isReadableStream:w,isReadableFinished:F}=requireUtils(),P=globalThis.AbortController||requireBrowser$2().AbortController;let C,B,D;function V(L,ae,ie){let le=!1;L.on("close",()=>{le=!0});const oe=l(L,{readable:ae,writable:ie},O=>{le=!O});return{destroy:O=>{le||(le=!0,m.destroyer(L,O||new a("pipe")))},cleanup:oe}}function Q(L){return b(L[L.length-1],"streams[stream.length - 1]"),L.pop()}function ee(L){if(y(L))return L;if(E(L))return ue(L);throw new c("val",["Readable","Iterable","AsyncIterable"],L)}async function*ue(L){B||(B=requireReadable()),yield*B.prototype[t].call(L)}async function N(L,ae,ie,{end:le}){let oe,O=null;const $=ne=>{if(ne&&(oe=ne),O){const A=O;O=null,A()}},J=()=>new n((ne,A)=>{oe?A(oe):O=()=>{oe?A(oe):ne()}});ae.on("drain",$);const se=l(ae,{readable:!1},$);try{ae.writableNeedDrain&&await J();for await(const ne of L)ae.write(ne)||await J();le&&(ae.end(),await J()),ie()}catch(ne){ie(oe!==ne?i(oe,ne):ne)}finally{se(),ae.off("drain",$)}}async function te(L,ae,ie,{end:le}){k(ae)&&(ae=ae.writable);const oe=ae.getWriter();try{for await(const O of L)await oe.ready,oe.write(O).catch(()=>{});await oe.ready,le&&await oe.close(),ie()}catch(O){try{await oe.abort(O),ie(O)}catch($){ie($)}}}function x(...L){return z(L,u(Q(L)))}function z(L,ae,ie){if(L.length===1&&r(L[0])&&(L=L[0]),L.length<2)throw new s("streams");const le=new P,oe=le.signal,O=ie==null?void 0:ie.signal,$=[];g(O,"options.signal");function J(){G(new h)}D=D||requireUtil().addAbortListener;let se;O&&(se=D(O,J));let ne,A;const M=[];let q=0;function X(H){G(H,--q===0)}function G(H,U){var ce;if(H&&(!ne||ne.code==="ERR_STREAM_PREMATURE_CLOSE")&&(ne=H),!(!ne&&!U)){for(;M.length;)M.shift()(ne);(ce=se)===null||ce===void 0||ce[o](),le.abort(),U&&(ne||$.forEach(pe=>pe()),e.nextTick(ae,ne,A))}}let W;for(let H=0;H<L.length;H++){const U=L[H],ce=H<L.length-1,pe=H>0,de=ce||(ie==null?void 0:ie.end)!==!1,he=H===L.length-1;if(I(U)){let fe=function(Te){Te&&Te.name!=="AbortError"&&Te.code!=="ERR_STREAM_PREMATURE_CLOSE"&&X(Te)};if(de){const{destroy:Te,cleanup:Se}=V(U,ce,pe);M.push(Te),S(U)&&he&&$.push(Se)}U.on("error",fe),S(U)&&he&&$.push(()=>{U.removeListener("error",fe)})}if(H===0)if(typeof U=="function"){if(W=U({signal:oe}),!y(W))throw new f("Iterable, AsyncIterable or Stream","source",W)}else y(U)||E(U)||k(U)?W=U:W=d.from(U);else if(typeof U=="function"){if(k(W)){var R;W=ee((R=W)===null||R===void 0?void 0:R.readable)}else W=ee(W);if(W=U(W,{signal:oe}),ce){if(!y(W,!0))throw new f("AsyncIterable",`transform[${H-1}]`,W)}else{var j;C||(C=requirePassthrough());const fe=new C({objectMode:!0}),Te=(j=W)===null||j===void 0?void 0:j.then;if(typeof Te=="function")q++,Te.call(W,ge=>{A=ge,ge!=null&&fe.write(ge),de&&fe.end(),e.nextTick(X)},ge=>{fe.destroy(ge),e.nextTick(X,ge)});else if(y(W,!0))q++,N(W,fe,X,{end:de});else if(w(W)||k(W)){const ge=W.readable||W;q++,N(ge,fe,X,{end:de})}else throw new f("AsyncIterable or Promise","destination",W);W=fe;const{destroy:Se,cleanup:Re}=V(W,!1,!0);M.push(Se),he&&$.push(Re)}}else if(I(U)){if(E(W)){q+=2;const fe=K(W,U,X,{end:de});S(U)&&he&&$.push(fe)}else if(k(W)||w(W)){const fe=W.readable||W;q++,N(fe,U,X,{end:de})}else if(y(W))q++,N(W,U,X,{end:de});else throw new c("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],W);W=U}else if(T(U)){if(E(W))q++,te(ee(W),U,X,{end:de});else if(w(W)||y(W))q++,te(W,U,X,{end:de});else if(k(W))q++,te(W.readable,U,X,{end:de});else throw new c("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],W);W=U}else W=d.from(U)}return(oe!=null&&oe.aborted||O!=null&&O.aborted)&&e.nextTick(J),W}function K(L,ae,ie,{end:le}){let oe=!1;if(ae.on("close",()=>{oe||ie(new p)}),L.pipe(ae,{end:!1}),le){let O=function(){oe=!0,ae.end()};F(L)?e.nextTick(O):L.once("end",O)}else ie();return l(L,{readable:!0,writable:!1},O=>{const $=L._readableState;O&&O.code==="ERR_STREAM_PREMATURE_CLOSE"&&$&&$.ended&&!$.errored&&!$.errorEmitted?L.once("end",ie).once("error",ie):ie(O)}),l(ae,{readable:!1,writable:!0},ie)}return pipeline_1={pipelineImpl:z,pipeline:x},pipeline_1}var compose,hasRequiredCompose;function requireCompose(){if(hasRequiredCompose)return compose;hasRequiredCompose=1;const{pipeline:e}=requirePipeline(),r=requireDuplex(),{destroyer:n}=requireDestroy(),{isNodeStream:t,isReadable:o,isWritable:l,isWebStream:u,isTransformStream:m,isWritableStream:d,isReadableStream:i}=requireUtils(),{AbortError:c,codes:{ERR_INVALID_ARG_VALUE:f,ERR_MISSING_ARGS:s}}=requireErrors(),a=requireEndOfStream();return compose=function(...h){if(h.length===0)throw new s("streams");if(h.length===1)return r.from(h[0]);const b=[...h];if(typeof h[0]=="function"&&(h[0]=r.from(h[0])),typeof h[h.length-1]=="function"){const C=h.length-1;h[C]=r.from(h[C])}for(let C=0;C<h.length;++C)if(!(!t(h[C])&&!u(h[C]))){if(C<h.length-1&&!(o(h[C])||i(h[C])||m(h[C])))throw new f(`streams[${C}]`,b[C],"must be readable");if(C>0&&!(l(h[C])||d(h[C])||m(h[C])))throw new f(`streams[${C}]`,b[C],"must be writable")}let g,y,S,E,I;function k(C){const B=E;E=null,B?B(C):C?I.destroy(C):!P&&!F&&I.destroy()}const T=h[0],w=e(h,k),F=!!(l(T)||d(T)||m(T)),P=!!(o(w)||i(w)||m(w));if(I=new r({writableObjectMode:!!(T!=null&&T.writableObjectMode),readableObjectMode:!!(w!=null&&w.readableObjectMode),writable:F,readable:P}),F){if(t(T))I._write=function(B,D,V){T.write(B,D)?V():g=V},I._final=function(B){T.end(),y=B},T.on("drain",function(){if(g){const B=g;g=null,B()}});else if(u(T)){const D=(m(T)?T.writable:T).getWriter();I._write=async function(V,Q,ee){try{await D.ready,D.write(V).catch(()=>{}),ee()}catch(ue){ee(ue)}},I._final=async function(V){try{await D.ready,D.close().catch(()=>{}),y=V}catch(Q){V(Q)}}}const C=m(w)?w.readable:w;a(C,()=>{if(y){const B=y;y=null,B()}})}if(P){if(t(w))w.on("readable",function(){if(S){const C=S;S=null,C()}}),w.on("end",function(){I.push(null)}),I._read=function(){for(;;){const C=w.read();if(C===null){S=I._read;return}if(!I.push(C))return}};else if(u(w)){const B=(m(w)?w.readable:w).getReader();I._read=async function(){for(;;)try{const{value:D,done:V}=await B.read();if(!I.push(D))return;if(V){I.push(null);return}}catch{return}}}}return I._destroy=function(C,B){!C&&E!==null&&(C=new c),S=null,g=null,y=null,E===null?B(C):(E=B,t(w)&&n(w,C))},I},compose}var hasRequiredOperators;function requireOperators(){if(hasRequiredOperators)return operators;hasRequiredOperators=1;const e=globalThis.AbortController||requireBrowser$2().AbortController,{codes:{ERR_INVALID_ARG_VALUE:r,ERR_INVALID_ARG_TYPE:n,ERR_MISSING_ARGS:t,ERR_OUT_OF_RANGE:o},AbortError:l}=requireErrors(),{validateAbortSignal:u,validateInteger:m,validateObject:d}=requireValidators(),i=requirePrimordials().Symbol("kWeak"),c=requirePrimordials().Symbol("kResistStopPropagation"),{finished:f}=requireEndOfStream(),s=requireCompose(),{addAbortSignalNoValidate:a}=requireAddAbortSignal(),{isWritable:p,isNodeStream:h}=requireUtils(),{deprecate:b}=requireUtil(),{ArrayPrototypePush:g,Boolean:y,MathFloor:S,Number:E,NumberIsNaN:I,Promise:k,PromiseReject:T,PromiseResolve:w,PromisePrototypeThen:F,Symbol:P}=requirePrimordials(),C=P("kEmpty"),B=P("kEof");function D(O,$){if($!=null&&d($,"options"),($==null?void 0:$.signal)!=null&&u($.signal,"options.signal"),h(O)&&!p(O))throw new r("stream",O,"must be writable");const J=s(this,O);return $!=null&&$.signal&&a($.signal,J),J}function V(O,$){if(typeof O!="function")throw new n("fn",["Function","AsyncFunction"],O);$!=null&&d($,"options"),($==null?void 0:$.signal)!=null&&u($.signal,"options.signal");let J=1;($==null?void 0:$.concurrency)!=null&&(J=S($.concurrency));let se=J-1;return($==null?void 0:$.highWaterMark)!=null&&(se=S($.highWaterMark)),m(J,"options.concurrency",1),m(se,"options.highWaterMark",0),se+=J,(async function*(){const A=requireUtil().AbortSignalAny([$==null?void 0:$.signal].filter(y)),M=this,q=[],X={signal:A};let G,W,R=!1,j=0;function H(){R=!0,U()}function U(){j-=1,ce()}function ce(){W&&!R&&j<J&&q.length<se&&(W(),W=null)}async function pe(){try{for await(let de of M){if(R)return;if(A.aborted)throw new l;try{if(de=O(de,X),de===C)continue;de=w(de)}catch(he){de=T(he)}j+=1,F(de,U,H),q.push(de),G&&(G(),G=null),!R&&(q.length>=se||j>=J)&&await new k(he=>{W=he})}q.push(B)}catch(de){const he=T(de);F(he,U,H),q.push(he)}finally{R=!0,G&&(G(),G=null)}}pe();try{for(;;){for(;q.length>0;){const de=await q[0];if(de===B)return;if(A.aborted)throw new l;de!==C&&(yield de),q.shift(),ce()}await new k(de=>{G=de})}}finally{R=!0,W&&(W(),W=null)}}).call(this)}function Q(O=void 0){return O!=null&&d(O,"options"),(O==null?void 0:O.signal)!=null&&u(O.signal,"options.signal"),(async function*(){let J=0;for await(const ne of this){var se;if(O!=null&&(se=O.signal)!==null&&se!==void 0&&se.aborted)throw new l({cause:O.signal.reason});yield[J++,ne]}}).call(this)}async function ee(O,$=void 0){for await(const J of x.call(this,O,$))return!0;return!1}async function ue(O,$=void 0){if(typeof O!="function")throw new n("fn",["Function","AsyncFunction"],O);return!await ee.call(this,async(...J)=>!await O(...J),$)}async function N(O,$){for await(const J of x.call(this,O,$))return J}async function te(O,$){if(typeof O!="function")throw new n("fn",["Function","AsyncFunction"],O);async function J(se,ne){return await O(se,ne),C}for await(const se of V.call(this,J,$));}function x(O,$){if(typeof O!="function")throw new n("fn",["Function","AsyncFunction"],O);async function J(se,ne){return await O(se,ne)?se:C}return V.call(this,J,$)}class z extends t{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function K(O,$,J){var se;if(typeof O!="function")throw new n("reducer",["Function","AsyncFunction"],O);J!=null&&d(J,"options"),(J==null?void 0:J.signal)!=null&&u(J.signal,"options.signal");let ne=arguments.length>1;if(J!=null&&(se=J.signal)!==null&&se!==void 0&&se.aborted){const G=new l(void 0,{cause:J.signal.reason});throw this.once("error",()=>{}),await f(this.destroy(G)),G}const A=new e,M=A.signal;if(J!=null&&J.signal){const G={once:!0,[i]:this,[c]:!0};J.signal.addEventListener("abort",()=>A.abort(),G)}let q=!1;try{for await(const G of this){var X;if(q=!0,J!=null&&(X=J.signal)!==null&&X!==void 0&&X.aborted)throw new l;ne?$=await O($,G,{signal:M}):($=G,ne=!0)}if(!q&&!ne)throw new z}finally{A.abort()}return $}async function L(O){O!=null&&d(O,"options"),(O==null?void 0:O.signal)!=null&&u(O.signal,"options.signal");const $=[];for await(const se of this){var J;if(O!=null&&(J=O.signal)!==null&&J!==void 0&&J.aborted)throw new l(void 0,{cause:O.signal.reason});g($,se)}return $}function ae(O,$){const J=V.call(this,O,$);return(async function*(){for await(const ne of J)yield*ne}).call(this)}function ie(O){if(O=E(O),I(O))return 0;if(O<0)throw new o("number",">= 0",O);return O}function le(O,$=void 0){return $!=null&&d($,"options"),($==null?void 0:$.signal)!=null&&u($.signal,"options.signal"),O=ie(O),(async function*(){var se;if($!=null&&(se=$.signal)!==null&&se!==void 0&&se.aborted)throw new l;for await(const A of this){var ne;if($!=null&&(ne=$.signal)!==null&&ne!==void 0&&ne.aborted)throw new l;O--<=0&&(yield A)}}).call(this)}function oe(O,$=void 0){return $!=null&&d($,"options"),($==null?void 0:$.signal)!=null&&u($.signal,"options.signal"),O=ie(O),(async function*(){var se;if($!=null&&(se=$.signal)!==null&&se!==void 0&&se.aborted)throw new l;for await(const A of this){var ne;if($!=null&&(ne=$.signal)!==null&&ne!==void 0&&ne.aborted)throw new l;if(O-- >0&&(yield A),O<=0)return}}).call(this)}return operators.streamReturningOperators={asIndexedPairs:b(Q,"readable.asIndexedPairs will be removed in a future version."),drop:le,filter:x,flatMap:ae,map:V,take:oe,compose:D},operators.promiseReturningOperators={every:ue,forEach:te,reduce:K,toArray:L,some:ee,find:N},operators}var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:e,Promise:r}=requirePrimordials(),{isIterable:n,isNodeStream:t,isWebStream:o}=requireUtils(),{pipelineImpl:l}=requirePipeline(),{finished:u}=requireEndOfStream();requireStream();function m(...d){return new r((i,c)=>{let f,s;const a=d[d.length-1];if(a&&typeof a=="object"&&!t(a)&&!n(a)&&!o(a)){const p=e(d);f=p.signal,s=p.end}l(d,(p,h)=>{p?c(p):i(h)},{signal:f,end:s})})}return promises={finished:u,pipeline:m},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:e}=requireBuffer(),{ObjectDefineProperty:r,ObjectKeys:n,ReflectApply:t}=requirePrimordials(),{promisify:{custom:o}}=requireUtil(),{streamReturningOperators:l,promiseReturningOperators:u}=requireOperators(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:m}}=requireErrors(),d=requireCompose(),{setDefaultHighWaterMark:i,getDefaultHighWaterMark:c}=requireState(),{pipeline:f}=requirePipeline(),{destroyer:s}=requireDestroy(),a=requireEndOfStream(),p=requirePromises(),h=requireUtils(),b=stream.exports=requireLegacy().Stream;b.isDestroyed=h.isDestroyed,b.isDisturbed=h.isDisturbed,b.isErrored=h.isErrored,b.isReadable=h.isReadable,b.isWritable=h.isWritable,b.Readable=requireReadable();for(const y of n(l)){let E=function(...I){if(new.target)throw m();return b.Readable.from(t(S,this,I))};const S=l[y];r(E,"name",{__proto__:null,value:S.name}),r(E,"length",{__proto__:null,value:S.length}),r(b.Readable.prototype,y,{__proto__:null,value:E,enumerable:!1,configurable:!0,writable:!0})}for(const y of n(u)){let E=function(...I){if(new.target)throw m();return t(S,this,I)};const S=u[y];r(E,"name",{__proto__:null,value:S.name}),r(E,"length",{__proto__:null,value:S.length}),r(b.Readable.prototype,y,{__proto__:null,value:E,enumerable:!1,configurable:!0,writable:!0})}b.Writable=requireWritable(),b.Duplex=requireDuplex(),b.Transform=requireTransform(),b.PassThrough=requirePassthrough(),b.pipeline=f;const{addAbortSignal:g}=requireAddAbortSignal();return b.addAbortSignal=g,b.finished=a,b.destroy=s,b.compose=d,b.setDefaultHighWaterMark=i,b.getDefaultHighWaterMark=c,r(b,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return p}}),r(f,o,{__proto__:null,enumerable:!0,get(){return p.pipeline}}),r(a,o,{__proto__:null,enumerable:!0,get(){return p.finished}}),b.Stream=b,b._isUint8Array=function(S){return S instanceof Uint8Array},b._uint8ArrayToBuffer=function(S){return e.from(S.buffer,S.byteOffset,S.byteLength)},stream.exports}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,function(e){const r=requireStream(),n=requirePromises(),t=r.Readable.destroy;e.exports=r.Readable,e.exports._uint8ArrayToBuffer=r._uint8ArrayToBuffer,e.exports._isUint8Array=r._isUint8Array,e.exports.isDisturbed=r.isDisturbed,e.exports.isErrored=r.isErrored,e.exports.isReadable=r.isReadable,e.exports.Readable=r.Readable,e.exports.Writable=r.Writable,e.exports.Duplex=r.Duplex,e.exports.Transform=r.Transform,e.exports.PassThrough=r.PassThrough,e.exports.addAbortSignal=r.addAbortSignal,e.exports.finished=r.finished,e.exports.destroy=r.destroy,e.exports.destroy=t,e.exports.pipeline=r.pipeline,e.exports.compose=r.compose,Object.defineProperty(r,"promises",{configurable:!0,enumerable:!0,get(){return n}}),e.exports.Stream=r.Stream,e.exports.default=e.exports}(browser$2)),browser$2.exports}var hasRequiredLib$1;function requireLib$1(){if(hasRequiredLib$1)return lib;hasRequiredLib$1=1,Object.defineProperty(lib,"__esModule",{value:!0}),lib.ReadableWebToNodeStream=void 0;const e=requireBrowser();class r extends e.Readable{constructor(t){super(),this.bytesRead=0,this.released=!1,this.reader=t.getReader()}_read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read().then(t=>{delete this.pendingRead,t.done||this.released?this.push(null):(this.bytesRead+=t.value.length,this.push(t.value))}).catch(t=>{this.destroy(t)})}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}return lib.ReadableWebToNodeStream=r,lib}var hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fetchFromUrl=e.parseBlob=e.parseReadableStream=e.parseNodeStream=e.selectCover=e.ratingToStars=e.orderTags=e.parseFromTokenizer=e.parseBuffer=void 0;const r=requireBrowser$3(),n=requireCore(),t=requireLib$1(),o=r("music-metadata-browser:main");var l=requireCore();Object.defineProperty(e,"parseBuffer",{enumerable:!0,get:function(){return l.parseBuffer}}),Object.defineProperty(e,"parseFromTokenizer",{enumerable:!0,get:function(){return l.parseFromTokenizer}}),Object.defineProperty(e,"orderTags",{enumerable:!0,get:function(){return l.orderTags}}),Object.defineProperty(e,"ratingToStars",{enumerable:!0,get:function(){return l.ratingToStars}}),Object.defineProperty(e,"selectCover",{enumerable:!0,get:function(){return l.selectCover}}),e.parseNodeStream=n.parseStream;async function u(c,f,s){const a=new t.ReadableWebToNodeStream(c),p=await(0,e.parseNodeStream)(a,typeof f=="string"?{mimeType:f}:f,s);return await a.close(),p}e.parseReadableStream=u;async function m(c,f){c.type,c.size,c instanceof File&&c.name;const s=c.stream?c.stream():d(c);return u(s,{mimeType:c.type,size:c.size},f)}e.parseBlob=m;function d(c){const f=new FileReader;return new ReadableStream({start(s){f.onloadend=a=>{let p=a.target.result;p instanceof ArrayBuffer&&(p=new Uint8Array(p)),s.enqueue(p),s.close()},f.onerror=a=>{s.close()},f.onabort=a=>{s.close()},f.readAsArrayBuffer(c)}})}async function i(c,f){const s=await fetch(c),a={size:parseInt(s.headers.get("Content-Length"),10),mimeType:s.headers.get("Content-Type")};if(s.ok)if(s.body){const p=await u(s.body,a,f);return o("Closing HTTP-readable-stream..."),s.body.locked||await s.body.cancel(),o("HTTP-readable-stream closed."),p}else return m(await s.blob(),f);else throw new Error(`HTTP error status=${s.status}: ${s.statusText}`)}e.fetchFromUrl=i}(lib$3)),lib$3}var libExports=requireLib();const index=_mergeNamespaces({__proto__:null},[libExports]);export{index as i};
